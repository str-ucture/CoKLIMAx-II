

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Satellite Lake Water Temperature &mdash; Coklimax 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=3b187e9f" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="SIS Health Vector" href="sis-health-vector.html" />
    <link rel="prev" title="Satellite Lake Water Levels" href="satellite-lake-water-level.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Coklimax
              <img src="../../_static/coklimax_logo_new.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Erste Schritte:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_intro/einf%C3%BChrung_cds.html">Der Copernicus Climate Data Store (CDS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_intro/einf%C3%BChrung_jupyter_notebooks.html">Einführung in die CoKLIMAx II Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_intro/einf%C3%BChrung_kurz_elemente.html">Einführung Kurz Elemente</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_intro/notwendige_software_und_kenntnisse.html">Required Software and Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup_verification.html">Setup Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_intro/introduction_cds.html">The Copernicus Climate Data Store (CDS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs 1:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kurs1/herunterladen_ersten_datensatzes.html">Download Your First Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs1/analysis_and_visualization.html">Use Case: Analysis and Visualization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs 2:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="satellite-lake-water-level.html">Satellite Lake Water Levels</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Satellite Lake Water Temperature</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#specifying-the-paths-and-working-directories">1. Specifying the paths and working directories</a></li>
<li class="toctree-l2"><a class="reference internal" href="#download-and-extract-dataset">2. Download and Extract Dataset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#authentication">2.1 Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#request-definition-and-download">2.2 Request Definition and Download</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extract-the-zip-folder">2.3 Extract the Zip folder</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#merge-yearly-netcdf4-files-into-a-single-netcdf4-file">3. Merge Yearly NetCDF4 Files into a Single NetCDF4 File</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read-the-merged-netcdf4-file-and-print-the-metadata">4. Read the merged netCDF4 file and print the metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#export-merged-netcdf4-file-to-geotiff">5. Export merged netCDF4 file to GeoTIFF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#v1-exported-geotiff-aligns-with-the-netcdf4-data-in-qgis">5.1 V1: Exported GeoTIFF aligns with the NetCDF4 data in QGIS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#v2-from-tim">5.2 V2: From Tim</a></li>
<li class="toctree-l3"><a class="reference internal" href="#v3-similar-to-tim-s-but-without-rotation-and-flip">5.3 V3: Similar to Tim’s but without rotation and flip</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-dataframe-and-export-as-csv">6. Create Dataframe and Export as CSV</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#daily-average">4.1 Daily average</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plot-daily-average">4.2 Plot daily average</a></li>
<li class="toctree-l3"><a class="reference internal" href="#monthly-average">5.2 Monthly average</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plot-using-cmap">5.3 Plot using cmap</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sis-health-vector.html">SIS Health Vector</a></li>
<li class="toctree-l1"><a class="reference internal" href="sis-temperature-statistics.html">Temperature Statistics for Europe</a></li>
<li class="toctree-l1"><a class="reference internal" href="alpine-monthly-precipitation.html">Alpine monatliche Niederschlagsdaten</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs 3:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kurs3/senthub_downloader.html">SentinelHub Downloader</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs Note Defined:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kurs_not_defined/era5_land_hourly.html">ERA5-Land Hourly Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs_not_defined/era5_land_monthly.html">ERA5-Land Monthly Averaged</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs_not_defined/landsat_with_landsatxplore.html">Landsat Dataset Downloader using Landsatxplorer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Coklimax</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Satellite Lake Water Temperature</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/kurs2/satellite-lake-water-temperature.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="satellite-lake-water-temperature">
<h1>Satellite Lake Water Temperature<a class="headerlink" href="#satellite-lake-water-temperature" title="Link to this heading"></a></h1>
<p>This dataset provides mid-morning daily lake surface water temperature (LSWT) values derived from satellite data, along with associated uncertainty and quality levels. The data, retrieved from ATSR and AVHRR sensors, have been bias-adjusted for consistency and may contain gaps due to missing observations. LSWT is an essential climate variable critical for understanding lake ecology, hydrological processes, and large-scale climate interactions, with data development supported by the UK NERC GloboLakes project and future enhancements from the ESA Climate Change Initiative.</p>
<p><strong>Information on Dataset:</strong></p>
<ul class="simple">
<li><p>Source: <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-lake-water-temperature?tab=overview">Satellite Lake Water Temperature</a></p></li>
<li><p>Author:</p></li>
<li><p>Notebook Version: 1.3 (Updated: December 03, 2024)</p></li>
</ul>
<section id="specifying-the-paths-and-working-directories">
<h2>1. Specifying the paths and working directories<a class="headerlink" href="#specifying-the-paths-and-working-directories" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="sd">&#39;&#39;&#39; ---- Hier die Verzeichnisse angeben ---- &#39;&#39;&#39;</span>
<span class="n">download_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\download&quot;</span>
<span class="n">working_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\working&quot;</span>
<span class="n">geotiff_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\geotiff&quot;</span>
<span class="n">csv_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\csv&quot;</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\output&quot;</span>
<span class="sd">&#39;&#39;&#39; ----- Ende der Eingaben ---- &#39;&#39;&#39;</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-and-extract-dataset">
<h2>2. Download and Extract Dataset<a class="headerlink" href="#download-and-extract-dataset" title="Link to this heading"></a></h2>
<section id="authentication">
<h3>2.1 Authentication<a class="headerlink" href="#authentication" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cdsapi</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;fdae60fd-35d4-436f-825c-c63fedab94a4&quot;</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://cds.climate.copernicus.eu/api&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="request-definition-and-download">
<h3>2.2 Request Definition and Download<a class="headerlink" href="#request-definition-and-download" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define additional request fields to ensure the request stays within the file size limit.</span>
<span class="c1"># These coordinates were obtained using the BBox Extractor tool: https://str-ucture.github.io/bbox-extractor/</span>

<span class="n">bbox_wgs84_constance</span> <span class="o">=</span> <span class="p">[</span><span class="mf">48.0</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="mf">47.3</span><span class="p">,</span> <span class="mf">9.9</span><span class="p">]</span>  <span class="c1"># [North, West, South, East]</span>

<span class="c1"># Different data versions are available depending on the year of interest.</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2008</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;4_5_1&quot;</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2020</span> <span class="k">else</span> <span class="s2">&quot;4_5_2&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;satellite-lake-water-temperature&quot;</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;01&quot;</span><span class="p">,</span> <span class="s2">&quot;02&quot;</span><span class="p">,</span> <span class="s2">&quot;03&quot;</span><span class="p">,</span>
        <span class="s2">&quot;04&quot;</span><span class="p">,</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;06&quot;</span><span class="p">,</span>
        <span class="s2">&quot;07&quot;</span><span class="p">,</span> <span class="s2">&quot;08&quot;</span><span class="p">,</span> <span class="s2">&quot;09&quot;</span><span class="p">,</span>
        <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="s2">&quot;12&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;01&quot;</span><span class="p">,</span> <span class="s2">&quot;02&quot;</span><span class="p">,</span> <span class="s2">&quot;03&quot;</span><span class="p">,</span>
        <span class="s2">&quot;04&quot;</span><span class="p">,</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;06&quot;</span><span class="p">,</span>
        <span class="s2">&quot;07&quot;</span><span class="p">,</span> <span class="s2">&quot;08&quot;</span><span class="p">,</span> <span class="s2">&quot;09&quot;</span><span class="p">,</span>
        <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;13&quot;</span><span class="p">,</span> <span class="s2">&quot;14&quot;</span><span class="p">,</span> <span class="s2">&quot;15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;16&quot;</span><span class="p">,</span> <span class="s2">&quot;17&quot;</span><span class="p">,</span> <span class="s2">&quot;18&quot;</span><span class="p">,</span>
        <span class="s2">&quot;19&quot;</span><span class="p">,</span> <span class="s2">&quot;20&quot;</span><span class="p">,</span> <span class="s2">&quot;21&quot;</span><span class="p">,</span>
        <span class="s2">&quot;22&quot;</span><span class="p">,</span> <span class="s2">&quot;23&quot;</span><span class="p">,</span> <span class="s2">&quot;24&quot;</span><span class="p">,</span>
        <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;26&quot;</span><span class="p">,</span> <span class="s2">&quot;27&quot;</span><span class="p">,</span>
        <span class="s2">&quot;28&quot;</span><span class="p">,</span> <span class="s2">&quot;29&quot;</span><span class="p">,</span> <span class="s2">&quot;30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;31&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">bbox_wgs84_constance</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment and run this cell to download the dataset:</span>

<span class="k">def</span> <span class="nf">main_retrieve</span><span class="p">():</span>
    <span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.zip&quot;</span>
    <span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>
    
    <span class="c1"># Download the dataset only if the dataset has not been downloaded before</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">):</span>
        <span class="c1"># Download the dataset with the defined request parameters</span>
        <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset already downloaded.&quot;</span><span class="p">)</span>
        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
    <span class="n">main_retrieve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-11 17:23:41,020 INFO [2024-09-28T00:00:00] **Welcome to the New Climate Data Store (CDS)!** This new system is in its early days of full operations and still undergoing enhancements and fine tuning. Some disruptions are to be expected. Your 
[feedback](https://jira.ecmwf.int/plugins/servlet/desk/portal/1/create/202) is key to improve the user experience on the new CDS for the benefit of everyone. Thank you.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-11 17:23:41,021 INFO [2024-09-26T00:00:00] Watch our [Forum](https://forum.ecmwf.int/) for Announcements, news and other discussed topics.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-11 17:23:41,022 INFO [2024-09-16T00:00:00] Remember that you need to have an ECMWF account to use the new CDS. **Your old CDS credentials will not work in new CDS!**
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-11 17:23:41,023 WARNING [2024-06-16T00:00:00] CDS API syntax is changed and some keys or parameter names may have also changed. To avoid requests failing, please use the &quot;Show API request code&quot; tool on the dataset Download Form to check you are using the correct syntax for your API request.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already downloaded.
</pre></div>
</div>
</div>
</div>
</section>
<section id="extract-the-zip-folder">
<h3>2.3 Extract the Zip folder<a class="headerlink" href="#extract-the-zip-folder" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">zipfile</span>

<span class="c1"># Construct the dataset filename and path</span>
<span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.zip&quot;</span>
<span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>

<span class="c1"># Extract the zip file</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
            <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully extracted files to: </span><span class="si">{</span><span class="n">extract_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Folder is not empty. Skipping extraction.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: The file </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> was not found.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: The file </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> is not a valid zip file.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Folder is not empty. Skipping extraction.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="merge-yearly-netcdf4-files-into-a-single-netcdf4-file">
<h2>3. Merge Yearly NetCDF4 Files into a Single NetCDF4 File<a class="headerlink" href="#merge-yearly-netcdf4-files-into-a-single-netcdf4-file" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="c1"># Filter the list of filenames</span>
<span class="n">nc_filepath_merged</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">):</span>
    <span class="n">filename_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>

    <span class="c1"># Load all NetCDF files into a list of datasets</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filename_list</span><span class="p">]</span>
    <span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="c1"># Save the merged dataset into a new NetCDF file</span>
    <span class="n">merged_dataset</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New NetCDF4 file created at </span><span class="si">{</span><span class="n">nc_filepath_merged</span><span class="si">}</span><span class="s2"> for year </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nc_filepath_merged</span><span class="si">}</span><span class="s2"> already exists.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>.\data\satellite-lake-water-temperature\output\satellite-lake-water-temperature_2008.nc already exists.
</pre></div>
</div>
</div>
</div>
</section>
<section id="read-the-merged-netcdf4-file-and-print-the-metadata">
<h2>4. Read the merged netCDF4 file and print the metadata<a class="headerlink" href="#read-the-merged-netcdf4-file-and-print-the-metadata" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Open the NetCDF file in read mode</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>

<span class="c1"># List all variables in the dataset</span>
<span class="n">variables_list</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="n">df_var_units</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;Variable&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables_list</span><span class="p">),</span>
        <span class="s2">&quot;Dimension&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">variable</span><span class="p">])</span> <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables_list</span><span class="p">)],</span>
        <span class="s2">&quot;Unit&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span> <span class="s2">&quot;units&quot;</span><span class="p">)</span>
                <span class="k">else</span> <span class="s2">&quot;NA&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables_list</span>
        <span class="p">],</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Extract coordinate data and the primary variable&#39;s data</span>
<span class="n">lon_list</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>
<span class="n">lat_list</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_variable</span> <span class="o">=</span> <span class="s1">&#39;lake_surface_water_temperature&#39;</span>
<span class="n">variable_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="n">test_variable</span><span class="p">]</span>

<span class="c1"># Generate summary of the primary variable</span>
<span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Variable Name&quot;</span><span class="p">:</span> <span class="n">test_variable</span><span class="p">,</span>
    <span class="s2">&quot;Data Type&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
    <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="s2">&quot;Variable Info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">test_variable</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variable_data</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Units&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Long Name&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Display dataset summary as a DataFrame for better visualization</span>
<span class="n">nc_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="s1">&#39;Remarks&#39;</span><span class="p">])</span>

<span class="c1"># Display the summary DataFrame</span>
<span class="n">nc_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Remarks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Variable Name</td>
      <td>lake_surface_water_temperature</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Data Type</td>
      <td>int16</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Shape</td>
      <td>(366, 14, 24)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Variable Info</td>
      <td>lake_surface_water_temperature(time, lat, lon)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Units</td>
      <td>kelvin</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Long Name</td>
      <td>lake surface skin water temperature</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="export-merged-netcdf4-file-to-geotiff">
<h2>5. Export merged netCDF4 file to GeoTIFF<a class="headerlink" href="#export-merged-netcdf4-file-to-geotiff" title="Link to this heading"></a></h2>
<section id="v1-exported-geotiff-aligns-with-the-netcdf4-data-in-qgis">
<h3>5.1 V1: Exported GeoTIFF aligns with the NetCDF4 data in QGIS<a class="headerlink" href="#v1-exported-geotiff-aligns-with-the-netcdf4-data-in-qgis" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import rasterio</span>
<span class="c1"># from rasterio.transform import from_origin</span>
<span class="c1"># import netCDF4 as nc</span>

<span class="c1"># first_band = 0</span>
<span class="c1"># last_band = 363</span>
<span class="c1"># bands_to_export = range(first_band, last_band + 1)</span>
<span class="c1"># variable_name = &#39;lake_surface_water_temperature&#39;</span>
<span class="c1"># output_file = r&quot;G:/lake_surface_water_temperature_merged.tif&quot;</span>

<span class="c1"># # read</span>
<span class="c1"># dataset = nc.Dataset(nc_filepath_merged, mode=&#39;r&#39;)</span>

<span class="c1"># temperature = dataset[variable_name][:]</span>
<span class="c1"># lon_list = dataset[&#39;lon&#39;][:]</span>
<span class="c1"># lat_list = dataset[&#39;lat&#39;][:]</span>
<span class="c1"># time_var = dataset.variables[&#39;time&#39;]</span>
<span class="c1"># time_units = dataset.variables[&#39;time&#39;].units</span>
<span class="c1"># time_calendar = getattr(time_var, &quot;calendar&quot;, &quot;standard&quot;)</span>
<span class="c1"># cftime = nc.num2date(time_var[:], units=time_units, calendar=time_calendar)</span>

<span class="c1"># # transform</span>
<span class="c1"># pixel_size_lat = (lat_list.max() - lat_list.min()) / (len(lat_list) - 1)</span>
<span class="c1"># pixel_size_lon = (lon_list.max() - lon_list.min()) / (len(lon_list) - 1)</span>
<span class="c1"># transform = from_origin(lon_list.min() - pixel_size_lon / 2,</span>
<span class="c1">#                         lat_list.min() - pixel_size_lat / 2,</span>
<span class="c1">#                         pixel_size_lon,</span>
<span class="c1">#                         -pixel_size_lat</span>
<span class="c1">#                         )</span>

<span class="c1"># ## Standard transform is</span>
<span class="c1"># # transform = from_origin(lon.min(), lat.max(), pixel_size_lon, pixel_size_lat)</span>
<span class="c1"># # followed by 90deg rotation and flipping</span>
<span class="c1"># # However, this creates geotiff that is shifted by half pixel right and half pixel down</span>

<span class="c1"># # subset</span>
<span class="c1"># temperature_subset = temperature[bands_to_export, :, :]</span>
<span class="c1"># cftime_subset = cftime[bands_to_export]</span>

<span class="c1"># # metadata for geotiff</span>
<span class="c1"># meta = {</span>
<span class="c1">#     &quot;driver&quot;: &quot;GTiff&quot;,</span>
<span class="c1">#     &quot;dtype&quot;: str(temperature_subset.dtype),</span>
<span class="c1">#     &quot;nodata&quot;: -9999,</span>
<span class="c1">#     &quot;width&quot;: temperature_subset.shape[2],</span>
<span class="c1">#     &quot;height&quot;: temperature_subset.shape[1],</span>
<span class="c1">#     &quot;count&quot;: temperature_subset.shape[0],</span>
<span class="c1">#     &quot;crs&quot;: &quot;EPSG:4326&quot;,</span>
<span class="c1">#     &quot;transform&quot;: transform,</span>
<span class="c1"># }</span>

<span class="c1"># with rasterio.open(output_file, &quot;w&quot;, **meta) as dst:</span>
<span class="c1">#     for band in range(temperature_subset.shape[0]):</span>
<span class="c1">#         dst.write(temperature_subset[band, :, :], band + 1)</span>
<span class="c1">#         dst.set_band_description(band + 1, f&quot;{cftime_subset[band]}&quot;)</span>
        
<span class="c1"># print(f&quot;Merged GeoTIFF saved as {output_file}&quot;)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="v2-from-tim">
<h3>5.2 V2: From Tim<a class="headerlink" href="#v2-from-tim" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import rasterio</span>
<span class="c1"># from rasterio.transform import from_origin</span>
<span class="c1"># from rasterio.crs import CRS</span>
<span class="c1"># import numpy as np</span>
<span class="c1"># from netCDF4 import num2date</span>

<span class="c1"># crs = CRS.from_epsg(4326)</span>
<span class="c1"># ds = nc.Dataset(nc_filepath_merged, &#39;r&#39;)</span>

<span class="c1"># lat = ds.variables[&#39;lat&#39;][:]</span>
<span class="c1"># lon = ds.variables[&#39;lon&#39;][:]</span>
<span class="c1"># time_var = ds.variables[&#39;time&#39;]</span>
<span class="c1"># time_units = ds.variables[&#39;time&#39;].units</span>

<span class="c1"># pixel_size_lat = (lat.max() - lat.min()) / (len(lat) - 1)</span>
<span class="c1"># pixel_size_lon = (lon.max() - lon.min()) / (len(lon) - 1)</span>
<span class="c1"># transform = from_origin(lon.min(), lat.max(), pixel_size_lon, pixel_size_lat)</span>

<span class="c1"># unprocessed_dir = r&quot;G:/&quot;</span>

<span class="c1"># t = 341</span>
<span class="c1"># data = ds.variables[variable_name][t, :, :]</span>
<span class="c1"># data[data == data.fill_value] = -9999</span>
<span class="c1"># year = int(num2date(time_var[t], time_units).year)</span>

<span class="c1"># geotiff_path = os.path.join(unprocessed_dir, f&#39;unprocessed.tiff&#39;)</span>
<span class="c1"># with rasterio.open(</span>
<span class="c1">#     geotiff_path,</span>
<span class="c1">#     &#39;w&#39;,</span>
<span class="c1">#     driver=&#39;GTiff&#39;,</span>
<span class="c1">#     height=data.shape[0],</span>
<span class="c1">#     width=data.shape[1],</span>
<span class="c1">#     count=1,</span>
<span class="c1">#     dtype=data.dtype,</span>
<span class="c1">#     crs=crs,</span>
<span class="c1">#     transform=transform,</span>
<span class="c1">#     nodata=-9999</span>
<span class="c1"># ) as dst:</span>
<span class="c1">#     dst.write(data, 1)</span>

<span class="c1"># rotated_data = np.rot90(data, k=2)</span>
<span class="c1"># flipped_data = np.fliplr(rotated_data)</span>

<span class="c1"># processed_path = os.path.join(unprocessed_dir, f&#39;processed.tiff&#39;)</span>
<span class="c1"># with rasterio.open(</span>
<span class="c1">#     processed_path,</span>
<span class="c1">#     &#39;w&#39;,</span>
<span class="c1">#     driver=&#39;GTiff&#39;,</span>
<span class="c1">#     height=flipped_data.shape[0],</span>
<span class="c1">#     width=flipped_data.shape[1],</span>
<span class="c1">#     count=1,</span>
<span class="c1">#     dtype=flipped_data.dtype,</span>
<span class="c1">#     crs=crs,</span>
<span class="c1">#     transform=transform,</span>
<span class="c1">#     nodata=-9999</span>
<span class="c1"># ) as dst:</span>
<span class="c1">#     dst.write(flipped_data, 1)</span>
<span class="c1"># ds.close()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="v3-similar-to-tim-s-but-without-rotation-and-flip">
<h3>5.3 V3: Similar to Tim’s but without rotation and flip<a class="headerlink" href="#v3-similar-to-tim-s-but-without-rotation-and-flip" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># crs = CRS.from_epsg(4326)</span>
<span class="c1"># ds = nc.Dataset(nc_filepath_merged, &#39;r&#39;)</span>

<span class="c1"># lat = ds.variables[&#39;lat&#39;][:]</span>
<span class="c1"># lon = ds.variables[&#39;lon&#39;][:]</span>
<span class="c1"># time_var = ds.variables[&#39;time&#39;]</span>
<span class="c1"># time_units = ds.variables[&#39;time&#39;].units</span>

<span class="c1"># pixel_size_lat = (lat.max() - lat.min()) / (len(lat) - 1)</span>
<span class="c1"># pixel_size_lon = (lon.max() - lon.min()) / (len(lon) - 1)</span>

<span class="c1"># # Modified transform</span>
<span class="c1"># transform = from_origin(lon.min(), lat.min()-pixel_size_lat, pixel_size_lon, -pixel_size_lat)</span>

<span class="c1"># output_dir = r&quot;G:/&quot;</span>

<span class="c1"># t = 341</span>
<span class="c1"># data = ds.variables[variable_name][t, :, :]</span>
<span class="c1"># data[data == data.fill_value] = -9999</span>
<span class="c1"># year = int(num2date(time_var[t], time_units).year)</span>

<span class="c1"># processed_path = os.path.join(output_dir, f&#39;processed_without_rotation_and_flip.tiff&#39;)</span>
<span class="c1"># with rasterio.open(</span>
<span class="c1">#     processed_path,</span>
<span class="c1">#     &#39;w&#39;,</span>
<span class="c1">#     driver=&#39;GTiff&#39;,</span>
<span class="c1">#     height=data.shape[0],</span>
<span class="c1">#     width=data.shape[1],</span>
<span class="c1">#     count=1,</span>
<span class="c1">#     dtype=data.dtype,</span>
<span class="c1">#     crs=crs,</span>
<span class="c1">#     transform=transform,</span>
<span class="c1">#     nodata=-9999</span>
<span class="c1"># ) as dst:</span>
<span class="c1">#     dst.write(data, 1)</span>

<span class="c1"># ds.close()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="create-dataframe-and-export-as-csv">
<h2>6. Create Dataframe and Export as CSV<a class="headerlink" href="#create-dataframe-and-export-as-csv" title="Link to this heading"></a></h2>
<section id="daily-average">
<h3>4.1 Daily average<a class="headerlink" href="#daily-average" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="p">):</span>
    <span class="c1"># Open the dataset</span>
    <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
        <span class="c1"># Extract and decode time variable</span>
        <span class="n">time_var</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
        <span class="n">time_units</span> <span class="o">=</span> <span class="n">time_var</span><span class="o">.</span><span class="n">units</span>
        <span class="n">time_calendar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">time_var</span><span class="p">,</span> <span class="s2">&quot;calendar&quot;</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">)</span>
        <span class="n">cftime</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_var</span><span class="p">[:],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">time_calendar</span><span class="p">)</span>
        
        <span class="c1"># Datums- und Uhrzeitliste separat erstellen</span>
        <span class="n">date_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cftime</span><span class="p">]</span>
        <span class="n">time_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cftime</span><span class="p">]</span>
        <span class="n">date_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">date_list</span><span class="p">]</span>
        <span class="n">time_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;%H:%M:%S&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time_list</span><span class="p">]</span>

        <span class="c1"># Extract and calculate mean temperature efficiently</span>
        <span class="n">temperature_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lake_surface_water_temperature&quot;</span><span class="p">][:]</span>
        <span class="n">temperature_data_units</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lake_surface_water_temperature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="n">temperature_mean_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">temperature_std_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">nonzero_count_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">temperature_data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">lswt_uncertainty</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lswt_uncertainty&quot;</span><span class="p">][:]</span>
        <span class="n">lswt_uncertainty_units</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lswt_uncertainty&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="n">lswt_uncertainty_mean_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">lswt_uncertainty</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="n">lswt_quality_level</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lswt_quality_level&quot;</span><span class="p">][:]</span>
        <span class="n">lswt_quality_level_mean_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">lswt_quality_level</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Create DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="n">cftime</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Mean Temperature (</span><span class="si">{</span><span class="n">temperature_data_units</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">:</span> <span class="n">temperature_mean_list</span><span class="p">,</span>
                <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">:</span> <span class="n">temperature_std_list</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Uncertainty (</span><span class="si">{</span><span class="n">lswt_uncertainty_units</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">:</span> <span class="n">lswt_uncertainty_mean_list</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Quality Level&quot;</span><span class="p">:</span> <span class="n">lswt_quality_level_mean_list</span><span class="p">,</span>
                <span class="s2">&quot;Non-Zero Count&quot;</span><span class="p">:</span><span class="n">nonzero_count_list</span><span class="p">,</span>
                <span class="s2">&quot;Date&quot;</span><span class="p">:</span> <span class="n">date_objects</span><span class="p">,</span>
                <span class="s2">&quot;Time (Hour)&quot;</span><span class="p">:</span> <span class="n">time_objects</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>        

<span class="n">df</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter NaN values</span>
<span class="n">df_filterd_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Definiere den Pfad zur CSV-Datei</span>
<span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;satellite-lake-water-temperature_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">csv_path</span><span class="p">):</span>
    <span class="n">df_filterd_daily</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Summary data exported to </span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">csv_path</span><span class="si">}</span><span class="s2"> file already exists. Skipping export.&quot;</span><span class="p">)</span>

<span class="n">df_filterd_daily</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>.\data\satellite-lake-water-temperature\csv\satellite-lake-water-temperature_2008.csv file already exists. Skipping export.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean Temperature (Kelvin)</th>
      <th>Standard Deviation</th>
      <th>Uncertainty (Kelvin)</th>
      <th>Quality Level</th>
      <th>Non-Zero Count</th>
      <th>Date</th>
      <th>Time (Hour)</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2008-01-01 12:00:00</th>
      <td>276.447845</td>
      <td>1.488536</td>
      <td>0.365143</td>
      <td>3.285714</td>
      <td>14.0</td>
      <td>2008-01-01</td>
      <td>12:00:00</td>
    </tr>
    <tr>
      <th>2008-01-02 12:00:00</th>
      <td>277.639465</td>
      <td>0.882013</td>
      <td>0.313083</td>
      <td>4.250000</td>
      <td>36.0</td>
      <td>2008-01-02</td>
      <td>12:00:00</td>
    </tr>
    <tr>
      <th>2008-01-04 12:00:00</th>
      <td>276.682312</td>
      <td>0.806210</td>
      <td>0.245308</td>
      <td>3.846154</td>
      <td>13.0</td>
      <td>2008-01-04</td>
      <td>12:00:00</td>
    </tr>
    <tr>
      <th>2008-01-05 12:00:00</th>
      <td>275.202484</td>
      <td>0.584692</td>
      <td>0.275750</td>
      <td>3.000000</td>
      <td>4.0</td>
      <td>2008-01-05</td>
      <td>12:00:00</td>
    </tr>
    <tr>
      <th>2008-01-06 12:00:00</th>
      <td>276.217987</td>
      <td>2.356976</td>
      <td>0.501800</td>
      <td>1.266667</td>
      <td>15.0</td>
      <td>2008-01-06</td>
      <td>12:00:00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="plot-daily-average">
<h3>4.2 Plot daily average<a class="headerlink" href="#plot-daily-average" title="Link to this heading"></a></h3>
<blockquote>
<div><p>Note: Due to limited daily/monthly data for 2023 dataset, <strong>Plots</strong> do not work properly</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">DateFormatter</span><span class="p">,</span> <span class="n">MonthLocator</span> 
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MonthLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b, %Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">)</span> 

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">270</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lake Surface Water Temperature, </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="n">line1</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_filterd_daily</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">df_filterd_daily</span><span class="p">[</span><span class="s1">&#39;Mean Temperature (Kelvin)&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/ee32c6ace931833ee8ded7be6f943aa9e114c9ab176f1987841667bb18a3f07e.png" src="../../_images/ee32c6ace931833ee8ded7be6f943aa9e114c9ab176f1987841667bb18a3f07e.png" />
</div>
</div>
</section>
<section id="monthly-average">
<h3>5.2 Monthly average<a class="headerlink" href="#monthly-average" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_filterd_monthly</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_filterd_daily</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">df_filterd_daily</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">))[</span>
        <span class="p">[</span><span class="s2">&quot;Mean Temperature (Kelvin)&quot;</span><span class="p">,</span> <span class="s2">&quot;Uncertainty (Kelvin)&quot;</span><span class="p">,</span> <span class="s2">&quot;Quality Level&quot;</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
<span class="n">df_filterd_monthly</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Mean Temperature (Kelvin)</th>
      <th>Uncertainty (Kelvin)</th>
      <th>Quality Level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2008-01-01</td>
      <td>276.600464</td>
      <td>0.262076</td>
      <td>3.373495</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2008-02-01</td>
      <td>277.301971</td>
      <td>0.243119</td>
      <td>3.784018</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2008-03-01</td>
      <td>277.941254</td>
      <td>0.311691</td>
      <td>3.628039</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2008-04-01</td>
      <td>280.694550</td>
      <td>0.359485</td>
      <td>3.116261</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2008-05-01</td>
      <td>286.889282</td>
      <td>0.371748</td>
      <td>3.896243</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate uncertainty using Error Propagation</span>

<span class="n">df_filterd_monthly</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_filterd_daily</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">df_filterd_daily</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">))[[</span>
        <span class="s2">&quot;Mean Temperature (Kelvin)&quot;</span><span class="p">,</span> <span class="s2">&quot;Uncertainty (Kelvin)&quot;</span><span class="p">,</span> <span class="s2">&quot;Standard Deviation&quot;</span>
    <span class="p">]]</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span>
        <span class="s2">&quot;Mean Temperature (Kelvin)&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Uncertainty (Kelvin)&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
<span class="n">df_filterd_monthly</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Mean Temperature (Kelvin)</th>
      <th>Uncertainty (Kelvin)</th>
      <th>Standard Deviation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2008-01-01</td>
      <td>276.600464</td>
      <td>0.270412</td>
      <td>1.104087</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2008-02-01</td>
      <td>277.301971</td>
      <td>0.251805</td>
      <td>0.753740</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2008-03-01</td>
      <td>277.941254</td>
      <td>0.317502</td>
      <td>0.679566</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2008-04-01</td>
      <td>280.694550</td>
      <td>0.361687</td>
      <td>1.431591</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2008-05-01</td>
      <td>286.889282</td>
      <td>0.396884</td>
      <td>1.244906</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2008-06-01</td>
      <td>292.766418</td>
      <td>0.598463</td>
      <td>0.941214</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2008-07-01</td>
      <td>293.741150</td>
      <td>0.604483</td>
      <td>0.903266</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2008-08-01</td>
      <td>293.522034</td>
      <td>0.634262</td>
      <td>0.979820</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2008-09-01</td>
      <td>289.624420</td>
      <td>0.515896</td>
      <td>0.500452</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2008-10-01</td>
      <td>285.385895</td>
      <td>0.437987</td>
      <td>0.403448</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2008-11-01</td>
      <td>280.394562</td>
      <td>0.387784</td>
      <td>1.279595</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2008-12-01</td>
      <td>277.520050</td>
      <td>0.357659</td>
      <td>1.094642</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.dates</span> <span class="kn">import</span> <span class="n">DateFormatter</span><span class="p">,</span> <span class="n">MonthLocator</span> 
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MonthLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b, %Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">)</span> 

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">270</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lake Surface Water Temperature, </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span>
    <span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Mean Temperature (Kelvin)&#39;</span><span class="p">],</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">],</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o-&#39;</span><span class="p">,</span>  <span class="c1"># Marker and line style</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Temperature ± Uncertainty&#39;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>  <span class="c1"># Add caps to the error bars</span>
    <span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Thickness of error bars</span>
    <span class="n">capthick</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Thickness of caps</span>
<span class="p">)</span>

<span class="n">line1</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Mean Temperature (Kelvin)&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f9a671db90aad84b8294099c1ec209f1cd7bd22b24e13610cc5df644765ff8f1.png" src="../../_images/f9a671db90aad84b8294099c1ec209f1cd7bd22b24e13610cc5df644765ff8f1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MonthLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b, %Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">)</span> 

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">270</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperature (K)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lake Surface Water Temperature, </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="c1"># Bar plot with error bars and adjusted width</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
    <span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span>
    <span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Mean Temperature (Kelvin)&#39;</span><span class="p">],</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">df_filterd_monthly</span><span class="p">[</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean Temperature ± Uncertainty&#39;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">error_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">elinewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capthick</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c2ab0c41803292581aa4f60cc1029fe516547e52f364813bc51f857ea4fa5b84.png" src="../../_images/c2ab0c41803292581aa4f60cc1029fe516547e52f364813bc51f857ea4fa5b84.png" />
</div>
</div>
</section>
<section id="plot-using-cmap">
<h3>5.3 Plot using cmap<a class="headerlink" href="#plot-using-cmap" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Non-Zero Count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">rows_with_max_count</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Non-Zero Count&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_value</span><span class="p">]</span>
<span class="n">row_number</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Non-Zero Count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="n">row_number</span><span class="p">)</span>
<span class="n">rows_with_max_count</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>23
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean Temperature (Kelvin)</th>
      <th>Standard Deviation</th>
      <th>Uncertainty (Kelvin)</th>
      <th>Quality Level</th>
      <th>Non-Zero Count</th>
      <th>Date</th>
      <th>Time (Hour)</th>
    </tr>
    <tr>
      <th>Time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2008-01-24 12:00:00</th>
      <td>276.567902</td>
      <td>1.40774</td>
      <td>0.226417</td>
      <td>3.666667</td>
      <td>48.0</td>
      <td>2008-01-24</td>
      <td>12:00:00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FuncFormatter</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

<span class="c1"># Function to format latitude tick labels</span>
<span class="k">def</span> <span class="nf">format_latitude</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">°N&quot;</span>

<span class="c1"># Function to format longitude tick labels</span>
<span class="k">def</span> <span class="nf">format_longitude</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">°E&quot;</span>

<span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dataset</span><span class="p">:</span>
    <span class="n">variable_data</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s2">&quot;lake_surface_water_temperature&quot;</span><span class="p">]</span>
        
    <span class="n">band_data</span> <span class="o">=</span> <span class="n">variable_data</span><span class="p">[</span><span class="n">row_number</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">273.15</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">band_data</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">band_data</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span><span class="o">/</span><span class="mf">0.25</span><span class="p">)</span>
    
    <span class="c1"># Plot the data using matplotlib</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    
    <span class="c1"># Load predefined colormap</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;turbo&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
    
    <span class="c1"># Create a pseudo-color plot for the data</span>
    <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">lon_list</span><span class="p">,</span>
        <span class="n">lat_list</span><span class="p">,</span>
        <span class="n">band_data</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span>
    <span class="p">)</span>
    
    <span class="c1"># Add administrative boundary of Konstanz (Shapefile)</span>
    <span class="n">konstanz_shp</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\shapefiles\kn_boundary.shp&quot;</span>
    <span class="n">konstanz_boundary</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">konstanz_shp</span><span class="p">)</span>
    <span class="n">konstanz_boundary</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    
    <span class="c1"># Plot color bar</span>
    <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;4%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=-</span><span class="mf">1.1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s2">&quot;Long Name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (°C)&#39;</span><span class="p">)</span>
    
    <span class="c1"># Add grid lines</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#5f5f5f&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    
    <span class="c1"># Set custom tick formatters for latitude and longitude</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">format_longitude</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="n">format_latitude</span><span class="p">))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">8.8</span><span class="p">,</span><span class="mf">9.8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">47.4</span><span class="p">,</span><span class="mf">47.9</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s2">&quot;Long Name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s1"> (°C)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Latitude&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Longitude&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Display the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/8f30d308f067b0274a2ceb2995a0e088cc987def4ed11c83e2cbaed9f27ae46c.png" src="../../_images/8f30d308f067b0274a2ceb2995a0e088cc987def4ed11c83e2cbaed9f27ae46c.png" />
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="satellite-lake-water-level.html" class="btn btn-neutral float-left" title="Satellite Lake Water Levels" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sis-health-vector.html" class="btn btn-neutral float-right" title="SIS Health Vector" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, str.ucture GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>