

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Climate Indicators for Europe &mdash; CoKLIMAx 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=2bfa0ee5" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Downscaled bioclimatic indicators" href="05-sis-biodiversity-era5-regional.html" />
    <link rel="prev" title="SIS Health Vector" href="03-sis-health-vector.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CoKLIMAx
              <img src="../../_static/coklimax_logo_new.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/01-softwarekenntnisse.html">Required Software and Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/02-kurselemente.html">The Course Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/03-cds.html">The Copernicus Climate Data Store (CDS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Course 1:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/01-cds-api-installieren-und-herunterladen.html">CDS API Installation and Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/02-netcdf-einfuhrung.html">NetCDF Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Course 2:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/01-satellite-lake-water-level.html">Lake Water Levels from Satellite Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/02-satellite-lake-water-temperature.html">Lake Water Temperature from Satellite Data</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Jupyter Notebook Library:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/index.html">About CoKLIMAx-II Notebooks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../rst_jupyter_bibliothek/cds_data/index.html">CDS Dataset Notebooks </a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01-alpine-monthly-precipitation.html">Alpine monatliche Niederschlagsdaten</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-sis-heat-wave-and-cold-spells.html">Heat Wave and Cold Spells</a></li>
<li class="toctree-l2"><a class="reference internal" href="03-sis-health-vector.html">SIS Health Vector</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Climate Indicators for Europe</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#specifying-the-paths-and-working-directories">1. Specifying the paths and working directories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-and-extract-dataset">2. Download and Extract Dataset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authentication">2.1 Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#request-definition-and-download">2.2 Request Definition and Download</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-request-for-only-heat-and-cold">2.3 Define request for only heat and cold</a></li>
<li class="toctree-l4"><a class="reference internal" href="#request-defined-by-tim">2.4 Request defined by Tim</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extract-the-zip-folder">2.3 Extract the Zip folder</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#read-the-netcdf-file-and-print-the-metadata">3. Read the netCDF file and print the metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#print-unique-variable-name-s-and-available-variables">3.1 Print unique Variable name(s) and Available Variables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#export-dataset-to-csv">4. Export Dataset to CSV</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#filter-by-bounding-box-create-dataframe-and-export-as-merged-csv-file">4.1 Filter by Bounding Box, Create DataFrame and Export as merged CSV file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#error-bar-chart-for-reanalysis">Error bar chart for reanalysis</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="05-sis-biodiversity-era5-regional.html">Downscaled bioclimatic indicators</a></li>
<li class="toctree-l2"><a class="reference internal" href="06-era5-land-hourly.html">ERA5-Land Hourly Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="07-era5-land-monthly.html">ERA5-Land Monthly Averaged</a></li>
<li class="toctree-l2"><a class="reference internal" href="10-c3s-erderwaermung.html">Global Warming</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/satellite_data/index.html">Satellite Data Notebooks </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/visualizations/index.html">Visualization Options Library</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CoKLIMAx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../rst_jupyter_bibliothek/cds_data/index.html">CDS Dataset Notebooks </a></li>
      <li class="breadcrumb-item active">Climate Indicators for Europe</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/kurs_sonstiges/04-climate-indicators.ipynb.txt" rel="nofollow"> View page source</a>
<div id='language-switcher' style='text-align: right; margin-top: 10px;'>
    <select onchange="location = this.value;">
        <option value='/./CoKLIMAx-II/en/notebooks\kurs_sonstiges\04-climate-indicators.html' selected>EN</option>
        <option value='/./CoKLIMAx-II/de/notebooks\kurs_sonstiges\04-climate-indicators.html'>DE</option>
    </select>
</div>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="climate-indicators-for-europe">
<h1>Climate Indicators for Europe<a class="headerlink" href="#climate-indicators-for-europe" title="Link to this heading"></a></h1>
<p>Dieses Datenset enthält Klimadaten, die aus Reanalyse- und Modellsimulationen stammen und im Copernicus Climate Data Store (CDS) verfügbar sind. Es bietet Klimaindizes, die die Auswirkungen von Klimavariabilität und -wandel auf Sektoren wie Gesundheit, Landwirtschaft, Energie und Wasserwirtschaft beschreiben. Diese Indizes sind wichtig für die Anpassungsplanung auf europäischer und nationaler Ebene und wurden von der Europäischen Umweltagentur (EEA) entwickelt, um die Bedürfnisse nationaler Klimaanpassungsinitiativen in der EU zu erfüllen.</p>
<p>Die Indizes basieren auf Daten aus verschiedenen CDS-Datensätzen und umfassen Temperatur-, Niederschlags- und Windindikatoren. Sie wurden aus den Datensätzen „Climate and energy indicators for Europe from 2005 to 2100“ und „ERA5 hourly data on single levels from 1940 to present“ berechnet. Weitere Indizes stammen aus thematischen Projekten des CDS.</p>
<p><strong>Informationen zum Datensatz:</strong></p>
<ul class="simple">
<li><p>Source: <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/sis-ecde-climate-indicators?tab=download" rel="noopener noreferrer" target="_blank">Climate Indicators</a></p></li>
<li><p>Author: T. Tewes (City of Konstanz)</p></li>
<li><p>Notebook Version: 1.2 (Updated: December 13, 2024)</p></li>
</ul>
<blockquote>
<div><p>Zitieren: Copernicus Climate Change Service (C3S), Climate Data Store (CDS), (2024): Climate indicators for Europe from 1940 to 2100 derived from reanalysis and climate projections, Copernicus Climate Change Service (C3S) Climate Data Store (CDS). (Accessed on DD-MMM-YYYY)</p>
</div></blockquote>
<section id="specifying-the-paths-and-working-directories">
<h2>1. Specifying the paths and working directories<a class="headerlink" href="#specifying-the-paths-and-working-directories" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="sd">&#39;&#39;&#39; ---- Hier die Verzeichnisse angeben ---- &#39;&#39;&#39;</span>
<span class="n">download_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\download&quot;</span>
<span class="n">working_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\working&quot;</span>
<span class="n">geotiff_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\geotiff&quot;</span>
<span class="n">csv_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\csv&quot;</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\output&quot;</span>
<span class="sd">&#39;&#39;&#39; ----- Ende der Eingaben ---- &#39;&#39;&#39;</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-and-extract-dataset">
<h2>2. Download and Extract Dataset<a class="headerlink" href="#download-and-extract-dataset" title="Link to this heading"></a></h2>
<section id="authentication">
<h3>2.1 Authentication<a class="headerlink" href="#authentication" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cdsapi</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;fdae60fd-35d4-436f-825c-c63fedab94a4&quot;</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://cds.climate.copernicus.eu/api&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="request-definition-and-download">
<h3>2.2 Request Definition and Download<a class="headerlink" href="#request-definition-and-download" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define additional request fields to ensure the request stays within the file size limit.</span>
<span class="c1"># These coordinates were obtained using the BBox Extractor tool:</span>
<span class="c1"># https://str-ucture.github.io/bbox-extractor/</span>

<span class="n">bbox_wgs84_deutschland</span> <span class="o">=</span> <span class="p">[</span><span class="mf">56.0</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">,</span> <span class="mf">47.2</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">]</span>
<span class="n">bbox_wgs84_konstanz</span> <span class="o">=</span> <span class="p">[</span><span class="mf">47.9</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">]</span>

<span class="c1"># Alternatively, use a shapefile for precise geographic filtering</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="c1"># Example: Load shapefile of Konstanz (WGS84 projection)</span>
<span class="n">de_shapefile</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;./shapefiles/de_boundary.shp&quot;</span>
<span class="n">de_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">de_shapefile</span><span class="p">)</span>
<span class="n">de_bounds</span> <span class="o">=</span> <span class="n">de_gdf</span><span class="o">.</span><span class="n">total_bounds</span>

<span class="c1"># Adjust and buffer</span>
<span class="n">de_bounds_adjusted</span> <span class="o">=</span> <span class="p">[(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">de_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">de_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">de_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">de_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">]</span>

<span class="n">bbox_de_bounds_adjusted</span> <span class="o">=</span> <span class="p">[</span><span class="n">de_bounds_adjusted</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">de_bounds_adjusted</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">de_bounds_adjusted</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">de_bounds_adjusted</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>

<span class="n">bbox_de_bounds_adjusted</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[55.2, 5.7, 47.1, 15.2]
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-request-for-only-heat-and-cold">
<h3>2.3 Define request for only heat and cold<a class="headerlink" href="#define-request-for-only-heat-and-cold" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Origin = reanalysis</span>
<span class="c1"># dataset = &quot;sis-ecde-climate-indicators&quot;</span>
<span class="c1"># request = {</span>
<span class="c1">#     &quot;variable&quot;: [</span>
<span class="c1">#         &quot;mean_temperature&quot;,</span>
<span class="c1">#         &quot;growing_degree_days&quot;,</span>
<span class="c1">#         &quot;heating_degree_days&quot;,</span>
<span class="c1">#         &quot;cooling_degree_days&quot;,</span>
<span class="c1">#         &quot;tropical_nights&quot;,</span>
<span class="c1">#         &quot;hot_days&quot;,</span>
<span class="c1">#         &quot;warmest_three_day_period&quot;,</span>
<span class="c1">#         &quot;heatwave_days&quot;,</span>
<span class="c1">#         &quot;high_utci_days&quot;,</span>
<span class="c1">#         &quot;frost_days&quot;,</span>
<span class="c1">#         &quot;daily_maximum_temperature&quot;,</span>
<span class="c1">#         &quot;daily_minimum_temperature&quot;</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;origin&quot;: &quot;reanalysis&quot;,</span>
<span class="c1">#     &quot;temporal_aggregation&quot;: [&quot;yearly&quot;],</span>
<span class="c1">#     &quot;spatial_aggregation&quot;: &quot;gridded&quot;,</span>
<span class="c1">#     &quot;other_parameters&quot;: [</span>
<span class="c1">#         &quot;30_c&quot;,</span>
<span class="c1">#         &quot;35_c&quot;,</span>
<span class="c1">#         &quot;40_c&quot;,</span>
<span class="c1">#         &quot;max&quot;,</span>
<span class="c1">#         &quot;mean&quot;,</span>
<span class="c1">#         &quot;min&quot;</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;area&quot;: bbox_de_bounds_adjusted</span>
<span class="c1"># }</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Origin = projections</span>
<span class="c1"># dataset = &quot;sis-ecde-climate-indicators&quot;</span>
<span class="c1"># request = {</span>
<span class="c1">#     &quot;variable&quot;: [</span>
<span class="c1">#         &quot;mean_temperature&quot;,</span>
<span class="c1">#         &quot;growing_degree_days&quot;,</span>
<span class="c1">#         &quot;heating_degree_days&quot;,</span>
<span class="c1">#         &quot;cooling_degree_days&quot;,</span>
<span class="c1">#         &quot;tropical_nights&quot;,</span>
<span class="c1">#         &quot;hot_days&quot;,</span>
<span class="c1">#         &quot;warmest_three_day_period&quot;,</span>
<span class="c1">#         &quot;heatwave_days&quot;,</span>
<span class="c1">#         &quot;frost_days&quot;,</span>
<span class="c1">#         &quot;daily_maximum_temperature&quot;,</span>
<span class="c1">#         &quot;daily_minimum_temperature&quot;</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;origin&quot;: &quot;projections&quot;,</span>
<span class="c1">#     &quot;gcm&quot;: [&quot;mpi_esm_lr&quot;],</span>
<span class="c1">#     &quot;rcm&quot;: [&quot;cclm4_8_17&quot;],</span>
<span class="c1">#     &quot;experiment&quot;: [</span>
<span class="c1">#         &quot;rcp4_5&quot;,</span>
<span class="c1">#         &quot;rcp8_5&quot;</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;ensemble_member&quot;: [&quot;r1i1p1&quot;],</span>
<span class="c1">#     &quot;temporal_aggregation&quot;: [&quot;yearly&quot;],</span>
<span class="c1">#     &quot;spatial_aggregation&quot;: &quot;gridded&quot;,</span>
<span class="c1">#     &quot;other_parameters&quot;: [</span>
<span class="c1">#         &quot;30_c&quot;,</span>
<span class="c1">#         &quot;35_c&quot;,</span>
<span class="c1">#         &quot;40_c&quot;,</span>
<span class="c1">#         &quot;max&quot;,</span>
<span class="c1">#         &quot;mean&quot;,</span>
<span class="c1">#         &quot;min&quot;</span>
<span class="c1">#     ],</span>
<span class="c1">#     &quot;area&quot;: bbox_de_bounds_adjusted</span>
<span class="c1"># }</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># variable_group = &#39;heat_and_cold&#39;</span>
<span class="c1"># # Uncomment and run this cell to download the dataset:</span>

<span class="c1"># def main_retrieve():</span>
<span class="c1">#     dataset_filename = f&quot;{dataset}_{variable_group}_{request[&#39;origin&#39;]}_{request[&#39;temporal_aggregation&#39;][0]}.zip&quot;</span>
<span class="c1">#     dataset_filepath = os.path.join(download_folder, dataset_filename)</span>

<span class="c1">#     # Download the dataset only if the dataset has not been downloaded before</span>
<span class="c1">#     if not os.path.isfile(dataset_filepath):</span>
<span class="c1">#         # Download the dataset with the defined request parameters</span>
<span class="c1">#         client.retrieve(dataset, request, dataset_filepath)</span>
<span class="c1">#     else:</span>
<span class="c1">#         print(&quot;Dataset already downloaded.&quot;)</span>

<span class="c1"># if __name__ == &quot;__main__&quot;:</span>
<span class="c1">#     client = main()</span>
<span class="c1">#     main_retrieve()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="request-defined-by-tim">
<h3>2.4 Request defined by Tim<a class="headerlink" href="#request-defined-by-tim" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;sis-ecde-climate-indicators&quot;</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;growing_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;heating_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cooling_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tropical_nights&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hot_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;warmest_three_day_period&quot;</span><span class="p">,</span>
        <span class="s2">&quot;heatwave_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;high_utci_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frost_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;total_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;maximum_consecutive_five_day_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extreme_precipitation_total&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frequency_of_extreme_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;consecutive_dry_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;duration_of_meteorological_droughts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;magnitude_of_meteorological_droughts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;days_with_high_fire_danger&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extreme_wind_speed_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fire_weather_index&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;reanalysis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;temporal_aggregation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;yearly&quot;</span><span class="p">],</span>
    <span class="s2">&quot;spatial_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;gridded&quot;</span><span class="p">,</span>
    <span class="s2">&quot;other_parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;30_c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;35_c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;40_c&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">bbox_de_bounds_adjusted</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;sis-ecde-climate-indicators&quot;</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;growing_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;heating_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cooling_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tropical_nights&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hot_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;warmest_three_day_period&quot;</span><span class="p">,</span>
        <span class="s2">&quot;heatwave_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frost_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;total_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;maximum_consecutive_five_day_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extreme_precipitation_total&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frequency_of_extreme_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;consecutive_dry_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;duration_of_meteorological_droughts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;magnitude_of_meteorological_droughts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;days_with_high_fire_danger&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extreme_wind_speed_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fire_weather_index&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;projections&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gcm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mpi_esm_lr&quot;</span><span class="p">],</span>
    <span class="s2">&quot;rcm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cclm4_8_17&quot;</span><span class="p">],</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;rcp4_5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rcp8_5&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;ensemble_member&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;r1i1p1&quot;</span><span class="p">],</span>
    <span class="s2">&quot;temporal_aggregation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;yearly&quot;</span><span class="p">],</span>
    <span class="s2">&quot;spatial_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;gridded&quot;</span><span class="p">,</span>
    <span class="s2">&quot;other_parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;30_c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;35_c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;40_c&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">bbox_de_bounds_adjusted</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run this cell to download the dataset:</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main_retrieve</span><span class="p">():</span>
    <span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.zip&quot;</span>
    <span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>

    <span class="c1"># Download the dataset only if the dataset has not been downloaded before</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">):</span>
        <span class="c1"># Download the dataset with the defined request parameters</span>
        <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset already downloaded.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
    <span class="n">main_retrieve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-02-24 11:55:55,894 INFO [2024-09-26T00:00:00] Watch our [Forum](https://forum.ecmwf.int/) for Announcements, news and other discussed topics.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-02-24 11:55:55,895 WARNING [2024-06-16T00:00:00] CDS API syntax is changed and some keys or parameter names may have also changed. To avoid requests failing, please use the &quot;Show API request code&quot; tool on the dataset Download Form to check you are using the correct syntax for your API request.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already downloaded.
</pre></div>
</div>
</div>
</div>
</section>
<section id="extract-the-zip-folder">
<h3>2.3 Extract the Zip folder<a class="headerlink" href="#extract-the-zip-folder" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

<span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.zip&quot;</span>
<span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>

<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># Extract the zip file</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
            <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully extracted files to: </span><span class="si">{</span><span class="n">extract_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Folder is not empty. Skipping extraction.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: The file </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> was not found.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: The file </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> is not a valid zip file.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Folder is not empty. Skipping extraction.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="read-the-netcdf-file-and-print-the-metadata">
<h2>3. Read the netCDF file and print the metadata<a class="headerlink" href="#read-the-netcdf-file-and-print-the-metadata" title="Link to this heading"></a></h2>
<p>Note: select the origin here</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;projections&quot;</span> <span class="c1"># projections or reanalysis</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>

<span class="k">def</span><span class="w"> </span><span class="nf">meta</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?P&lt;index&gt;\w+?)_(?P&lt;ds_variable&gt;[a-zA-Z_]+?)-(?P&lt;ds_origin&gt;\w+?)-(?P&lt;ds_temporal_aggregation&gt;\w+)(?:-(?P&lt;ds_stat&gt;min|max|mean))?(?:-(?P&lt;ds_grid&gt;\d+deg))?(?:-(?P&lt;ds_rcp&gt;rcp_\d+_\d+))?&quot;</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?P&lt;index&gt;\w+?)_(?P&lt;ds_variable&gt;[a-zA-Z_]+?)-(?P&lt;ds_origin&gt;\w+?)-(?P&lt;ds_temporal_aggregation&gt;\w+)(?:-(?P&lt;ds_stat&gt;min|max|mean))?(?:-(?P&lt;ds_grid&gt;\d+deg))?(?:-(?P&lt;ds_rcp&gt;rcp_\d+_\d+))?&quot;</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_nc_variable</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>
            <span class="n">nc_variable_name</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="n">nc_variable_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>
        <span class="c1"># index=match.group(&#39;index&#39;),</span>
        <span class="n">ds_variable</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_variable&#39;</span><span class="p">),</span>
        <span class="n">ds_origin</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_origin&#39;</span><span class="p">),</span>
        <span class="n">ds_temporal_aggregation</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_temporal_aggregation&#39;</span><span class="p">),</span>
        <span class="c1"># ds_stat=match.group(&#39;ds_stat&#39;),</span>
        <span class="n">variable_name</span><span class="o">=</span><span class="n">get_nc_variable</span><span class="p">(),</span>
        <span class="n">ds_grid</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_grid&#39;</span><span class="p">),</span>
        <span class="n">ds_rcp</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_rcp&#39;</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># Create DataFrame from the list of files inside the extracted directory</span>
<span class="n">nc_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">meta</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>
<span class="n">df_nc_files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">nc_files</span><span class="p">)</span>

<span class="c1"># Modify pandas display options</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_colwidth</span> <span class="o">=</span> <span class="mi">24</span>

<span class="c1"># Display the DataFrame</span>
<span class="n">df_nc_files</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_nc_files</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filename</th>
      <th>ds_variable</th>
      <th>ds_origin</th>
      <th>ds_temporal_aggregation</th>
      <th>variable_name</th>
      <th>ds_grid</th>
      <th>ds_rcp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>02_growing_degree_da...</td>
      <td>growing_degree_days</td>
      <td>projections</td>
      <td>yearly</td>
      <td>tasAdjust</td>
      <td>None</td>
      <td>rcp_4_5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>02_growing_degree_da...</td>
      <td>growing_degree_days</td>
      <td>projections</td>
      <td>yearly</td>
      <td>tasAdjust</td>
      <td>None</td>
      <td>rcp_8_5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>03_heating_degree_da...</td>
      <td>heating_degree_days</td>
      <td>projections</td>
      <td>yearly</td>
      <td>data</td>
      <td>None</td>
      <td>rcp_4_5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>03_heating_degree_da...</td>
      <td>heating_degree_days</td>
      <td>projections</td>
      <td>yearly</td>
      <td>data</td>
      <td>None</td>
      <td>rcp_8_5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>04_cooling_degree_da...</td>
      <td>cooling_degree_days</td>
      <td>projections</td>
      <td>yearly</td>
      <td>data</td>
      <td>None</td>
      <td>rcp_4_5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="print-unique-variable-name-s-and-available-variables">
<h3>3.1 Print unique Variable name(s) and Available Variables<a class="headerlink" href="#print-unique-variable-name-s-and-available-variables" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>

<span class="n">seen_variables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nc_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nc_files</span><span class="p">):</span>
    <span class="n">variable_name</span> <span class="o">=</span> <span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="n">seen_variables</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="c1"># Open the NetCDF file in read mode</span>
    <span class="n">nc_dataset</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

    <span class="c1"># List all variables in the dataset</span>
    <span class="n">variables_list</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s2">&lt;2</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">variable_name</span><span class="si">:</span><span class="s2">&lt;18</span><span class="si">}</span><span class="s2">: Available variables: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">variables_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Add the variable name to the seen set</span>
    <span class="n">seen_variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1  tasAdjust         : Available variables: [&#39;tasAdjust&#39;, &#39;time&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;height&#39;]
3  data              : Available variables: [&#39;data&#39;, &#39;time&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;height&#39;]
7  tasAdjust_NON_CDM : Available variables: [&#39;tasAdjust_NON_CDM&#39;, &#39;time&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;height&#39;]
21 prAdjust          : Available variables: [&#39;prAdjust&#39;, &#39;time&#39;, &#39;lat&#39;, &#39;lon&#39;]
29 cdd               : Available variables: [&#39;cdd&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;time&#39;]
31 dmd               : Available variables: [&#39;dmd&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;time&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">seen_variables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nc_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nc_files</span><span class="p">):</span>
    <span class="n">variable_name</span> <span class="o">=</span> <span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="n">seen_variables</span><span class="p">:</span>
        <span class="k">continue</span>
    
    <span class="n">nc_dataset</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
    
    <span class="c1"># Generate summary of the primary variable</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Variable Name&quot;</span><span class="p">:</span> <span class="n">variable_name</span><span class="p">,</span>
        <span class="s2">&quot;Data Type&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
        <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
        <span class="s2">&quot;Variable Info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variable_data</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Units&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
        <span class="s2">&quot;Long Name&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
    <span class="p">}</span>
    
    <span class="c1"># Display dataset summary as a DataFrame for better visualization</span>
    <span class="n">nc_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="s1">&#39;Remarks&#39;</span><span class="p">])</span>

    <span class="c1"># Display the summary DataFrame</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">nc_summary</span><span class="p">)</span>
    
    <span class="c1"># Add the variable name to the seen set</span>
    <span class="n">seen_variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1. tasAdjust:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Remarks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Variable Name</td>
      <td>tasAdjust</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Data Type</td>
      <td>float32</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Shape</td>
      <td>(151, 32, 38)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Variable Info</td>
      <td>tasAdjust(time, lat,...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Units</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Long Name</td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3. data:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Remarks</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Variable Name</td>
      <td>data</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Data Type</td>
      <td>float32</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Shape</td>
      <td>(151, 32, 38)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Variable Info</td>
      <td>data(time, lat, lon)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Units</td>
      <td>K</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Long Name</td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="export-dataset-to-csv">
<h2>4. Export Dataset to CSV<a class="headerlink" href="#export-dataset-to-csv" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="c1"># Open the NetCDF dataset using xarray</span>
<span class="k">def</span><span class="w"> </span><span class="nf">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>
        <span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]]</span>
        
        <span class="c1"># Ensure latitude and longitude names are correct</span>
        <span class="n">latitude_name</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span> <span class="k">if</span> <span class="s1">&#39;latitude&#39;</span> <span class="ow">in</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">coords</span> <span class="k">else</span> <span class="s1">&#39;lat&#39;</span>
        <span class="n">longitude_name</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span> <span class="k">if</span> <span class="s1">&#39;longitude&#39;</span> <span class="ow">in</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">coords</span> <span class="k">else</span> <span class="s1">&#39;lon&#39;</span>
        
        <span class="k">if</span> <span class="n">bounding_box</span><span class="p">:</span>
            <span class="c1"># Filter the data based on latitude and longitude</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="n">latitude_name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="n">latitude_name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="n">longitude_name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="n">longitude_name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="n">drop</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">variable_data</span>

        <span class="c1"># Convert the xarray dataset to a pandas DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">latitude_name</span><span class="p">,</span> <span class="n">longitude_name</span><span class="p">])</span>
        
        <span class="c1"># Rename the value column to &quot;test value&quot;</span>
        <span class="c1"># ds_origin = nc_file[&#39;ds_origin&#39;]</span>
        <span class="c1"># if ds_origin == &quot;projections&quot;:</span>
        <span class="c1">#     df.rename(columns={nc_file[&#39;variable_name&#39;]: nc_file[&#39;ds_variable&#39;] + &#39; (&#39; + nc_file[&#39;ds_rcp&#39;] + &#39;)&#39;}, inplace=True)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     df.rename(columns={nc_file[&#39;variable_name&#39;]: nc_file[&#39;ds_variable&#39;]}, inplace=True)        </span>
        <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<section id="filter-by-bounding-box-create-dataframe-and-export-as-merged-csv-file">
<h3>4.1 Filter by Bounding Box, Create DataFrame and Export as merged CSV file<a class="headerlink" href="#filter-by-bounding-box-create-dataframe-and-export-as-merged-csv-file" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define additional request fields to ensure the request stays within the file size limit.</span>
<span class="c1"># These coordinates were obtained using the BBox Extractor tool:</span>
<span class="c1"># https://str-ucture.github.io/bbox-extractor/</span>

<span class="n">bbox_wgs84_konstanz</span> <span class="o">=</span> <span class="p">[</span><span class="mf">47.9</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">]</span>  <span class="c1"># Format: [North, West, South, East]</span>
<span class="n">bbox_wgs84_konstanz_standard</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">47.8</span><span class="p">]</span>  <span class="c1"># Standard format: [West, South, East, North]</span>
<span class="n">bbox_wgs84_de_standard</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.7</span><span class="p">,</span> <span class="mf">47.1</span><span class="p">,</span> <span class="mf">15.2</span><span class="p">,</span> <span class="mf">55.2</span><span class="p">]</span>  <span class="c1"># Standard format: [West, South, East, North]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Export all netCDF4 files to individual csv files (currently overwrites)</span>
<span class="n">subset_csv_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">subset_csv_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">nc_file</span> <span class="ow">in</span> <span class="n">nc_files</span><span class="p">:</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file</span><span class="p">)</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subset_csv_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">))</span>

<span class="n">dataframe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\ShaileshShrestha\AppData\Local\Temp\ipykernel_33212\4128605723.py:5: FutureWarning: In a future version of xarray decode_timedelta will default to False rather than None. To silence this warning, set decode_timedelta to True, False, or a &#39;CFTimedeltaCoder&#39; instance.
  with xr.open_dataset(nc_file[&#39;path&#39;]) as nc_dataset:
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">line</span> <span class="mi">7</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">for</span> <span class="n">nc_file</span> <span class="ow">in</span> <span class="n">nc_files</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">dataframe</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">7</span>     <span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subset_csv_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">))</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">dataframe</span>

<span class="nn">File c:\Users\ShaileshShrestha\anaconda3\envs\cds_env\lib\site-packages\pandas\util\_decorators.py:333,</span> in <span class="ni">deprecate_nonkeyword_arguments.&lt;locals&gt;.decorate.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">num_allow_args</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>     <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span>         <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">_format_argument_list</span><span class="p">(</span><span class="n">allow_args</span><span class="p">)),</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span>         <span class="ne">FutureWarning</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span>         <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">(),</span>
<span class="g g-Whitespace">    </span><span class="mi">332</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">333</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File c:\Users\ShaileshShrestha\anaconda3\envs\cds_env\lib\site-packages\pandas\core\generic.py:3967,</span> in <span class="ni">NDFrame.to_csv</span><span class="nt">(self, path_or_buf, sep, na_rep, float_format, columns, header, index, index_label, mode, encoding, compression, quoting, quotechar, lineterminator, chunksize, date_format, doublequote, escapechar, decimal, errors, storage_options)</span>
<span class="g g-Whitespace">   </span><span class="mi">3956</span> <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ABCDataFrame</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">3958</span> <span class="n">formatter</span> <span class="o">=</span> <span class="n">DataFrameFormatter</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3959</span>     <span class="n">frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3960</span>     <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3964</span>     <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3965</span> <span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3967</span> <span class="k">return</span> <span class="n">DataFrameRenderer</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3968</span>     <span class="n">path_or_buf</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3969</span>     <span class="n">lineterminator</span><span class="o">=</span><span class="n">lineterminator</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3970</span>     <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3971</span>     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3972</span>     <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3973</span>     <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3974</span>     <span class="n">quoting</span><span class="o">=</span><span class="n">quoting</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3975</span>     <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3976</span>     <span class="n">index_label</span><span class="o">=</span><span class="n">index_label</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3977</span>     <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3978</span>     <span class="n">chunksize</span><span class="o">=</span><span class="n">chunksize</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3979</span>     <span class="n">quotechar</span><span class="o">=</span><span class="n">quotechar</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3980</span>     <span class="n">date_format</span><span class="o">=</span><span class="n">date_format</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3981</span>     <span class="n">doublequote</span><span class="o">=</span><span class="n">doublequote</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3982</span>     <span class="n">escapechar</span><span class="o">=</span><span class="n">escapechar</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3983</span>     <span class="n">storage_options</span><span class="o">=</span><span class="n">storage_options</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3984</span> <span class="p">)</span>

<span class="nn">File c:\Users\ShaileshShrestha\anaconda3\envs\cds_env\lib\site-packages\pandas\io\formats\format.py:1014,</span> in <span class="ni">DataFrameRenderer.to_csv</span><span class="nt">(self, path_or_buf, encoding, sep, columns, index_label, mode, compression, quoting, quotechar, lineterminator, chunksize, date_format, doublequote, escapechar, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">993</span>     <span class="n">created_buffer</span> <span class="o">=</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">995</span> <span class="n">csv_formatter</span> <span class="o">=</span> <span class="n">CSVFormatter</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">996</span>     <span class="n">path_or_buf</span><span class="o">=</span><span class="n">path_or_buf</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">997</span>     <span class="n">lineterminator</span><span class="o">=</span><span class="n">lineterminator</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1012</span>     <span class="n">formatter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fmt</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1013</span> <span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1014</span> <span class="n">csv_formatter</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1016</span> <span class="k">if</span> <span class="n">created_buffer</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1017</span>     <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">)</span>

<span class="nn">File c:\Users\ShaileshShrestha\anaconda3\envs\cds_env\lib\site-packages\pandas\io\formats\csvs.py:270,</span> in <span class="ni">CSVFormatter.save</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span> <span class="k">with</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span>     <span class="bp">self</span><span class="o">.</span><span class="n">filepath_or_buffer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span>     <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span> <span class="p">)</span> <span class="k">as</span> <span class="n">handles</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">259</span>     <span class="c1"># Note: self.encoding is irrelevant here</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span>     <span class="bp">self</span><span class="o">.</span><span class="n">writer</span> <span class="o">=</span> <span class="n">csvlib</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>         <span class="n">handles</span><span class="o">.</span><span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">262</span>         <span class="n">lineterminator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lineterminator</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">267</span>         <span class="n">quotechar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quotechar</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">268</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">270</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_save</span><span class="p">()</span>

<span class="nn">File c:\Users\ShaileshShrestha\anaconda3\envs\cds_env\lib\site-packages\pandas\io\formats\csvs.py:275,</span> in <span class="ni">CSVFormatter._save</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">273</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_need_to_save_header</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_save_header</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">275</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_body</span><span class="p">()</span>

<span class="nn">File c:\Users\ShaileshShrestha\anaconda3\envs\cds_env\lib\site-packages\pandas\io\formats\csvs.py:313,</span> in <span class="ni">CSVFormatter._save_body</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">311</span> <span class="k">if</span> <span class="n">start_i</span> <span class="o">&gt;=</span> <span class="n">end_i</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span>     <span class="k">break</span>
<span class="ne">--&gt; </span><span class="mi">313</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_chunk</span><span class="p">(</span><span class="n">start_i</span><span class="p">,</span> <span class="n">end_i</span><span class="p">)</span>

<span class="nn">File c:\Users\ShaileshShrestha\anaconda3\envs\cds_env\lib\site-packages\pandas\io\formats\csvs.py:324,</span> in <span class="ni">CSVFormatter._save_chunk</span><span class="nt">(self, start_i, end_i)</span>
<span class="g g-Whitespace">    </span><span class="mi">321</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">_iter_column_arrays</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">323</span> <span class="n">ix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_index</span><span class="p">[</span><span class="n">slicer</span><span class="p">]</span><span class="o">.</span><span class="n">_get_values_for_csv</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_number_format</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">324</span> <span class="n">libwriters</span><span class="o">.</span><span class="n">write_csv_rows</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">325</span>     <span class="n">data</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span>     <span class="n">ix</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span>     <span class="bp">self</span><span class="o">.</span><span class="n">nlevels</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>     <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span>     <span class="bp">self</span><span class="o">.</span><span class="n">writer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span> <span class="p">)</span>

<span class="nn">File writers.pyx:65,</span> in <span class="ni">pandas._libs.writers.write_csv_rows</span><span class="nt">()</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ipywidgets</span>
<span class="c1"># Extract data from netCDF4 files from specific ds_variable</span>

<span class="n">ds_variable_list</span> <span class="o">=</span> <span class="n">df_nc_files</span><span class="p">[</span><span class="s1">&#39;ds_variable&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="n">selected_ds_variable</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="n">ds_variable_list</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Select a variable:&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">selected_ds_variable</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "10646cc6de9441ea84d0a8028db823f3", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get data from reanalysis and projections for selected ds_variable and create a combined csv file</span>

<span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;reanalysis&quot;</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">nc_files_reanalysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">meta</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>

<span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;projections&quot;</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">nc_files_projections</span> <span class="o">=</span> <span class="p">[</span><span class="n">meta</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>

<span class="n">nc_files_merged</span> <span class="o">=</span>  <span class="n">nc_files_reanalysis</span> <span class="o">+</span> <span class="n">nc_files_projections</span>
<span class="n">df_nc_files_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">nc_files_merged</span><span class="p">)</span>

<span class="n">df_nc_files_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_nc_files_merged</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filename</th>
      <th>ds_variable</th>
      <th>ds_origin</th>
      <th>ds_temporal_aggregation</th>
      <th>variable_name</th>
      <th>ds_grid</th>
      <th>ds_rcp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>03_heating_degree_da...</td>
      <td>heating_degree_days</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>data</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>03_heating_degree_da...</td>
      <td>heating_degree_days</td>
      <td>projections</td>
      <td>yearly</td>
      <td>data</td>
      <td>None</td>
      <td>rcp_4_5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>03_heating_degree_da...</td>
      <td>heating_degree_days</td>
      <td>projections</td>
      <td>yearly</td>
      <td>data</td>
      <td>None</td>
      <td>rcp_8_5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nc_file_reanalysis</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">nc_file_proj_rcp45</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">nc_file_proj_rcp85</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Extract the nc_file_reanalysis, nc_file_proj_rcp45, nc_file_proj_rcp85 rows</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">nc_files_merged</span><span class="p">:</span>
    <span class="c1"># Extract first row where ds_origin == &#39;reanalysis&#39;</span>
    <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_origin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;reanalysis&#39;</span> <span class="ow">and</span> <span class="n">nc_file_reanalysis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nc_file_reanalysis</span> <span class="o">=</span> <span class="n">file</span>
    
    <span class="c1"># Extract first row where ds_origin == &#39;projections&#39; and ds_rcp == &#39;rcp_4_5&#39;</span>
    <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_origin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="ow">and</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_rcp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rcp_4_5&#39;</span> <span class="ow">and</span> <span class="n">nc_file_proj_rcp45</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nc_file_proj_rcp45</span> <span class="o">=</span> <span class="n">file</span>
    
    <span class="c1"># Extract first row where ds_origin == &#39;projections&#39; and ds_rcp == &#39;rcp_8_5&#39;</span>
    <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_origin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="ow">and</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_rcp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rcp_8_5&#39;</span> <span class="ow">and</span> <span class="n">nc_file_proj_rcp85</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nc_file_proj_rcp85</span> <span class="o">=</span> <span class="n">file</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="error-bar-chart-for-reanalysis">
<h3>Error bar chart for reanalysis<a class="headerlink" href="#error-bar-chart-for-reanalysis" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Farben</span>
<span class="n">color1</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span> <span class="c1">#Reanalyse</span>
<span class="n">color2</span> <span class="o">=</span> <span class="s2">&quot;#005d82&quot;</span> <span class="c1">#RCP4.5</span>
<span class="n">color3</span> <span class="o">=</span> <span class="s2">&quot;#ce1657&quot;</span> <span class="c1">#RCP8.5</span>

<span class="c1"># Darstellung der Reanalyse-Daten</span>
<span class="n">design_reanalyse</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Reanalyse&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color1</span><span class="p">,</span>
    <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der RCP4.5-Daten</span>
<span class="n">design_rcp45</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;RCP4.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color2</span><span class="p">,</span>
    <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der RCP8.5-Daten</span>
<span class="n">design_rcp85</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;RCP8.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color3</span><span class="p">,</span>
    <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der Trendlinie RCP4.5</span>
<span class="n">design_rcp45_trend</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Trend RCP4.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color2</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der Trendlinie RCP8.5</span>
<span class="n">design_rcp85_trend</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Trend RCP8.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color3</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der Trennline zwischen Reanalyse und Projektionsdaten</span>
<span class="n">datum_trennlinie</span> <span class="o">=</span> <span class="s1">&#39;2024-01-01&#39;</span> <span class="c1"># wenn neuere Reanalyse-Daten vorliegen, müsste dieses Datum angepasst werden</span>
<span class="n">design_trennlinie</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;grey&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">2.5</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Parameters for reference year</span>
<span class="n">start_year</span> <span class="o">=</span> <span class="mi">1971</span>
<span class="n">end_year</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="c1"># Load the nc_file_reanalysis and convert it to a DataFrame</span>
<span class="n">variable_name_reanalysis</span> <span class="o">=</span> <span class="n">nc_file_reanalysis</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file_reanalysis</span><span class="p">,</span>
                                    <span class="n">bounding_box</span><span class="o">=</span><span class="n">bbox_wgs84_konstanz_standard</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Filter the DataFrame for the reference period</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_reanalysis_ref_period</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span>
                                         <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>

<span class="c1"># Calculate the mean value for the reference period and the anomaly</span>
<span class="n">reference_mean</span> <span class="o">=</span> <span class="n">df_reanalysis_ref_period</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df_reanalysis</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">]</span> <span class="o">-</span> <span class="n">reference_mean</span>

<span class="n">df_reanalysis_yearly_mean</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_reanalysis</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">df_reanalysis_yearly_mean</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>realization</th>
      <th>data</th>
      <th>anomaly</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1940</th>
      <td>1940-01-01</td>
      <td>0.0</td>
      <td>3363.033203</td>
      <td>686.089111</td>
    </tr>
    <tr>
      <th>1941</th>
      <td>1941-01-01</td>
      <td>0.0</td>
      <td>3308.758789</td>
      <td>631.814575</td>
    </tr>
    <tr>
      <th>1942</th>
      <td>1942-01-01</td>
      <td>0.0</td>
      <td>3150.089844</td>
      <td>473.145874</td>
    </tr>
    <tr>
      <th>1943</th>
      <td>1943-01-01</td>
      <td>0.0</td>
      <td>2718.500977</td>
      <td>41.556763</td>
    </tr>
    <tr>
      <th>1944</th>
      <td>1944-01-01</td>
      <td>0.0</td>
      <td>3084.551758</td>
      <td>407.607666</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Plot negative values</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
       <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
       <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#005d82&#39;</span><span class="p">,</span>
       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Negative Deviation&#39;</span><span class="p">)</span>

<span class="c1"># Plot positive values</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
       <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
       <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#ce1657&#39;</span><span class="p">,</span>
       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Positive Deviation&#39;</span><span class="p">)</span>

<span class="c1"># Add zero line</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Set axis labels and title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean annual anomaly&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference Period </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Anomaly in </span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="mf">0.52</span><span class="p">)</span>

<span class="c1"># Add grid</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># X-axis: Show all 5-year intervals</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                      <span class="n">end</span><span class="o">=</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                      <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Add description</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.035</span><span class="p">,</span>
    <span class="p">(</span>
       <span class="s1">&#39;Quelle: Copernicus Climate Change Service (C3S),&#39;</span>
       <span class="s1">&#39;Climate Data Store (CDS), (2024): Climate indicators for Europe from 1940 to 2100&#39;</span>
       <span class="s1">&#39;derived from reanalysis and climate projections,&#39;</span>
       <span class="s1">&#39;Copernicus Climate Change Service (C3S) Climate Data Store (CDS).&#39;</span>
       <span class="s1">&#39;(Accessed on 01-08-2024)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Adjust layout and show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/63a8c28887872abc1be6b704aa7451e2556e3bbe59345dd4fd4a61b91f3c2553.png" src="../../_images/63a8c28887872abc1be6b704aa7451e2556e3bbe59345dd4fd4a61b91f3c2553.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="c1">#  Create a plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># Plot the trend line</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
               <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
        <span class="n">p</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trend&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color1</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

<span class="c1"># Set axis labels and title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean annual&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference Period: </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annual </span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="mf">0.52</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Add grid</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># X-axis: Show all 5-year intervals</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                      <span class="n">end</span><span class="o">=</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                      <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Add description</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.035</span><span class="p">,</span>
    <span class="p">(</span>
       <span class="s1">&#39;Quelle: Copernicus Climate Change Service (C3S),&#39;</span>
       <span class="s1">&#39;Climate Data Store (CDS), (2024): Climate indicators for Europe from 1940 to 2100&#39;</span>
       <span class="s1">&#39;derived from reanalysis and climate projections,&#39;</span>
       <span class="s1">&#39;Copernicus Climate Change Service (C3S) Climate Data Store (CDS).&#39;</span>
       <span class="s1">&#39;(Accessed on 01-08-2024)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Adjust layout and show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1d4057a614441b8d86b0f638847ca95b882db91634256ad27c9474889e02e5c7.png" src="../../_images/1d4057a614441b8d86b0f638847ca95b882db91634256ad27c9474889e02e5c7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define</span>
<span class="n">start_year</span> <span class="o">=</span> <span class="mi">1940</span>
<span class="n">intermediate_year</span> <span class="o">=</span> <span class="mi">2023</span>
<span class="n">end_year</span> <span class="o">=</span> <span class="mi">2100</span>

<span class="c1"># Load the nc_files and convert it to a DataFrame</span>
<span class="n">variable_name_reanalysis</span> <span class="o">=</span> <span class="n">nc_file_reanalysis</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file_reanalysis</span><span class="p">,</span>
                                    <span class="n">bounding_box</span><span class="o">=</span><span class="n">bbox_wgs84_konstanz_standard</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">variable_name_projections</span> <span class="o">=</span> <span class="n">nc_file_proj_rcp45</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
<span class="n">df_rcp45</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file_proj_rcp45</span><span class="p">,</span>
                                           <span class="n">bounding_box</span><span class="o">=</span><span class="n">bbox_wgs84_konstanz_standard</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_rcp85</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file_proj_rcp85</span><span class="p">,</span>
                                           <span class="n">bounding_box</span><span class="o">=</span><span class="n">bbox_wgs84_konstanz_standard</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Convert time</span>
<span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
<span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

<span class="c1"># Filter</span>
<span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span>
                              <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">intermediate_year</span><span class="p">)]</span>
<span class="n">df_rcp45</span> <span class="o">=</span> <span class="n">df_rcp45</span><span class="p">[(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">intermediate_year</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
<span class="n">df_rcp85</span> <span class="o">=</span> <span class="n">df_rcp85</span><span class="p">[(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">intermediate_year</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
                    <span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>

<span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

<span class="c1"># Function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="c1"># Ensure the data is sorted by year before performing any rolling operation</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
    
    <span class="c1"># Calculate rolling 30-year average and standard deviation</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Execute</span>
<span class="n">df_rcp45</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">,</span> <span class="n">variable_name_projections</span><span class="p">)</span>
<span class="n">df_rcp85</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">,</span> <span class="n">variable_name_projections</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_reanalysis</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># Plot the rcp45 data and trend line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_rcp45</span><span class="p">[</span><span class="n">variable_name_projections</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
               <span class="n">df_rcp45</span><span class="p">[</span><span class="n">variable_name_projections</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">p</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
         <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># Plot the rcp85 data and trend line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_rcp85</span><span class="p">[</span><span class="n">variable_name_projections</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
               <span class="n">df_rcp85</span><span class="p">[</span><span class="n">variable_name_projections</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">p</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
         <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Plot vertical line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="c1"># Set axis labels and title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean annual&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference Period: </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annual </span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="mf">0.52</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Add grid</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># X-axis: Show all 5-year intervals</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                      <span class="n">end</span><span class="o">=</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                      <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Add description</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.035</span><span class="p">,</span>
    <span class="p">(</span>
       <span class="s1">&#39;Quelle: Copernicus Climate Change Service (C3S),&#39;</span>
       <span class="s1">&#39;Climate Data Store (CDS), (2024): Climate indicators for Europe from 1940 to 2100&#39;</span>
       <span class="s1">&#39;derived from reanalysis and climate projections,&#39;</span>
       <span class="s1">&#39;Copernicus Climate Change Service (C3S) Climate Data Store (CDS).&#39;</span>
       <span class="s1">&#39;(Accessed on 01-08-2024)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Adjust layout and show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d8954ac2b07d70f75168d02f576c748442e49ff44dab40df2cd5128bd8808458.png" src="../../_images/d8954ac2b07d70f75168d02f576c748442e49ff44dab40df2cd5128bd8808458.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_reanalysis</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 - Std&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># Plot vertical line</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="c1"># Set axis labels and title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean annual&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference Period: </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Annual </span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="mf">0.52</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Add grid</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># X-axis: Show all 5-year intervals</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                      <span class="n">end</span><span class="o">=</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                      <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Add description</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.035</span><span class="p">,</span>
    <span class="p">(</span>
       <span class="s1">&#39;Quelle: Copernicus Climate Change Service (C3S),&#39;</span>
       <span class="s1">&#39;Climate Data Store (CDS), (2024): Climate indicators for Europe from 1940 to 2100&#39;</span>
       <span class="s1">&#39;derived from reanalysis and climate projections,&#39;</span>
       <span class="s1">&#39;Copernicus Climate Change Service (C3S) Climate Data Store (CDS).&#39;</span>
       <span class="s1">&#39;(Accessed on 01-08-2024)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># Legend</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Adjust layout and show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/123727895c3578be87b7e24fafe471eb714d5b9976912f64492ec6153306ae83.png" src="../../_images/123727895c3578be87b7e24fafe471eb714d5b9976912f64492ec6153306ae83.png" />
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="03-sis-health-vector.html" class="btn btn-neutral float-left" title="SIS Health Vector" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="05-sis-biodiversity-era5-regional.html" class="btn btn-neutral float-right" title="Downscaled bioclimatic indicators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, str.ucture GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>