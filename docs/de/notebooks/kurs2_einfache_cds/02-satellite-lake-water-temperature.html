

<!DOCTYPE html>
<html class="writer-html5" lang="de" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Seewassertemperatur aus Satellitendaten abgeleitet &mdash; Coklimax 1.0.0 Dokumentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=822aaed9" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f029ec32"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/translations.js?v=9bf55d28"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../../genindex.html" />
    <link rel="search" title="Suche" href="../../search.html" />
    <link rel="next" title="Temperaturstatistiken für Europa" href="03-sis-temperature-statistics.html" />
    <link rel="prev" title="Wasserstände von Seen abgleitet aus Satellitendaten" href="01-satellite-lake-water-level.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Coklimax
              <img src="../../_static/coklimax_logo_new.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Dokumentation durchsuchen" aria-label="Dokumentation durchsuchen" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Inhalte:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/01-softwarekenntnisse.html">Notwendige Software und Kenntnisse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/02-kurselemente.html">Die Kurs-Elemente</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/03-cds.html">Der Copernicus Climate Data Store (CDS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs 1:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/01-cds-api-installieren-und-herunterladen.html">CDS API Installation und Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/02-netcdf-einfuhrung.html">NetCDF Einführung</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs 2:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01-satellite-lake-water-level.html">Wasserstände von Seen abgleitet aus Satellitendaten</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Seewassertemperatur aus Satellitendaten abgeleitet</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#festlegen-der-pfade-und-arbeitsverzeichnisse">1. Festlegen der Pfade und Arbeitsverzeichnisse</a></li>
<li class="toctree-l2"><a class="reference internal" href="#herunterladen-und-entpacken-des-datensatzes">2. Herunterladen und Entpacken des Datensatzes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#authentifizierung">2.1 Authentifizierung</a></li>
<li class="toctree-l3"><a class="reference internal" href="#definieren-sie-die-request-und-laden-sie-den-datensatz-herunter">2.2 Definieren Sie die „request“ und laden Sie den Datensatz herunter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extrahieren-sie-die-zip-dateien-in-ordner">2.3 Extrahieren Sie die ZIP-Dateien in Ordner</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#netcdf4-dateien-zu-einer-einzigen-netcdf4-datei-zusammenfuhren">3. NetCDF4-Dateien zu einer einzigen NetCDF4-Datei zusammenführen</a></li>
<li class="toctree-l2"><a class="reference internal" href="#untersuchen-der-metadaten-der-netcdf4-datei">4. Untersuchen der Metadaten der NetCDF4-Datei</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exportieren-der-zeitreihe-im-csv-format">5. Exportieren der Zeitreihe im CSV-Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#definieren-sie-eine-funktion-zur-berechnung-des-tagesdurchschnitts">5.1 Definieren Sie eine Funktion zur Berechnung des Tagesdurchschnitts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#erstellen-des-dataframes-fur-jahresdaten-und-export-als-csv">5.2 Erstellen des DataFrames für Jahresdaten und Export als CSV</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#analyse-und-visualisierung-optionen">6. Analyse und Visualisierung Optionen</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#visualisierung-des-tagesdurchschnitts-mit-liniendiagramm">6.1 Visualisierung des Tagesdurchschnitts mit Liniendiagramm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualisierung-des-monatlichen-durchschnitts-mit-liniendiagramm">6.2 Visualisierung des monatlichen Durchschnitts mit Liniendiagramm</a></li>
<li class="toctree-l3"><a class="reference internal" href="#visualisierung-des-monatlichen-durchschnitts-mit-balkendiagramm">6.3 Visualisierung des monatlichen Durchschnitts mit Balkendiagramm</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exportieren-der-netcdf4-datei-nach-geotiff">7. Exportieren der NetCDF4-Datei nach GeoTIFF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exportieren-sie-den-jahrlichen-datensatz-als-eine-geotiff-datei">7.1 Exportieren Sie den jährlichen Datensatz als eine GeoTIFF-Datei</a></li>
<li class="toctree-l3"><a class="reference internal" href="#export-des-jahresdatensatzes-als-einzelne-geotiff-dateien">7.2 Export des Jahresdatensatzes als einzelne GeoTIFF-Dateien</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#zusatzliche-visualisierung-mit-einem-kalenderdiagramm">8. Zusätzliche Visualisierung mit einem Kalenderdiagramm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="03-sis-temperature-statistics.html">Temperaturstatistiken für Europa</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Jupyter Notebook Bibliothek:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/index.html">Über CoKLIMAx-II Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/cds_data/index.html">CDS Datensatz Notebooks </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/satellite_data/index.html">Satellitendaten Notebooks </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/visualizations/index.html">Visualization Options Library</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Coklimax</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Seewassertemperatur aus Satellitendaten abgeleitet</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/kurs2_einfache_cds/02-satellite-lake-water-temperature.ipynb.txt" rel="nofollow"> Quelltext anzeigen</a>
<div id='language-switcher' style='text-align: right; margin-top: 10px;'>
    <select onchange="location = this.value;">
        <option value='/./CoKLIMAx-II/en\notebooks\kurs2_einfache_cds\02-satellite-lake-water-temperature.html'>EN</option>
        <option value='/./CoKLIMAx-II/de\notebooks\kurs2_einfache_cds\02-satellite-lake-water-temperature.html' selected>DE</option>
    </select>
</div>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="seewassertemperatur-aus-satellitendaten-abgeleitet">
<h1>Seewassertemperatur aus Satellitendaten abgeleitet<a class="headerlink" href="#seewassertemperatur-aus-satellitendaten-abgeleitet" title="Link to this heading"></a></h1>
<p>Dieses Datenset liefert tägliche Werte der Oberflächenwassertemperatur von Seen (LSWT) am Vormittag, abgeleitet aus Satellitendaten, zusammen mit zugehöriger Unsicherheit und Qualitätsstufen. Die Daten, die von den ATSR- und AVHRR-Sensoren stammen, wurden zur Konsistenzanpassung bias-korrigiert und können aufgrund fehlender Beobachtungen Lücken enthalten. LSWT ist eine essenzielle Klimavariable, die für das Verständnis der Seeökologie, hydrologischer Prozesse und großräumiger Klimawechselwirkungen von entscheidender Bedeutung ist. Die Datenentwicklung wurde durch das UK NERC GloboLakes-Projekt unterstützt, und zukünftige Verbesserungen erfolgen im Rahmen der ESA Climate Change Initiative.</p>
<p><strong>Schnellnavigation:</strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#herunterladen-und-entpacken-des-datensatzes"><span class="std std-ref">Herunterladen und Entpacken des Datensatzes</span></a></p></li>
<li><p><a class="reference internal" href="#netcdf4-dateien-zu-einer-einzigen-netcdf4-datei-zusammenfuhren"><span class="std std-ref">NetCDF4-Dateien zu einer einzigen NetCDF4-Datei zusammenführen</span></a></p></li>
<li><p><a class="reference internal" href="#untersuchen-der-metadaten-der-netcdf4-datei"><span class="std std-ref">Untersuchen der Metadaten der netCDF4-Datei</span></a></p></li>
<li><p><a class="reference internal" href="#exportieren-der-zeitreihe-im-csv-format"><span class="std std-ref">Exportieren der Zeitreihe im csv-Format</span></a></p></li>
<li><p><a class="reference internal" href="#analyse-und-visualisierung-optionen"><span class="std std-ref">Analyse und Visualisierung Optionen</span></a></p></li>
<li><p><a class="reference internal" href="#exportieren-der-netcdf4-datei-nach-geotiff"><span class="std std-ref">Exportieren der NetCDF4-Datei nach GeoTIFF</span></a></p></li>
<li><p><a class="reference internal" href="#zusatzliche-visualisierung-mit-einem-kalenderdiagramm"><span class="std std-ref">Zusätzliche Visualisierung mit einem Kalenderdiagramm</span></a></p></li>
</ul>
<p><strong>Information on Dataset:</strong></p>
<ul class="simple">
<li><p>Quelle: <a href="https://cds.climate.copernicus.eu/datasets/satellite-lake-water-temperature?tab=overview" target="_blank">Satellite Lake Water Temperature</a></p></li>
<li><p>Author: T. Tewes (City of Konstanz)</p></li>
<li><p>Notebook Version: 1.3 (Updated: January 17, 2025)</p></li>
</ul>
<section id="festlegen-der-pfade-und-arbeitsverzeichnisse">
<h2>1. Festlegen der Pfade und Arbeitsverzeichnisse<a class="headerlink" href="#festlegen-der-pfade-und-arbeitsverzeichnisse" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="sd">&#39;&#39;&#39; ---- Verzeichnisse hier angeben ---- &#39;&#39;&#39;</span>
<span class="n">download_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\download&quot;</span>
<span class="n">working_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\working&quot;</span>
<span class="n">geotiff_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\geotiff&quot;</span>
<span class="n">csv_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\csv&quot;</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\satellite-lake-water-temperature\output&quot;</span>
<span class="sd">&#39;&#39;&#39; ----- Ende der Angaben ---- &#39;&#39;&#39;</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="herunterladen-und-entpacken-des-datensatzes">
<h2>2. Herunterladen und Entpacken des Datensatzes<a class="headerlink" href="#herunterladen-und-entpacken-des-datensatzes" title="Link to this heading"></a></h2>
<section id="authentifizierung">
<h3>2.1 Authentifizierung<a class="headerlink" href="#authentifizierung" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cdsapi</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># API-Key für die Authentifizierung</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;fdae60fd-35d4-436f-825c-c63fedab94a4&quot;</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://cds.climate.copernicus.eu/api&quot;</span>

    <span class="c1"># Erstellung des CDS-API-Clients</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="definieren-sie-die-request-und-laden-sie-den-datensatz-herunter">
<h3>2.2 Definieren Sie die „request“ und laden Sie den Datensatz herunter<a class="headerlink" href="#definieren-sie-die-request-und-laden-sie-den-datensatz-herunter" title="Link to this heading"></a></h3>
<p>Definieren Sie zusätzliche Anfragefelder, um sicherzustellen, dass die Anfrage innerhalb der Dateigrößenbeschränkung bleibt. Bei der Arbeit mit Geodaten oder APIs, die Karten- oder Satellitenbilder zurückgeben, kann die Begrenzung des geografischen Interessengebiets verhindern, dass Anfragen zu groß werden und die Datei- oder Verarbeitungsgrenzen überschreiten. Begrenzungsrahmen (Bounding Boxes) werden verwendet, um das geografische Gebiet für solche Anfragen festzulegen.</p>
<p>Die untenstehenden Koordinaten wurden mit dem Tool <a href="https://str-ucture.github.io/bbox-extractor/" target="_blank">BBox Extractor</a> ermittelt.</p>
<p><em>BBox Extractor ist ein webbasiertes Tool, das Benutzern hilft, interaktiv Begrenzungsrahmen-Koordinaten im WGS84-Format (Breite/Länge) auszuwählen und zu generieren. Dies ist besonders nützlich für APIs oder Datensätze, die eine Eingabe eines geografischen Gebiets erfordern</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definieren der Begrenzungsrahmen-Koordinaten (WGS84-Format) für die Region Bodensee.</span>
<span class="c1"># Das Koordinatenformat lautet: [Norden, Westen, Süden, Osten]</span>
<span class="n">bbox_wgs84_constance</span> <span class="o">=</span> <span class="p">[</span><span class="mf">48.0</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="mf">47.3</span><span class="p">,</span> <span class="mf">9.9</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Geben Sie das Jahr von Interesse für die Datenanforderung an.</span>
<span class="c1"># Die entsprechende Datenversion hängt vom Jahr ab.</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2007</span>

<span class="c1"># Bestimmen Sie die Datenversion basierend auf dem Jahr:</span>
<span class="c1"># Version &quot;4_5_1&quot; wird für Jahre bis 2020 verwendet, und &quot;4_5_2&quot; für spätere Jahre.</span>
<span class="k">if</span> <span class="mi">1900</span> <span class="o">&lt;=</span> <span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2100</span><span class="p">:</span>  <span class="c1"># Überprüfen Sie den gültigen Jahresbereich für Robustheit.</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;4_5_1&quot;</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2020</span> <span class="k">else</span> <span class="s2">&quot;4_5_2&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ungültiges Jahr: </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">. Bitte geben Sie ein Jahr zwischen 1900 und 2100 an.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definition des Datensatzes und der Request-Parameter</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;satellite-lake-water-temperature&quot;</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;01&quot;</span><span class="p">,</span> <span class="s2">&quot;02&quot;</span><span class="p">,</span> <span class="s2">&quot;03&quot;</span><span class="p">,</span>
        <span class="s2">&quot;04&quot;</span><span class="p">,</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;06&quot;</span><span class="p">,</span>
        <span class="s2">&quot;07&quot;</span><span class="p">,</span> <span class="s2">&quot;08&quot;</span><span class="p">,</span> <span class="s2">&quot;09&quot;</span><span class="p">,</span>
        <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="s2">&quot;12&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;01&quot;</span><span class="p">,</span> <span class="s2">&quot;02&quot;</span><span class="p">,</span> <span class="s2">&quot;03&quot;</span><span class="p">,</span>
        <span class="s2">&quot;04&quot;</span><span class="p">,</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;06&quot;</span><span class="p">,</span>
        <span class="s2">&quot;07&quot;</span><span class="p">,</span> <span class="s2">&quot;08&quot;</span><span class="p">,</span> <span class="s2">&quot;09&quot;</span><span class="p">,</span>
        <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="s2">&quot;12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;13&quot;</span><span class="p">,</span> <span class="s2">&quot;14&quot;</span><span class="p">,</span> <span class="s2">&quot;15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;16&quot;</span><span class="p">,</span> <span class="s2">&quot;17&quot;</span><span class="p">,</span> <span class="s2">&quot;18&quot;</span><span class="p">,</span>
        <span class="s2">&quot;19&quot;</span><span class="p">,</span> <span class="s2">&quot;20&quot;</span><span class="p">,</span> <span class="s2">&quot;21&quot;</span><span class="p">,</span>
        <span class="s2">&quot;22&quot;</span><span class="p">,</span> <span class="s2">&quot;23&quot;</span><span class="p">,</span> <span class="s2">&quot;24&quot;</span><span class="p">,</span>
        <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;26&quot;</span><span class="p">,</span> <span class="s2">&quot;27&quot;</span><span class="p">,</span>
        <span class="s2">&quot;28&quot;</span><span class="p">,</span> <span class="s2">&quot;29&quot;</span><span class="p">,</span> <span class="s2">&quot;30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;31&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">bbox_wgs84_constance</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Führen Sie es aus, um den Datensatz herunterzuladen:</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main_retrieve</span><span class="p">():</span>
    <span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.zip&quot;</span>
    <span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>
    
    <span class="c1"># Den Datensatz nur herunterladen, wenn er noch nicht heruntergeladen wurde</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">):</span>
        <span class="c1"># Rufen Sie den CDS-Client nur auf, wenn der Datensatz noch nicht heruntergeladen wurde.</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
        <span class="c1"># Den Datensatz mit den definierten Anforderungsparametern herunterladen</span>
        <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Datensatz bereits heruntergeladen.&quot;</span><span class="p">)</span>
        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main_retrieve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Datensatz bereits heruntergeladen.
</pre></div>
</div>
</div>
</div>
</section>
<section id="extrahieren-sie-die-zip-dateien-in-ordner">
<h3>2.3 Extrahieren Sie die ZIP-Dateien in Ordner<a class="headerlink" href="#extrahieren-sie-die-zip-dateien-in-ordner" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

<span class="c1"># Erstellen des Dateinamens und des Dateipfads für die ZIP-Datei des Datensatzes</span>
<span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.zip&quot;</span>
<span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>

<span class="c1"># Erstellen Sie einen Ordner zum Extrahieren der ZIP-Datei basierend auf dem ausgewählten Jahr</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>

<span class="c1"># Entpacken der ZIP-Datei</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">):</span>
        <span class="c1"># Versuchen Sie, die ZIP-Datei zu öffnen und zu extrahieren</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
            <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dateien erfolgreich extrahiert nach: </span><span class="si">{</span><span class="n">extract_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ordner ist nicht leer. Entpacken überspringen.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler: Die Datei </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> wurde nicht gefunden.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler: Die Datei </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> ist keine gültige ZIP-Datei.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ein unerwarteter Fehler ist aufgetreten: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ordner ist nicht leer. Entpacken überspringen.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="netcdf4-dateien-zu-einer-einzigen-netcdf4-datei-zusammenfuhren">
<h2>3. NetCDF4-Dateien zu einer einzigen NetCDF4-Datei zusammenführen<a class="headerlink" href="#netcdf4-dateien-zu-einer-einzigen-netcdf4-datei-zusammenfuhren" title="Link to this heading"></a></h2>
<p>Viele <strong>jährliche Datensätze</strong> werden als tägliche NetCDF4-Dateien bereitgestellt, wobei jede Datei einen Tag des Jahres repräsentiert <em>(365 Dateien für normale Jahre, 366 Dateien für Schaltjahre)</em>. Die Verwaltung dieser zahlreichen Dateien kann mühsam sein, insbesondere beim Datenzugriff oder bei der Visualisierung.</p>
<p>Um Arbeitsabläufe zu vereinfachen und die Effizienz der Datenverarbeitung zu verbessern, werden alle täglichen Datensätze eines bestimmten Jahres in einer <strong>einzigen jährlichen NetCDF4-Datei</strong> zusammengeführt. Diese Konsolidierung erleichtert die spätere Datenverarbeitung, beispielsweise für die Visualisierung oder statistische Auswertungen.</p>
<blockquote>
<div><p>Wichtig: Tägliche Datensätze können spärliche oder fehlende Daten enthalten. Daher kann die zusammengeführte NetCDF4-Datei, die zusammengeführte GeoTIFF-Datei oder einzelne GeoTIFF-Dateien leere Zeitpunkte enthalten.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="c1"># Definiere den Dateipfad für die zusammengeführte NetCDF-Datei (1 Datei pro Jahr)</span>
<span class="n">nc_filepath_merged</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">)</span>

<span class="c1"># Überprüfe, ob die zusammengeführte Datei bereits existiert</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">):</span>
    <span class="c1"># Liste alle NetCDF-Dateien im Extrakt-Ordner auf</span>
    <span class="n">filename_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">filename_list</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keine NetCDF-Dateien im Ordner </span><span class="si">{</span><span class="n">extract_folder</span><span class="si">}</span><span class="s2"> gefunden.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Öffne und verknüpfe alle NetCDF-Dateien entlang der &#39;time&#39;-Dimension</span>
            <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filename_list</span><span class="p">]</span>
            <span class="n">merged_dataset</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
            
            <span class="c1"># Speichere den zusammengeführten Datensatz in der neuen NetCDF-Datei</span>
            <span class="n">merged_dataset</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Neue NetCDF4-Datei erstellt unter </span><span class="si">{</span><span class="n">nc_filepath_merged</span><span class="si">}</span><span class="s2"> für das Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei der Dateiverarbeitung: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Zusammengeführte NetCDF-Datei für das Jahr </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> existiert bereits. Überspringe Zusammenführung.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Zusammengeführte NetCDF-Datei für das Jahr 2007 existiert bereits. Überspringe Zusammenführung.
</pre></div>
</div>
</div>
</div>
</section>
<section id="untersuchen-der-metadaten-der-netcdf4-datei">
<h2>4. Untersuchen der Metadaten der NetCDF4-Datei<a class="headerlink" href="#untersuchen-der-metadaten-der-netcdf4-datei" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>

<span class="c1"># Definieren Sie den Dateipfad für den zusammengeführten netCDF-Datensatz</span>
<span class="n">nc_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;satellite-lake-water-temperature_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.nc&quot;</span>
<span class="n">nc_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">nc_filename</span><span class="p">)</span>

<span class="c1"># Öffnen der NetCDF-Datei im Lesemodus</span>
<span class="n">nc_dataset</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>

<span class="c1"># Auflisten aller Variablen im Datensatz</span>
<span class="n">variables_list</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verfügbare Variablen: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">variables_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Verfügbare Variablen: [&#39;lake_surface_water_temperature&#39;, &#39;lswt_uncertainty&#39;, &#39;lswt_quality_level&#39;, &#39;lswt_obs_instr&#39;, &#39;lswt_flag_bias_correction&#39;, &#39;lakeid_CCI&#39;, &#39;lakeid_GloboLakes&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;time&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Variablennamen aus vorhandenen Variablen definieren und Variablendaten lesen</span>
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;lake_surface_water_temperature&#39;</span>
<span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>

<span class="c1"># Erstellen einer Zusammenfassung der Hauptvariablen</span>
<span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Variablename&quot;</span><span class="p">:</span> <span class="n">variable_name</span><span class="p">,</span>
    <span class="s2">&quot;Datentyp&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
    <span class="s2">&quot;Form&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="s2">&quot;Variableinfo&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variable_data</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Einheiten&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Langer Name&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Anzeigen der Zusammenfassung des Datensatzes als DataFrame zur besseren Visualisierung</span>
<span class="n">nc_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Beschreibung&#39;</span><span class="p">,</span> <span class="s1">&#39;Bemerkungen&#39;</span><span class="p">])</span>

<span class="c1"># Anzeigen des Zusammenfassungs-DataFrames</span>
<span class="n">nc_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Beschreibung</th>
      <th>Bemerkungen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Variablename</td>
      <td>lake_surface_water_temperature</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Datentyp</td>
      <td>int16</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Form</td>
      <td>(365, 14, 24)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Variableinfo</td>
      <td>lake_surface_water_temperature(time, lat, lon)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Einheiten</td>
      <td>kelvin</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Langer Name</td>
      <td>lake surface skin water temperature</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Drucken Sie eine Zusammenfassung aller Variablen des Datensatzes</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables_list</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">var_obj</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var_obj</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">var_obj</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;nc_variablen&quot;</span><span class="p">:</span> <span class="n">variable</span><span class="p">,</span>
            <span class="s2">&quot;einheit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span>
            <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="n">shape</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei der Verarbeitung der Variable </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Erstelle ein DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nc_variablen</th>
      <th>einheit</th>
      <th>form</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>lake_surface_water_temperature</td>
      <td>kelvin</td>
      <td>(365, 14, 24)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>lswt_uncertainty</td>
      <td>kelvin</td>
      <td>(365, 14, 24)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>lswt_quality_level</td>
      <td>N/A</td>
      <td>(365, 14, 24)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>lswt_obs_instr</td>
      <td>N/A</td>
      <td>(365, 14, 24)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>lswt_flag_bias_correction</td>
      <td>N/A</td>
      <td>(365, 14, 24)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>lakeid_CCI</td>
      <td>1</td>
      <td>(365, 14, 24)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>lakeid_GloboLakes</td>
      <td>1</td>
      <td>(365, 14, 24)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>lat</td>
      <td>degrees_north</td>
      <td>(14,)</td>
    </tr>
    <tr>
      <th>8</th>
      <td>lon</td>
      <td>degrees_east</td>
      <td>(24,)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>time</td>
      <td>seconds since 1970-01-01</td>
      <td>(365,)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="exportieren-der-zeitreihe-im-csv-format">
<h2>5. Exportieren der Zeitreihe im CSV-Format<a class="headerlink" href="#exportieren-der-zeitreihe-im-csv-format" title="Link to this heading"></a></h2>
<section id="definieren-sie-eine-funktion-zur-berechnung-des-tagesdurchschnitts">
<h3>5.1 Definieren Sie eine Funktion zur Berechnung des Tagesdurchschnitts<a class="headerlink" href="#definieren-sie-eine-funktion-zur-berechnung-des-tagesdurchschnitts" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Funktion zur Konvertierung von NetCDF-Daten in ein Pandas DataFrame</span>
<span class="k">def</span><span class="w"> </span><span class="nf">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Konvertiert eine NetCDF-Datei mit Daten zur Wassertemperatur der Seeoberfläche (LSWT)</span>
<span class="sd">    in ein Pandas DataFrame mit berechneten Statistiken.</span>

<span class="sd">    Parameter:</span>
<span class="sd">    nc_file (str): Pfad zur NetCDF-Datei.</span>

<span class="sd">    Rückgabe:</span>
<span class="sd">    pd.DataFrame: Ein DataFrame mit Zeit, mittlerer Temperatur, Standardabweichung, </span>
<span class="sd">                  Unsicherheit, mittlerer Qualitätsstufe und Anzahl der Nicht-Null-Pixel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Öffne das NetCDF-Dataset im Lesemodus</span>
    <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>
        <span class="c1"># Extrahiere und dekodiere die Zeitvariable unter Berücksichtigung des Kalenders und der Einheiten</span>
        <span class="n">time_var</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span>
        <span class="n">time_units</span> <span class="o">=</span> <span class="n">time_var</span><span class="o">.</span><span class="n">units</span>
        <span class="n">time_calendar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">time_var</span><span class="p">,</span> <span class="s2">&quot;calendar&quot;</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">)</span>
        <span class="n">cftime</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_var</span><span class="p">[:],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">time_calendar</span><span class="p">)</span>
        <span class="n">datetime_cftime</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cftime</span><span class="p">]</span>

        <span class="c1"># Extrahiere Temperaturdaten und zugehörige Einheiten</span>
        <span class="n">temperature_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lake_surface_water_temperature&quot;</span><span class="p">][:]</span>
        <span class="n">temperature_data_units</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lake_surface_water_temperature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>

        <span class="c1"># Berechnen Sie die Durchschnittstemperatur und die Standardabweichung für jeden Zeitschritt.</span>
        <span class="c1"># Gemittelt über die räumlichen Dimensionen</span>
        <span class="n">temperature_mean_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">temperature_std_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="c1"># Zähle die Anzahl gültiger (nicht-NaN) Pixel für jeden Zeitschritt</span>
        <span class="n">nonzero_count_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">temperature_data</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Extrahiere Unsicherheitsdaten und deren Einheiten</span>
        <span class="n">lswt_uncertainty</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lswt_uncertainty&quot;</span><span class="p">][:]</span>
        <span class="n">lswt_uncertainty_units</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lswt_uncertainty&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>

        <span class="c1"># Berechnen Sie die Unsicherheit der Durchschnittstemperatur</span>
        <span class="n">lswt_uncertainty_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">lswt_uncertainty</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">lswt_mean_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lswt_uncertainty_squared</span><span class="p">)</span>
        
        <span class="c1"># Extrahiere und berechne den mittleren Qualitätswert für jeden Zeitschritt</span>
        <span class="n">lswt_quality_level</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;lswt_quality_level&quot;</span><span class="p">][:]</span>
        <span class="n">lswt_quality_level_mean_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">lswt_quality_level</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Erstelle ein DataFrame mit den berechneten Statistiken</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;Time&quot;</span><span class="p">:</span> <span class="n">datetime_cftime</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Mittlere Temperatur (</span><span class="si">{</span><span class="n">temperature_data_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">:</span> <span class="n">temperature_mean_list</span><span class="p">,</span>
                <span class="s2">&quot;Standardabweichung&quot;</span><span class="p">:</span> <span class="n">temperature_std_list</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Unsicherheit (</span><span class="si">{</span><span class="n">lswt_uncertainty_units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">:</span> <span class="n">lswt_mean_uncertainty</span><span class="p">,</span>
                <span class="s2">&quot;Mittlere Qualitätsstufe&quot;</span><span class="p">:</span> <span class="n">lswt_quality_level_mean_list</span><span class="p">,</span>
                <span class="s2">&quot;Nicht-Null-Anzahl&quot;</span><span class="p">:</span><span class="n">nonzero_count_list</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="erstellen-des-dataframes-fur-jahresdaten-und-export-als-csv">
<h3>5.2 Erstellen des DataFrames für Jahresdaten und Export als CSV<a class="headerlink" href="#erstellen-des-dataframes-fur-jahresdaten-und-export-als-csv" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Definieren den CSV-Dateinamen und den Dateipfad für die Ausgabe</span>
<span class="n">csv_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_daily-mean_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.csv&quot;</span>
<span class="n">csv_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">csv_filename</span><span class="p">)</span>

<span class="c1"># Exportieren das DataFrame als CSV, falls es noch nicht existiert</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">):</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">)</span>
    <span class="n">filtered_dataframe</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">filtered_dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gefilterte Daten erfolgreich exportiert nach </span><span class="si">{</span><span class="n">csv_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datei existiert bereits unter </span><span class="si">{</span><span class="n">csv_filepath</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">Überspringen den Export.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lesen bestehende CSV-Datei ein...&quot;</span><span class="p">)</span>
    <span class="n">filtered_dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">)</span>

<span class="c1"># Ändere die Pandas-Anzeigeoptionen</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="c1"># Zeige das DataFrame an</span>
<span class="n">filtered_dataframe</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Datei existiert bereits unter .\data\satellite-lake-water-temperature\csv\satellite-lake-water-temperature_daily-mean_2007.csv.
Überspringen den Export.
Lesen bestehende CSV-Datei ein...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Mittlere Temperatur (K)</th>
      <th>Standardabweichung</th>
      <th>Unsicherheit (K)</th>
      <th>Mittlere Qualitätsstufe</th>
      <th>Nicht-Null-Anzahl</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2007-01-02 12:00:00</td>
      <td>278.46</td>
      <td>0.11</td>
      <td>0.43</td>
      <td>4.86</td>
      <td>7.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2007-01-05 12:00:00</td>
      <td>275.98</td>
      <td>0.58</td>
      <td>0.29</td>
      <td>3.60</td>
      <td>5.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2007-01-06 12:00:00</td>
      <td>278.64</td>
      <td>0.00</td>
      <td>0.34</td>
      <td>4.00</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2007-01-11 12:00:00</td>
      <td>277.96</td>
      <td>1.43</td>
      <td>0.18</td>
      <td>3.14</td>
      <td>7.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2007-01-14 12:00:00</td>
      <td>278.68</td>
      <td>0.76</td>
      <td>0.19</td>
      <td>4.30</td>
      <td>20.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="analyse-und-visualisierung-optionen">
<h2>6. Analyse und Visualisierung Optionen<a class="headerlink" href="#analyse-und-visualisierung-optionen" title="Link to this heading"></a></h2>
<section id="visualisierung-des-tagesdurchschnitts-mit-liniendiagramm">
<h3>6.1 Visualisierung des Tagesdurchschnitts mit Liniendiagramm<a class="headerlink" href="#visualisierung-des-tagesdurchschnitts-mit-liniendiagramm" title="Link to this heading"></a></h3>
<blockquote>
<div><p>Hinweis: Aufgrund der begrenzten täglichen/monatlichen Daten für den Datensatz 2023 funktionieren <strong>Plots</strong> nicht richtig.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.dates</span><span class="w"> </span><span class="kn">import</span> <span class="n">DateFormatter</span><span class="p">,</span> <span class="n">MonthLocator</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ticker</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="c1"># Bereite das DataFrame für die Darstellung vor</span>
<span class="n">filtered_df</span> <span class="o">=</span> <span class="n">filtered_dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Konvertiere &#39;Time&#39; in das Datetime-Format und extrahiere sowie formatiere die &#39;Date&#39;-Spalte</span>
<span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">])</span>
<span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>

<span class="c1"># Bestimme den Wertebereich für die y-Achse, gerundet auf die nächste Zehnerstelle</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Mittlere Temperatur (K)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
<span class="n">vmin</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Mittlere Temperatur (K)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>

<span class="c1"># Erstelle die Figur und Achsen</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Plotten die mittlere Temperatur</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span>
        <span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;Mittlere Temperatur (K)&#39;</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#1877F2&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Oberflächenwassertemperatur&quot;</span><span class="p">,</span>
        <span class="p">)</span>

<span class="c1"># Formatieren der x-Achse für bessere Lesbarkeit</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MonthLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">)</span>

<span class="c1"># Setzen der y-Achsen-Grenzen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

<span class="c1"># Setzen der Achsenbeschriftungen und Titel des Diagramms</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Monate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperatur (K)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Oberflächenwassertemperatur des Bodensees, </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="c1"># Hinzufügen eines Rasters zum Diagramm und Formatierung der y-Achse</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="c1"># Hinzufügen einer Beschreibung und Quelleninformation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.4</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="p">(</span>
        <span class="s1">&#39;Beschreibung: Oberflächenwassertemperatur des Bodensees, ermittelt aus Satellitendaten des CDS.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;Quelle: Copernicus Climate Change Service, Climate Data Store, (2020): Oberflächenwassertemperatur von Seen &#39;</span>
        <span class="s1">&#39;von 1995 bis heute, abgeleitet aus Satellitenbeobachtungen. Copernicus Climate Change Service (C3S) Climate Data Store (CDS). &#39;</span>
        <span class="s1">&#39;DOI: 10.24381/cds.5714c668 (Zugriff am 22-01-2025)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># Layout anpassen und das Diagramm anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/b44e6e3b94190a42f6b3f5c1ccd7c64492e960b19af784b3d49726543863da00.png" src="../../_images/b44e6e3b94190a42f6b3f5c1ccd7c64492e960b19af784b3d49726543863da00.png" />
</div>
</div>
</section>
<section id="visualisierung-des-monatlichen-durchschnitts-mit-liniendiagramm">
<h3>6.2 Visualisierung des monatlichen Durchschnitts mit Liniendiagramm<a class="headerlink" href="#visualisierung-des-monatlichen-durchschnitts-mit-liniendiagramm" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bereite das DataFrame für die Darstellung vor, indem monatliche Aggregation und Fehlerfortpflanzung durchgeführt werden</span>

<span class="c1"># Gruppiere nach monatlichen Perioden anhand der &#39;Date&#39;-Spalte</span>
<span class="n">filtered_df_monthly</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">filtered_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">PeriodIndex</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">))[[</span>  
        <span class="s2">&quot;Mittlere Temperatur (K)&quot;</span><span class="p">,</span>  
        <span class="s2">&quot;Standardabweichung&quot;</span><span class="p">,</span>  
        <span class="s2">&quot;Unsicherheit (K)&quot;</span><span class="p">,</span>  
        <span class="s2">&quot;Mittlere Qualitätsstufe&quot;</span>  
    <span class="p">]]</span>  
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span>  
        <span class="s2">&quot;Mittlere Temperatur (K)&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>  
        <span class="s2">&quot;Standardabweichung&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span>  
        <span class="s2">&quot;Unsicherheit (K)&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">**</span><span class="mf">0.5</span><span class="p">,</span>  
        <span class="s2">&quot;Mittlere Qualitätsstufe&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span>  
    <span class="p">})</span>  
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>  
<span class="p">)</span>

<span class="c1"># Konvertiere den PeriodIndex zurück in Zeitstempel für eine konsistente Datumsverarbeitung</span>
<span class="n">filtered_df_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_df_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>

<span class="c1"># Zeige das DataFrame an</span>
<span class="n">filtered_df_monthly</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Mittlere Temperatur (K)</th>
      <th>Standardabweichung</th>
      <th>Unsicherheit (K)</th>
      <th>Mittlere Qualitätsstufe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2007-01-01</td>
      <td>277.77</td>
      <td>0.63</td>
      <td>0.31</td>
      <td>4.16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2007-02-01</td>
      <td>277.36</td>
      <td>0.35</td>
      <td>0.23</td>
      <td>4.14</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2007-03-01</td>
      <td>279.02</td>
      <td>1.16</td>
      <td>0.28</td>
      <td>3.70</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2007-04-01</td>
      <td>285.22</td>
      <td>1.27</td>
      <td>0.27</td>
      <td>3.41</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2007-05-01</td>
      <td>288.30</td>
      <td>1.75</td>
      <td>0.42</td>
      <td>3.28</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstelle die Grafik und Achsen</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Plotte die monatliche mittlere Temperatur mit Fehlerbalken</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
    <span class="n">filtered_df_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span>
    <span class="n">filtered_df_monthly</span><span class="p">[</span><span class="s1">&#39;Mittlere Temperatur (K)&#39;</span><span class="p">],</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">filtered_df_monthly</span><span class="p">[</span><span class="s1">&#39;Standardabweichung&#39;</span><span class="p">],</span>
    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o--&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mittlere Temperatur ± Unsicherheit&#39;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">elinewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="n">capthick</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Formatieren der x-Achse für bessere Lesbarkeit</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MonthLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">)</span>

<span class="c1"># Setzen der y-Achsen-Grenzen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

<span class="c1"># Setzen der Achsenbeschriftungen und Titel des Diagramms</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Monate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperatur (K)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Monatliche durchschnittliche Oberflächenwassertemperatur des Bodensees, </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="c1"># Hinzufügen eines Rasters zum Diagramm und Formatierung der y-Achse</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="c1"># Hinzufügen einer Beschreibung und Quelleninformation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.4</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="p">(</span>
        <span class="s1">&#39;Beschreibung: Oberflächenwassertemperatur des Bodensees, ermittelt aus Satellitendaten des CDS.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;Quelle: Copernicus Climate Change Service, Climate Data Store, (2020): Oberflächenwassertemperatur von Seen &#39;</span>
        <span class="s1">&#39;von 1995 bis heute, abgeleitet aus Satellitenbeobachtungen. Copernicus Climate Change Service (C3S) Climate Data Store (CDS). &#39;</span>
        <span class="s1">&#39;DOI: 10.24381/cds.5714c668 (Zugriff am 22-01-2025)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># Layout anpassen und das Diagramm anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f7b1d32c504eff68bde47c90854a8938eacaf02c011020f0c7c15e18ca8a6e56.png" src="../../_images/f7b1d32c504eff68bde47c90854a8938eacaf02c011020f0c7c15e18ca8a6e56.png" />
</div>
</div>
</section>
<section id="visualisierung-des-monatlichen-durchschnitts-mit-balkendiagramm">
<h3>6.3 Visualisierung des monatlichen Durchschnitts mit Balkendiagramm<a class="headerlink" href="#visualisierung-des-monatlichen-durchschnitts-mit-balkendiagramm" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen die Figur und Achsen</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Plotten die monatliche mittlere Temperatur als Balkendiagramm</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
    <span class="n">filtered_df_monthly</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span>
    <span class="n">filtered_df_monthly</span><span class="p">[</span><span class="s1">&#39;Mittlere Temperatur (K)&#39;</span><span class="p">],</span>
    <span class="n">yerr</span><span class="o">=</span><span class="n">filtered_df_monthly</span><span class="p">[</span><span class="s1">&#39;Standardabweichung&#39;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mittlere Temperatur ± Unsicherheit&#39;</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">error_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Formatieren der x-Achse für bessere Lesbarkeit</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MonthLocator</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%b&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;minor&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;inout&#39;</span><span class="p">)</span>

<span class="c1"># Setzen die Grenzen der y-Achse</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span>

<span class="c1"># Setzen der Achsenbeschriftungen und Titel des Diagramms</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Monate&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temperatur (K)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Monatliche durchschnittliche Oberflächenwassertemperatur des Bodensees, </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="c1"># Hinzufügen eines Rasters zum Diagramm und Formatierung der y-Achse</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="c1"># Hinzufügen einer Beschreibung und Quelleninformation</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.4</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="p">(</span>
        <span class="s1">&#39;Beschreibung: Oberflächenwassertemperatur des Bodensees, ermittelt aus Satellitendaten des CDS.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="s1">&#39;Quelle: Copernicus Climate Change Service, Climate Data Store, (2020): Oberflächenwassertemperatur von Seen &#39;</span>
        <span class="s1">&#39;von 1995 bis heute, abgeleitet aus Satellitenbeobachtungen. Copernicus Climate Change Service (C3S) Climate Data Store (CDS). &#39;</span>
        <span class="s1">&#39;DOI: 10.24381/cds.5714c668 (Zugriff am 22-01-2025)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># Layout anpassen und das Diagramm anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/decc61104fcdf182f3aea0582ee9c403cd7155485db423370f098e05e13c89da.png" src="../../_images/decc61104fcdf182f3aea0582ee9c403cd7155485db423370f098e05e13c89da.png" />
</div>
</div>
</section>
</section>
<section id="exportieren-der-netcdf4-datei-nach-geotiff">
<h2>7. Exportieren der NetCDF4-Datei nach GeoTIFF<a class="headerlink" href="#exportieren-der-netcdf4-datei-nach-geotiff" title="Link to this heading"></a></h2>
<section id="exportieren-sie-den-jahrlichen-datensatz-als-eine-geotiff-datei">
<h3>7.1 Exportieren Sie den jährlichen Datensatz als eine GeoTIFF-Datei<a class="headerlink" href="#exportieren-sie-den-jahrlichen-datensatz-als-eine-geotiff-datei" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">from_origin</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm.notebook</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>  

<span class="k">def</span><span class="w"> </span><span class="nf">main_export_geotiff</span><span class="p">(</span><span class="n">nc_file</span><span class="p">):</span>  
    <span class="c1"># NetCDF-Datei öffnen und Variable auslesen  </span>
    <span class="n">nc_dataset</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>  
    <span class="n">temperature_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>  

    <span class="c1"># Zeitvariable extrahieren und in ein lesbares Datumsformat konvertieren  </span>
    <span class="n">time_var</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>  
    <span class="n">time_units</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>  
    <span class="n">time_calendar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">time_var</span><span class="p">,</span> <span class="s2">&quot;calendar&quot;</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">)</span>  
    <span class="n">cftime</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_var</span><span class="p">[:],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">time_calendar</span><span class="p">)</span>  

    <span class="c1"># Räumliche Auflösung berechnen und Rastertransformation definieren  </span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>  
    <span class="n">lon</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>  

    <span class="n">pixelgröße_lat</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  
    <span class="n">pixelgröße_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  
    <span class="n">transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">pixelgröße_lon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  
                            <span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">pixelgröße_lat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  
                            <span class="n">pixelgröße_lon</span><span class="p">,</span>  
                            <span class="o">-</span><span class="n">pixelgröße_lat</span>  
                            <span class="p">)</span>  

    <span class="c1"># Ausgabepfad für das zusammengeführte GeoTIFF definieren  </span>
    <span class="n">output_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">_merged.tif&quot;</span>  
    <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="s2">&quot;merged_geotiff&quot;</span><span class="p">)</span>  
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
    <span class="n">output_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">)</span>  

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">output_filepath</span><span class="p">):</span>  
        <span class="c1"># GeoTIFF-Datei mit mehreren Bändern (je eines pro Zeitschritt) erstellen  </span>
        <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>  
            <span class="n">output_filepath</span><span class="p">,</span>  
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>  
            <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>  
            <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">temperature_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>  
            <span class="n">width</span><span class="o">=</span><span class="n">temperature_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>  
            <span class="n">height</span><span class="o">=</span><span class="n">temperature_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  
            <span class="n">count</span><span class="o">=</span><span class="n">temperature_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  
            <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>  
            <span class="n">nodata</span><span class="o">=-</span><span class="mi">9999</span><span class="p">,</span>  
            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>        
        <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>  
            <span class="c1"># Jeden Zeitschritt als separates Band schreiben  </span>
            <span class="k">for</span> <span class="n">day_index</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">temperature_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>  
                                  <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Zusammengeführte GeoTIFF-Datei für </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> exportieren&quot;</span><span class="p">):</span>  
                <span class="n">band_data</span> <span class="o">=</span> <span class="n">temperature_data</span><span class="p">[</span><span class="n">day_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>  
                <span class="n">dt</span> <span class="o">=</span> <span class="n">cftime</span><span class="p">[</span><span class="n">day_index</span><span class="p">]</span>  
                <span class="n">band_desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>  

                <span class="c1"># Daten für das aktuelle Band schreiben und Band annotieren  </span>
                <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">band_data</span><span class="p">,</span> <span class="n">day_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  
                <span class="n">dst</span><span class="o">.</span><span class="n">set_band_description</span><span class="p">(</span><span class="n">day_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">band_desc</span><span class="p">)</span>  
    <span class="k">else</span><span class="p">:</span>  
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">&#39; existiert bereits. Export überspringen.&quot;</span><span class="p">)</span>  

<span class="c1"># Parameter für die Verarbeitung der NetCDF-Datei definieren  </span>
<span class="n">nc_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.nc&quot;</span>  
<span class="n">nc_filepath_merged</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">nc_filename</span><span class="p">)</span>  
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;lake_surface_water_temperature&#39;</span>  

<span class="c1"># Exportprozess ausführen  </span>
<span class="n">main_export_geotiff</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;lake_surface_water_temperature_2007_merged.tif&#39; existiert bereits. Export überspringen.
</pre></div>
</div>
</div>
</div>
</section>
<section id="export-des-jahresdatensatzes-als-einzelne-geotiff-dateien">
<h3>7.2 Export des Jahresdatensatzes als einzelne GeoTIFF-Dateien<a class="headerlink" href="#export-des-jahresdatensatzes-als-einzelne-geotiff-dateien" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">from_origin</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>  
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm.notebook</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>  

<span class="k">def</span><span class="w"> </span><span class="nf">main_export_individual_geotiff</span><span class="p">(</span><span class="n">nc_file</span><span class="p">):</span>  
    <span class="c1"># NetCDF-Datensatz öffnen und Variablendaten auslesen  </span>
    <span class="n">nc_dataset</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>  
    <span class="n">temperature_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>  

    <span class="c1"># Zeitvariable extrahieren und in ein lesbares Datumsformat konvertieren  </span>
    <span class="n">time_var</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>  
    <span class="n">time_units</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>  
    <span class="n">time_calendar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">time_var</span><span class="p">,</span> <span class="s2">&quot;calendar&quot;</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">)</span>  
    <span class="n">cftime</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_var</span><span class="p">[:],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">time_calendar</span><span class="p">)</span>  

    <span class="c1"># Räumliche Auflösung berechnen und Rastertransformation definieren  </span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>  
    <span class="n">lon</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>  

    <span class="n">pixelgröße_lat</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  
    <span class="n">pixelgröße_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  
    <span class="n">transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span><span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">pixelgröße_lon</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  
                            <span class="n">lat</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">pixelgröße_lat</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>  
                            <span class="n">pixelgröße_lon</span><span class="p">,</span>  
                            <span class="o">-</span><span class="n">pixelgröße_lat</span>  
                            <span class="p">)</span>  

    <span class="c1"># Ausgabeordner für einzelne GeoTIFF-Dateien des ausgewählten Jahres definieren und erstellen  </span>
    <span class="n">year_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">_individual_geotiff&quot;</span><span class="p">)</span>  
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">year_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">year_folder</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  
        <span class="c1"># Einzelne GeoTIFF-Dateien mit täglichen Zeitschritten erstellen  </span>
        <span class="k">for</span> <span class="n">day_index</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">temperature_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;GeoTIFF-Dateien für </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> exportieren&quot;</span><span class="p">):</span>  
            <span class="n">dt</span> <span class="o">=</span> <span class="n">cftime</span><span class="p">[</span><span class="n">day_index</span><span class="p">]</span>  
            <span class="n">band_desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>  

            <span class="n">output_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">band_desc</span><span class="si">}</span><span class="s2">.tif&quot;</span>  
            <span class="n">output_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">year_folder</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">)</span>  

            <span class="n">band_data</span> <span class="o">=</span> <span class="n">temperature_data</span><span class="p">[</span><span class="n">day_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>  

            <span class="c1"># GeoTIFF-Datei mit einem einzelnen Band für jeden Zeitschritt erstellen  </span>
            <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>  
                <span class="n">output_filepath</span><span class="p">,</span>  
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>  
                <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>  
                <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">band_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>  
                <span class="n">width</span><span class="o">=</span><span class="n">band_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  
                <span class="n">height</span><span class="o">=</span><span class="n">band_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  
                <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
                <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span>  
                <span class="n">nodata</span><span class="o">=-</span><span class="mi">9999</span><span class="p">,</span>  
                <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>        
            <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>  
                <span class="c1"># Daten für das aktuelle Band schreiben und Band annotieren  </span>
                <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">band_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  
                <span class="n">dst</span><span class="o">.</span><span class="n">set_band_description</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">band_desc</span><span class="p">)</span>  
    <span class="k">else</span><span class="p">:</span>  
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ordner ist nicht leer. Export überspringen.&quot;</span><span class="p">)</span>  

<span class="c1"># Parameter für die Verarbeitung der NetCDF-Datei definieren  </span>
<span class="n">nc_filename_merged</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.nc&quot;</span>  
<span class="n">nc_filepath_merged</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">nc_filename</span><span class="p">)</span>  
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;lake_surface_water_temperature&#39;</span>  

<span class="c1"># Exportprozess ausführen  </span>
<span class="n">main_export_individual_geotiff</span><span class="p">(</span><span class="n">nc_filepath_merged</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ordner ist nicht leer. Export überspringen.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="zusatzliche-visualisierung-mit-einem-kalenderdiagramm">
<h2>8. Zusätzliche Visualisierung mit einem Kalenderdiagramm<a class="headerlink" href="#zusatzliche-visualisierung-mit-einem-kalenderdiagramm" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>  

<span class="c1"># Funktion definieren, um Metadaten aus einem NetCDF-Dateinamen zu extrahieren  </span>
<span class="k">def</span><span class="w"> </span><span class="nf">meta</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>  
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(.+?)_(\d</span><span class="si">{4}</span><span class="s2">)\.nc&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>  
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>  
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Der angegebene Dateiname entspricht nicht dem erwarteten Namensschema.&quot;</span><span class="p">)</span>  

    <span class="k">def</span><span class="w"> </span><span class="nf">get_nc_variable</span><span class="p">():</span>  
        <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>  
            <span class="n">nc_variable_name_list</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>  

            <span class="n">primary_variable_index</span> <span class="o">=</span> <span class="mi">0</span>  
            <span class="n">primary_variable</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">nc_variable_name_list</span><span class="p">][</span><span class="n">primary_variable_index</span><span class="p">]</span>  
            <span class="n">primary_variable_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="n">primary_variable</span><span class="p">])</span>  

            <span class="k">return</span> <span class="n">primary_variable</span><span class="p">,</span> <span class="n">primary_variable_shape</span>  

    <span class="c1"># Metadaten als Dictionary zurückgeben  </span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>  
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>  
        <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>  
        <span class="n">year</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>  
        <span class="n">variable_name</span><span class="o">=</span><span class="n">get_nc_variable</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>  
        <span class="n">variable_shape</span><span class="o">=</span><span class="n">get_nc_variable</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span>  
    <span class="p">)</span>  

<span class="c1"># Alle NetCDF-Dateien im Ausgabeordner auflisten, verarbeiten und nach Jahr sortieren  </span>
<span class="n">nc_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">meta</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">output_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>  
<span class="n">nc_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nc_files</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>  

<span class="n">df_nc_files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">nc_files</span><span class="p">)</span>  

<span class="c1"># DataFrame anzeigen, ohne den Pfad anzuzeigen  </span>
<span class="n">df_nc_files</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_nc_files</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filename</th>
      <th>year</th>
      <th>variable_name</th>
      <th>variable_shape</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>satellite-lake-water-temperature_1995.nc</td>
      <td>1995</td>
      <td>lake_surface_water_temperature</td>
      <td>(201, 14, 24)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>satellite-lake-water-temperature_1996.nc</td>
      <td>1996</td>
      <td>lake_surface_water_temperature</td>
      <td>(180, 14, 24)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>satellite-lake-water-temperature_1997.nc</td>
      <td>1997</td>
      <td>lake_surface_water_temperature</td>
      <td>(361, 14, 24)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>satellite-lake-water-temperature_1998.nc</td>
      <td>1998</td>
      <td>lake_surface_water_temperature</td>
      <td>(360, 14, 24)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>satellite-lake-water-temperature_1999.nc</td>
      <td>1999</td>
      <td>lake_surface_water_temperature</td>
      <td>(352, 14, 24)</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">calmap</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>  
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ma</span>  

<span class="k">def</span><span class="w"> </span><span class="nf">plot_calendarplot</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  
    <span class="c1"># NetCDF-Datei für das angegebene Jahr filtern  </span>
    <span class="n">nc_file</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">nc_files</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)),</span> <span class="kc">None</span><span class="p">)</span>  

    <span class="k">if</span> <span class="ow">not</span> <span class="n">nc_file</span><span class="p">:</span>  
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Keine NetCDF-Datei für das angegebene Jahr gefunden.&quot;</span><span class="p">)</span>  
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Das neueste verfügbare Jahr wird ausgewählt.&quot;</span><span class="p">)</span>  
        <span class="k">if</span> <span class="n">nc_files</span><span class="p">:</span>  
            <span class="n">nc_file</span> <span class="o">=</span> <span class="n">nc_files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Das neueste verfügbare Jahr auswählen  </span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Es werden Daten aus dem Jahr </span><span class="si">{</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> verwendet.&quot;</span><span class="p">)</span>  
        <span class="k">else</span><span class="p">:</span>  
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Keine NetCDF-Dateien verfügbar.&quot;</span><span class="p">)</span>  
            <span class="k">return</span>  

    <span class="c1"># Die NetCDF-Datei öffnen und die angegebene Variable verarbeiten  </span>
    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>  
        <span class="c1"># Variablendaten als DataFrame extrahieren  </span>
        <span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]]</span>  
        <span class="n">df</span> <span class="o">=</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  

        <span class="c1"># &#39;time&#39; in das Datetime-Format konvertieren und &#39;day_of_year&#39; sowie &#39;date&#39; ableiten  </span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>  
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span>  
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%j&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>  

        <span class="c1"># Nach &#39;date&#39; gruppieren und den täglichen Mittelwert für die Variable berechnen  </span>
        <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  

    <span class="c1"># Sicherstellen, dass der Index des Ergebnisses ein datetime-Format hat  </span>
    <span class="n">df2</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>  

    <span class="c1"># Kalender-Heatmap der mittleren Temperaturwerte plotten  </span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">calmap</span><span class="o">.</span><span class="n">calendarplot</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span>  
                                <span class="n">fig_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">)},</span>  
                                <span class="n">yearlabel_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">},</span>  
                                <span class="n">subplot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Kalender-Heatmap von </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s1"> für </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">},</span>  
                                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span>  
                                <span class="n">fillcolor</span><span class="o">=</span><span class="s1">&#39;#efefef&#39;</span><span class="p">,</span>  
                                <span class="n">daylabels</span><span class="o">=</span><span class="s1">&#39;MTWTFSS&#39;</span><span class="p">,</span>  
                                <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span>  
                                <span class="n">dayticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
                                <span class="p">)</span>  

    <span class="c1"># Farbleiste rechts neben dem Diagramm hinzufügen  </span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.005</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>  
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">//</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>  
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">df2</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">//</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>  

    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGnBu&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">))</span>  
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>  

    <span class="c1"># Ticks auf der Farbleiste anpassen  </span>
    <span class="n">tick_interval</span> <span class="o">=</span> <span class="mi">5</span>  
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">tick_interval</span><span class="p">)</span>  
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>  <span class="c1"># Ticks setzen  </span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>  

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>  
    <span class="c1"># Kalender-Heatmap für das angegebene Jahr plotten  </span>
    <span class="n">plot_calendarplot</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">1990</span><span class="p">)</span>  
    <span class="n">plot_calendarplot</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mi">2005</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Keine NetCDF-Datei für das angegebene Jahr gefunden.
Das neueste verfügbare Jahr wird ausgewählt.
Es werden Daten aus dem Jahr 2020 verwendet.
</pre></div>
</div>
<img alt="../../_images/1bd450ad7650c8e82714ad36a540a4d36594a123784e3608c92de95fb1d9b4b2.png" src="../../_images/1bd450ad7650c8e82714ad36a540a4d36594a123784e3608c92de95fb1d9b4b2.png" />
<img alt="../../_images/b9663e07f23e1424734bcfb1980ebc466f939cc6abcacb7e6af9a5bfa65fb512.png" src="../../_images/b9663e07f23e1424734bcfb1980ebc466f939cc6abcacb7e6af9a5bfa65fb512.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01-satellite-lake-water-level.html" class="btn btn-neutral float-left" title="Wasserstände von Seen abgleitet aus Satellitendaten" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Zurück</a>
        <a href="03-sis-temperature-statistics.html" class="btn btn-neutral float-right" title="Temperaturstatistiken für Europa" accesskey="n" rel="next">Weiter <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, str.ucture GmbH.</p>
  </div>

  Erstellt mit <a href="https://www.sphinx-doc.org/">Sphinx</a> mit einem
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    bereitgestellt von <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>