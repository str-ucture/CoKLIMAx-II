

<!DOCTYPE html>
<html class="writer-html5" lang="de" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alpine monatliche Niederschlagsdaten &mdash; Coklimax 1.0.0 Dokumentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=822aaed9" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f029ec32"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/translations.js?v=9bf55d28"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../../genindex.html" />
    <link rel="search" title="Suche" href="../../search.html" />
    <link rel="next" title="Klimaindikatoren für Europa" href="04-climate-indicators.html" />
    <link rel="prev" title="CDS Datensatz Notebooks" href="../../rst_jupyter_bibliothek/cds_data/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Coklimax
              <img src="../../_static/coklimax_logo_new.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Dokumentation durchsuchen" aria-label="Dokumentation durchsuchen" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Inhalte:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/01-softwarekenntnisse.html">Notwendige Software und Kenntnisse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/02-kurselemente.html">Die Kurs-Elemente</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/03-cds.html">Der Copernicus Climate Data Store (CDS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs 1:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/01-cds-api-installieren-und-herunterladen.html">CDS API Installation und Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/02-netcdf-einfuhrung.html">NetCDF Einführung</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs 2:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/01-satellite-lake-water-level.html">Wasserstände von Seen abgleitet aus Satellitendaten</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/02-satellite-lake-water-temperature.html">Seewassertemperatur aus Satellitendaten abgeleitet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/03-sis-temperature-statistics.html">Temperaturstatistiken für Europa</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Jupyter Notebook Bibliothek:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/index.html">Über CoKLIMAx-II Notebooks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../rst_jupyter_bibliothek/cds_data/index.html">CDS Datensatz Notebooks </a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Alpine monatliche Niederschlagsdaten</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#festlegen-der-pfade-und-arbeitsverzeichnisse">1. Festlegen der Pfade und Arbeitsverzeichnisse</a></li>
<li class="toctree-l3"><a class="reference internal" href="#herunterladen-und-entpacken-des-datensatzes">2. Herunterladen und Entpacken des Datensatzes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authentifizierung">2.1 Authentifizierung</a></li>
<li class="toctree-l4"><a class="reference internal" href="#definieren-sie-die-request-und-laden-sie-den-datensatz-herunter">2.2 Definieren Sie die „request“ und laden Sie den Datensatz herunter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extrahieren-sie-die-zip-datei-in-ordner">2.3 Extrahieren Sie die ZIP-Datei in Ordner</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#untersuchen-der-metadaten-der-netcdf4-datei">3. Untersuchen der Metadaten der NetCDF4-Datei</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exportieren-der-datensatz-im-csv-format">5. Exportieren der Datensatz im CSV-Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#begrenzungsrahmen-zum-filtern-von-daten-fur-konstanz-definieren">4.1 Begrenzungsrahmen zum Filtern von Daten für Konstanz definieren</a></li>
<li class="toctree-l4"><a class="reference internal" href="#daten-nach-begrenzungsbox-filtern-und-als-csv-exportieren">4.2 Daten nach Begrenzungsbox filtern und als CSV exportieren</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monatliche-mittelwerte-berechnen-und-als-csv-exportieren">4.3 Monatliche Mittelwerte berechnen und als CSV exportieren</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monatliche-durchschnittswerte-fur-einen-definierten-zeitraum-darstellen">4.4 Monatliche Durchschnittswerte für einen definierten Zeitraum darstellen</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exportieren-der-netcdf4-dateien-nach-geotiff">5. Exportieren der NetCDF4-Dateien nach GeoTIFF</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="04-climate-indicators.html">Klimaindikatoren für Europa</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/satellite_data/index.html">Satellitendaten Notebooks </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/visualizations/index.html">Visualization Options Library</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Coklimax</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../rst_jupyter_bibliothek/cds_data/index.html">CDS Datensatz Notebooks </a></li>
      <li class="breadcrumb-item active">Alpine monatliche Niederschlagsdaten</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/kurs_sonstiges/01-alpine-monthly-precipitation.ipynb.txt" rel="nofollow"> Quelltext anzeigen</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="alpine-monatliche-niederschlagsdaten">
<h1>Alpine monatliche Niederschlagsdaten<a class="headerlink" href="#alpine-monatliche-niederschlagsdaten" title="Link to this heading"></a></h1>
<p>Alpine monatliche Niederschlagsdaten seit 1871, abgeleitet aus stationären Beobachtungen: Der LAPrec-Datensatz (Long-term Alpine Precipitation Reconstruction) bietet monatliche Niederschlagsdaten für die Alpenregion und basiert auf stationären Beobachtungen. Es gibt zwei Versionen:</p>
<ul class="simple">
<li><p>LAPrec1871 (ab 1871, 85 Eingabereihen)</p></li>
<li><p>LAPrec1901 (ab 1901, 165 Eingabereihen)</p></li>
</ul>
<p>Der Datensatz erfüllt hohe klimatische Standards und ist eine wertvolle Grundlage für historische Klimaanalysen in den Alpen, einer Region, die stark vom Klimawandel betroffen ist. Es kombiniert die Datenquellen HISTALP (homogenisierte stationäre Niederschlagsdaten) und APGD (tägliche Rasterdaten von 1971–2008) und nutzt die Methode der Reduced Space Optimal Interpolation (RSOI). LAPrec wird alle zwei Jahre aktualisiert und wurde im Rahmen des Copernicus Climate Change Service in Zusammenarbeit mit den Wetterdiensten von Schweiz (MeteoSwiss) und Österreich (ZAMG) entwickelt.</p>
<p><strong>Informationen zum Datensatz:</strong></p>
<ul class="simple">
<li><p>Quelle: <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/insitu-gridded-observations-alpine-precipitation?tab=overview" rel="noopener noreferrer" target="_blank">Alpine Monthly Precipitation</a></p></li>
<li><p>Author: T. Tewes (City of Konstanz)</p></li>
<li><p>Notebook Version: 1.1 (Updated: December 05, 2024)</p></li>
</ul>
<section id="festlegen-der-pfade-und-arbeitsverzeichnisse">
<h2>1. Festlegen der Pfade und Arbeitsverzeichnisse<a class="headerlink" href="#festlegen-der-pfade-und-arbeitsverzeichnisse" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="sd">&#39;&#39;&#39; ---- Verzeichnisse hier angeben ---- &#39;&#39;&#39;</span>
<span class="n">download_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\download&quot;</span>
<span class="n">working_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\working&quot;</span>
<span class="n">geotiff_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\geotiff&quot;</span>
<span class="n">csv_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\csv&quot;</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\output&quot;</span>
<span class="sd">&#39;&#39;&#39; ----- Ende der Angaben ---- &#39;&#39;&#39;</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="herunterladen-und-entpacken-des-datensatzes">
<h2>2. Herunterladen und Entpacken des Datensatzes<a class="headerlink" href="#herunterladen-und-entpacken-des-datensatzes" title="Link to this heading"></a></h2>
<section id="authentifizierung">
<h3>2.1 Authentifizierung<a class="headerlink" href="#authentifizierung" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cdsapi</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># API-Key für die Authentifizierung</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;fdae60fd-35d4-436f-825c-c63fedab94a4&quot;</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://cds.climate.copernicus.eu/api&quot;</span>

    <span class="c1"># Erstellung des CDS-API-Clients</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="definieren-sie-die-request-und-laden-sie-den-datensatz-herunter">
<h3>2.2 Definieren Sie die „request“ und laden Sie den Datensatz herunter<a class="headerlink" href="#definieren-sie-die-request-und-laden-sie-den-datensatz-herunter" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definition des Datensatzes und der Request-Parameter</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;insitu-gridded-observations-alpine-precipitation&quot;</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dataset_issue&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;laprec1871&quot;</span><span class="p">,</span>
        <span class="s2">&quot;laprec1901&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1_2&quot;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Führen Sie es aus, um den Datensatz herunterzuladen:</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main_retrieve</span><span class="p">():</span>
    <span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.zip&quot;</span>
    <span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>

    <span class="c1"># Den Datensatz nur herunterladen, wenn er noch nicht heruntergeladen wurde</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">):</span>
        <span class="c1"># Rufen Sie den CDS-Client nur auf, wenn der Datensatz noch nicht heruntergeladen wurde.</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
        <span class="c1"># Den Datensatz mit den definierten Anforderungsparametern herunterladen</span>
        <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Datensatz bereits heruntergeladen.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main_retrieve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Datensatz bereits heruntergeladen.
</pre></div>
</div>
</div>
</div>
</section>
<section id="extrahieren-sie-die-zip-datei-in-ordner">
<h3>2.3 Extrahieren Sie die ZIP-Datei in Ordner<a class="headerlink" href="#extrahieren-sie-die-zip-datei-in-ordner" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

<span class="c1"># Erstellen des Dateinamens und des Dateipfads für die ZIP-Datei des Datensatzes</span>
<span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.zip&quot;</span>
<span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>

<span class="c1"># Definieren Sie einen Extraktionsordner für die ZIP-Datei, der dem Arbeitsordner entspricht</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">working_folder</span>

<span class="c1"># Entpacken der ZIP-Datei</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">):</span>
        <span class="c1"># Versuchen Sie, die ZIP-Datei zu öffnen und zu extrahieren</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
            <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dateien erfolgreich extrahiert nach: </span><span class="si">{</span><span class="n">extract_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ordner ist nicht leer. Entpacken überspringen.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler: Die Datei </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> wurde nicht gefunden.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler: Die Datei </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> ist keine gültige ZIP-Datei.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ein unerwarteter Fehler ist aufgetreten: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ordner ist nicht leer. Entpacken überspringen.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="untersuchen-der-metadaten-der-netcdf4-datei">
<h2>3. Untersuchen der Metadaten der NetCDF4-Datei<a class="headerlink" href="#untersuchen-der-metadaten-der-netcdf4-datei" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Liste der netCDF4-Dateien im Arbeits-/extrahierten Ordner drucken</span>
<span class="n">filename_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filename_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;LAPrec1871.v1.2.nc&#39;, &#39;LAPrec1901.v1.2.nc&#39;]
</pre></div>
</div>
</div>
</div>
<p>Der Datensatz <a href="https://cds.climate.copernicus.eu/datasets/insitu-gridded-observations-alpine-precipitation?tab=overview" target="_blank">Monatliche Niederschläge in den Alpen</a> enthält Aufzeichnungen ab 1871 oder 1901. In diesem Notizbuch verwenden wir den Datensatz von 1901 (LAPrec1901).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>

<span class="c1"># Definieren Sie den Dateipfad für den ausgewählten NetCDF-Datensatz</span>
<span class="n">nc_filename</span> <span class="o">=</span> <span class="s2">&quot;LAPrec1901.v1.2.nc&quot;</span>
<span class="n">nc_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">nc_filename</span><span class="p">)</span>

<span class="c1"># Öffnen der NetCDF-Datei im Lesemodus</span>
<span class="n">nc_dataset</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="c1"># Auflisten aller Variablen im Datensatz</span>
<span class="n">variables_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verfügbare Variablen: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">variables_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Verfügbare Variablen: [&#39;X&#39;, &#39;Y&#39;, &#39;time&#39;, &#39;LAPrec1901&#39;, &#39;lon&#39;, &#39;lat&#39;, &#39;dem&#39;, &#39;lambert_azimuthal_equal_area&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Variablennamen aus vorhandenen Variablen definieren und Variablendaten lesen</span>
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;LAPrec1901&#39;</span>
<span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>

<span class="c1"># Erstellen einer Zusammenfassung der Hauptvariablen</span>
<span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Variablename&quot;</span><span class="p">:</span> <span class="n">variable_name</span><span class="p">,</span>
    <span class="s2">&quot;Datentyp&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
    <span class="s2">&quot;Form&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="s2">&quot;Variableinfo&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">variable_data</span><span class="o">.</span><span class="n">dimensions</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Einheiten&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Langer Name&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Anzeigen der Zusammenfassung des Datensatzes als DataFrame zur besseren Visualisierung</span>
<span class="n">nc_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Beschreibung&#39;</span><span class="p">,</span> <span class="s1">&#39;Bemerkungen&#39;</span><span class="p">])</span>

<span class="c1"># Anzeigen des Zusammenfassungs-DataFrames</span>
<span class="n">nc_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Beschreibung</th>
      <th>Bemerkungen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Variablename</td>
      <td>LAPrec1901</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Datentyp</td>
      <td>int32</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Form</td>
      <td>(1440, 138, 219)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Variableinfo</td>
      <td>LAPrec1901(time, Y, X)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Einheiten</td>
      <td>kg m-2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Langer Name</td>
      <td>monthly precipitation sum</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Drucken Sie eine Zusammenfassung aller Variablen des Datensatzes</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables_list</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">var_obj</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var_obj</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">var_obj</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;nc_variablen&quot;</span><span class="p">:</span> <span class="n">variable</span><span class="p">,</span>
            <span class="s2">&quot;einheit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span>
            <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="n">shape</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler bei der Verarbeitung der Variable </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Erstelle ein DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nc_variablen</th>
      <th>einheit</th>
      <th>form</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>X</td>
      <td>m</td>
      <td>(219,)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Y</td>
      <td>m</td>
      <td>(138,)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>time</td>
      <td>days since 1901-01-01 00:00:00</td>
      <td>(1440,)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>LAPrec1901</td>
      <td>kg m-2</td>
      <td>(1440, 138, 219)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>lon</td>
      <td>degrees_east</td>
      <td>(138, 219)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>lat</td>
      <td>degrees_north</td>
      <td>(138, 219)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>dem</td>
      <td>m</td>
      <td>(138, 219)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>lambert_azimuthal_equal_area</td>
      <td>N/A</td>
      <td>()</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="exportieren-der-datensatz-im-csv-format">
<h2>5. Exportieren der Datensatz im CSV-Format<a class="headerlink" href="#exportieren-der-datensatz-im-csv-format" title="Link to this heading"></a></h2>
<section id="begrenzungsrahmen-zum-filtern-von-daten-fur-konstanz-definieren">
<h3>4.1 Begrenzungsrahmen zum Filtern von Daten für Konstanz definieren<a class="headerlink" href="#begrenzungsrahmen-zum-filtern-von-daten-fur-konstanz-definieren" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zusätzliche Anforderungsfelder definieren, um sicherzustellen, dass die Anfrage innerhalb der Dateigrößenbegrenzung bleibt.</span>
<span class="c1"># Diese Koordinaten wurden mit dem BBox Extractor Tool erhalten:</span>
<span class="c1"># https://str-ucture.github.io/bbox-extractor/</span>

<span class="c1"># Begrenzungsbox für die Region Konstanz (WGS84-Projektion):</span>
<span class="n">bbox_wgs84_konstanz</span> <span class="o">=</span> <span class="p">[</span><span class="mf">47.9</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">]</span>  <span class="c1"># Format: [Norden, Westen, Süden, Osten]</span>
<span class="n">bbox_wgs84_konstanz_standard</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">47.8</span><span class="p">]</span>  <span class="c1"># Standardformat: [Westen, Süden, Osten, Norden]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Alternativ können Sie ein Shapefile für eine präzise geografische Filterung verwenden</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyproj</span><span class="w"> </span><span class="kn">import</span> <span class="n">Transformer</span>

<span class="c1"># Beispiel: Shapefile von Konstanz laden (WGS84-Projektion)</span>
<span class="n">shapefile</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;./shapefiles/kn_boundary.shp&quot;</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">shapefile</span><span class="p">)</span>

<span class="c1"># Extrahieren Sie den Begrenzungsrahmen des Shapefiles</span>
<span class="n">shapefile_epsg</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>
<span class="n">shapefile_bounds</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span>

<span class="c1"># Definieren Sie die Quell- und Zielprojektionen</span>
<span class="n">proj_shapefile</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;epsg:</span><span class="si">{</span><span class="n">shapefile_epsg</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Quellprojektion (CRS der Shape-Datei)</span>
<span class="n">proj_laea</span> <span class="o">=</span> <span class="s2">&quot;epsg:3035&quot;</span>  <span class="c1"># Zielprojektion (LAEA für Europa)</span>

<span class="c1"># Definieren Sie einen Transformator, um die Koordinaten von der Quell- in die Zielprojektion umzuwandeln</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">proj_shapefile</span><span class="p">,</span> <span class="n">proj_laea</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Transformieren Sie die Koordinaten des Begrenzungsrahmens in die Zielprojektion (LAEA)</span>
<span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">shapefile_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shapefile_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Untere linke Ecke</span>
<span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">shapefile_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">shapefile_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># Obere rechte Ecke</span>
<span class="n">shapefile_bounds_laea</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">]</span>  <span class="c1"># Begrenzungsrahmen in LAEA-Projektion</span>

<span class="c1"># Anzeige des transformierten Begrenzungsrahmens</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Begrenzungsrahmen in LAEA:&quot;</span><span class="p">,</span> <span class="n">shapefile_bounds_laea</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Begrenzungsrahmen in LAEA: [4252254.817823338, 2727132.614227563, 4262344.998739288, 2739095.48723691]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Koordinatensystem: EPSG(</span><span class="si">{</span><span class="n">shapefile_epsg</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bounding Box: </span><span class="si">{</span><span class="n">shapefile_bounds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Schnelles Plotten Ihres Shapefiles</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Shapefile Darstellung&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Längengrad / X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Breitengrad / Y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Koordinatensystem: EPSG(4326)
Bounding Box: [ 9.08545411 47.65398657  9.21804389 47.762681  ]
</pre></div>
</div>
<img alt="../../_images/5f10c69ef79b708a8e3858da86b208dd6aa5f0e07e24cfff0a611b4081aaee74.png" src="../../_images/5f10c69ef79b708a8e3858da86b208dd6aa5f0e07e24cfff0a611b4081aaee74.png" />
</div>
</div>
<blockquote>
<div><p>Wichtig: Im Allgemeinen ist <strong>kn_bounds_laea</strong> ausreichend für die Extraktion von CSV- und GeoTIFF-Dateien. Allerdings können Anpassungen erforderlich sein, da:</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>x</strong> und <strong>y</strong> die Mittelpunkte der Rasterzellen darstellen, wodurch die Begrenzungsbox-Kanten möglicherweise nicht genau mit diesen Mittelpunkten übereinstimmen.</p></li>
<li><p>Ohne Anpassung könnten Rasterzellen nahe den Rändern ausgeschlossen werden, wenn die Begrenzungsbox-Kanten zwischen den Zellzentren liegen.</p></li>
<li><p>Eine Anpassung stellt sicher, dass alle relevanten Rasterzellen einbezogen werden.</p></li>
</ul>
<div style="display: flex; justify-content: center; gap: 10px;">
  <figure style="margin: 0;">
    <img src="./images/ppt_normal.png" width="400" style="border: 1px solid #aeaeae; display: block;">
    <figcaption style="text-align: center; margin-top: 5px;">Ausdehnung ohne BBox-Anpassung (kn_bounds_laea)</figcaption>
  </figure>
  <figure style="margin: 0;">
    <img src="./images/ppt_adjusted.png" width="400" style="border: 1px solid #aeaeae; display: block;">
    <figcaption style="text-align: center; margin-top: 5px;">Ausdehnung mit BBox-Anpassung (kn_bounds_laea_adjusted)</figcaption>
  </figure>
</div>
<p>Es wird empfohlen, <strong>kn_bounds_laea_adjusted</strong> für die Extraktion von GeoTIFF-Dateien zu verwenden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definiere den Variablennamen aus den verfügbaren Variablen und lese die Variablendaten ein</span>
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;LAPrec1901&#39;</span>
<span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][:]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">][:]</span>

<span class="c1"># Validierung der Begrenzungsbox-Dimensionen</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># X-Achsen-Auflösung</span>
<span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Y-Achsen-Auflösung</span>

<span class="c1"># Anpassung der Begrenzungsbox an die Rasterkanten</span>
<span class="n">x_min_adjusted</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_min</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">x_max_adjusted</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_max</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">y_min_adjusted</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_min</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">y_max_adjusted</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_max</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">shp_bounds_laea_adjusted</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_min_adjusted</span><span class="p">,</span> <span class="n">y_min_adjusted</span><span class="p">,</span> <span class="n">x_max_adjusted</span><span class="p">,</span> <span class="n">y_max_adjusted</span><span class="p">]</span>
<span class="c1"># print(shp_bounds_laea_adjusted)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="daten-nach-begrenzungsbox-filtern-und-als-csv-exportieren">
<h3>4.2 Daten nach Begrenzungsbox filtern und als CSV exportieren<a class="headerlink" href="#daten-nach-begrenzungsbox-filtern-und-als-csv-exportieren" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="c1"># Funktion zur Konvertierung von NetCDF-Daten in ein Pandas DataFrame</span>
<span class="k">def</span><span class="w"> </span><span class="nf">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_filepath</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">nc_filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>
        <span class="c1"># Zugriff auf die Variablendaten aus dem Dataset</span>
        <span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>

        <span class="c1"># Falls eine Begrenzungsbox angegeben ist, Daten filtern</span>
        <span class="k">if</span> <span class="n">bounding_box</span><span class="p">:</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                <span class="n">drop</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">variable_data</span>

        <span class="c1"># Konvertierung des xarray-Datasets in ein Pandas DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definiere den CSV-Dateinamen und den Dateipfad für die Ausgabe</span>
<span class="n">csv_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">_filtered_data.csv&quot;</span>
<span class="n">csv_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">csv_filename</span><span class="p">)</span>

<span class="c1"># Exportiere das DataFrame als CSV, falls es noch nicht existiert</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">):</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_filepath</span><span class="o">=</span><span class="n">nc_filepath</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="n">shp_bounds_laea_adjusted</span><span class="p">)</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datei existiert bereits unter </span><span class="si">{</span><span class="n">csv_filepath</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">Export wird übersprungen.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lesen bestehende CSV-Datei ein...&quot;</span><span class="p">)</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">])</span>

<span class="c1"># Zeige das DataFrame an</span>
<span class="n">dataframe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Datei existiert bereits unter .\data\alpine-monthly-precipitation\csv\LAPrec1901_filtered_data.csv.
Export wird übersprungen.
Lesen bestehende CSV-Datei ein...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>LAPrec1901</th>
    </tr>
    <tr>
      <th>time</th>
      <th>Y</th>
      <th>X</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">1901-01-01</th>
      <th rowspan="3" valign="top">2725000.0</th>
      <th>4250000.0</th>
      <td>37.0</td>
    </tr>
    <tr>
      <th>4255000.0</th>
      <td>36.0</td>
    </tr>
    <tr>
      <th>4260000.0</th>
      <td>36.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2730000.0</th>
      <th>4250000.0</th>
      <td>37.0</td>
    </tr>
    <tr>
      <th>4255000.0</th>
      <td>33.0</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">2020-12-01</th>
      <th rowspan="2" valign="top">2735000.0</th>
      <th>4255000.0</th>
      <td>57.0</td>
    </tr>
    <tr>
      <th>4260000.0</th>
      <td>56.0</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">2740000.0</th>
      <th>4250000.0</th>
      <td>56.0</td>
    </tr>
    <tr>
      <th>4255000.0</th>
      <td>57.0</td>
    </tr>
    <tr>
      <th>4260000.0</th>
      <td>58.0</td>
    </tr>
  </tbody>
</table>
<p>17280 rows × 1 columns</p>
</div></div></div>
</div>
</section>
<section id="monatliche-mittelwerte-berechnen-und-als-csv-exportieren">
<h3>4.3 Monatliche Mittelwerte berechnen und als CSV exportieren<a class="headerlink" href="#monatliche-mittelwerte-berechnen-und-als-csv-exportieren" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definiere den CSV-Dateinamen und den Dateipfad für die Ausgabe</span>
<span class="n">csv_filename_monthly_means</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">_monthly_means.csv&quot;</span>
<span class="n">csv_filepath_monthly_means</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">csv_filename_monthly_means</span><span class="p">)</span>

<span class="c1"># Exportiere die Pivot-Tabelle als CSV, falls sie noch nicht existiert</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">csv_filepath_monthly_means</span><span class="p">):</span>
    <span class="c1"># Konvertiere die &#39;time&#39;-Spalte in das Datetime-Format</span>
    <span class="n">filtered_df_copy</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

    <span class="c1"># Extrahiere Jahr und Monat aus der &#39;time&#39;-Spalte</span>
    <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

    <span class="c1"># Gruppiere nach Jahr und Monat, berechne den Mittelwert für die angegebene Variable</span>
    <span class="n">monthly_means</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">filtered_df_copy</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">])[</span><span class="n">variable_name</span><span class="p">]</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="o">.</span><span class="n">round</span><span class="p">({</span><span class="n">variable_name</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
    <span class="p">)</span>

    <span class="c1"># Erstelle eine Pivot-Tabelle mit Jahren als Zeilen und Monaten als Spalten</span>
    <span class="n">df_monthly_means</span> <span class="o">=</span> <span class="n">monthly_means</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">variable_name</span><span class="p">)</span>

    <span class="c1"># Stelle sicher, dass alle Monate (1–12) enthalten sind, und füge jährliche Summen hinzu</span>
    <span class="n">df_monthly_means</span> <span class="o">=</span> <span class="n">df_monthly_means</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
    <span class="n">df_monthly_means</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Yearly_Sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_monthly_means</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_monthly_means</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filepath_monthly_means</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Monatliche Mittelwerte erfolgreich exportiert nach </span><span class="si">{</span><span class="n">csv_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datei existiert bereits unter </span><span class="si">{</span><span class="n">csv_filepath</span><span class="si">}</span><span class="s2">. Export wird übersprungen.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bestehende CSV-Datei wird eingelesen...&quot;</span><span class="p">)</span>
    <span class="n">df_monthly_means</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filepath_monthly_means</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">])</span>

<span class="c1"># Zeige die Pivot-Tabelle an</span>
<span class="n">df_monthly_means</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Datei existiert bereits unter .\data\alpine-monthly-precipitation\csv\LAPrec1901_filtered_data.csv. Export wird übersprungen.
Bestehende CSV-Datei wird eingelesen...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
      <th>12</th>
      <th>Yearly_Sum</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1901</th>
      <td>31.17</td>
      <td>26.00</td>
      <td>65.42</td>
      <td>124.58</td>
      <td>16.50</td>
      <td>129.33</td>
      <td>84.33</td>
      <td>88.00</td>
      <td>88.08</td>
      <td>36.17</td>
      <td>25.33</td>
      <td>44.50</td>
      <td>759.41</td>
    </tr>
    <tr>
      <th>1902</th>
      <td>32.00</td>
      <td>55.58</td>
      <td>53.75</td>
      <td>35.92</td>
      <td>107.08</td>
      <td>72.33</td>
      <td>89.25</td>
      <td>115.42</td>
      <td>78.00</td>
      <td>78.92</td>
      <td>15.25</td>
      <td>79.83</td>
      <td>813.33</td>
    </tr>
    <tr>
      <th>1903</th>
      <td>35.00</td>
      <td>27.83</td>
      <td>37.00</td>
      <td>53.17</td>
      <td>39.83</td>
      <td>88.50</td>
      <td>131.33</td>
      <td>100.67</td>
      <td>45.00</td>
      <td>76.00</td>
      <td>81.08</td>
      <td>16.58</td>
      <td>731.99</td>
    </tr>
    <tr>
      <th>1904</th>
      <td>29.17</td>
      <td>95.75</td>
      <td>36.58</td>
      <td>60.75</td>
      <td>129.83</td>
      <td>78.33</td>
      <td>22.17</td>
      <td>64.00</td>
      <td>98.83</td>
      <td>34.25</td>
      <td>44.92</td>
      <td>40.08</td>
      <td>734.66</td>
    </tr>
    <tr>
      <th>1905</th>
      <td>44.08</td>
      <td>24.33</td>
      <td>84.17</td>
      <td>83.67</td>
      <td>75.58</td>
      <td>64.33</td>
      <td>76.42</td>
      <td>178.92</td>
      <td>117.50</td>
      <td>101.50</td>
      <td>47.33</td>
      <td>37.58</td>
      <td>935.41</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>144.00</td>
      <td>90.67</td>
      <td>32.08</td>
      <td>100.50</td>
      <td>154.08</td>
      <td>153.42</td>
      <td>97.17</td>
      <td>62.58</td>
      <td>48.75</td>
      <td>48.25</td>
      <td>70.08</td>
      <td>1.42</td>
      <td>1003.00</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>47.58</td>
      <td>50.00</td>
      <td>49.08</td>
      <td>100.50</td>
      <td>79.83</td>
      <td>82.67</td>
      <td>114.75</td>
      <td>109.25</td>
      <td>75.17</td>
      <td>42.17</td>
      <td>84.50</td>
      <td>89.00</td>
      <td>924.50</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>108.92</td>
      <td>41.92</td>
      <td>44.33</td>
      <td>13.25</td>
      <td>84.83</td>
      <td>62.08</td>
      <td>44.75</td>
      <td>69.17</td>
      <td>64.75</td>
      <td>38.25</td>
      <td>13.08</td>
      <td>94.92</td>
      <td>680.25</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>55.67</td>
      <td>35.50</td>
      <td>51.50</td>
      <td>43.50</td>
      <td>140.00</td>
      <td>68.00</td>
      <td>99.58</td>
      <td>117.67</td>
      <td>64.33</td>
      <td>101.58</td>
      <td>43.58</td>
      <td>48.25</td>
      <td>869.16</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>28.33</td>
      <td>110.08</td>
      <td>53.50</td>
      <td>24.75</td>
      <td>63.17</td>
      <td>115.33</td>
      <td>49.08</td>
      <td>150.50</td>
      <td>41.25</td>
      <td>85.58</td>
      <td>21.75</td>
      <td>60.92</td>
      <td>804.24</td>
    </tr>
  </tbody>
</table>
<p>120 rows × 13 columns</p>
</div></div></div>
</div>
</section>
<section id="monatliche-durchschnittswerte-fur-einen-definierten-zeitraum-darstellen">
<h3>4.4 Monatliche Durchschnittswerte für einen definierten Zeitraum darstellen<a class="headerlink" href="#monatliche-durchschnittswerte-fur-einen-definierten-zeitraum-darstellen" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ticker</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_monthly_averages</span><span class="p">(</span>
        <span class="n">start_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_year</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stellt die monatlichen Durchschnittswerte einer Variablen mit</span>
<span class="sd">    Fehlerbalken für einen bestimmten Zeitraum dar.</span>

<span class="sd">    Parameter:</span>
<span class="sd">        start_year (int): Startjahr für den Datensatz (optional).</span>
<span class="sd">        end_year (int): Endjahr für den Datensatz (optional).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Gefiltertes DataFrame aus der CSV-Datei einlesen</span>
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">)</span>
    <span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

    <span class="c1"># Bestimmen Sie den Zeitraum</span>
    <span class="n">min_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    <span class="n">max_year</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    
    <span class="c1"># Start- und Endjahr an den verfügbaren Datenbereich anpassen</span>
    <span class="k">if</span> <span class="n">start_year</span> <span class="ow">and</span> <span class="n">end_year</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Das angegebene Startjahr </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2"> liegt vor dem Datenbereich.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Startjahr wird auf </span><span class="si">{</span><span class="n">min_year</span><span class="si">}</span><span class="s2"> angepasst.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Das angegebene Endjahr </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2"> liegt nach dem Datenbereich.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Endjahr wird auf </span><span class="si">{</span><span class="n">max_year</span><span class="si">}</span><span class="s2"> angepasst.&quot;</span><span class="p">)</span>

            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">min_year</span><span class="p">)</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end_year</span><span class="p">,</span> <span class="n">max_year</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">min_year</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">max_year</span>
        
    <span class="c1"># Daten für den definierten Zeitraum filtern</span>
    <span class="n">df_period</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Monatliche Statistik berechnen: Mittelwert und Standardabweichung</span>
    <span class="n">monthly_stats</span> <span class="o">=</span> <span class="n">df_period</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df_period</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>

    <span class="c1"># Diagramm erstellen</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="c1"># Balkendiagramm mit Fehlerbalken zeichnen</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">monthly_stats</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">error_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.75</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Dynamischen Y-Achsenbereich setzen</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="n">y_min</span> <span class="o">//</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">20</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">//</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">20</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>

    <span class="c1"># Hilfslinien hinzufügen</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">))</span>

    <span class="c1"># Achsenbeschriftungen und Titel anpassen</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Monat&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Durchschnittlicher Niederschlag (mm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;Durchschnittlicher Niederschlag pro Monat (Zeitraum Jan </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s1"> - Dez </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span>
    <span class="p">)</span>

    <span class="c1"># X-Achse mit Monatsnamen beschriften</span>
    <span class="n">month_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mär&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;Mai&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Okt&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dez&#39;</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">month_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Layout anpassen und Diagramm anzeigen</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Geben Sie den Jahresbereich an, um den monatlichen Durchschnitt zu filtern und darzustellen.</span>
<span class="c1"># Wenn kein Bereich angegeben wird, wird der komplette Datensatz verwendet.</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">plot_monthly_averages</span><span class="p">()</span>  <span class="c1"># Plot mit vollständigem Datensatz</span>
    <span class="n">plot_monthly_averages</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">2020</span><span class="p">)</span> <span class="c1"># Plot mit angegebenem Jahresbereich</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/72e6e98895a52f43e255e7039ecaf858b4805ff85416aa5eb638abc362b5bb39.png" src="../../_images/72e6e98895a52f43e255e7039ecaf858b4805ff85416aa5eb638abc362b5bb39.png" />
<img alt="../../_images/0c9347e15291f1cf03775113f8e7dbadbd810a6f1cbebd92ce3c4357d64f63bc.png" src="../../_images/0c9347e15291f1cf03775113f8e7dbadbd810a6f1cbebd92ce3c4357d64f63bc.png" />
</div>
</div>
</section>
</section>
<section id="exportieren-der-netcdf4-dateien-nach-geotiff">
<h2>5. Exportieren der NetCDF4-Dateien nach GeoTIFF<a class="headerlink" href="#exportieren-der-netcdf4-dateien-nach-geotiff" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../rst_jupyter_bibliothek/cds_data/index.html" class="btn btn-neutral float-left" title="CDS Datensatz Notebooks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Zurück</a>
        <a href="04-climate-indicators.html" class="btn btn-neutral float-right" title="Klimaindikatoren für Europa" accesskey="n" rel="next">Weiter <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, str.ucture GmbH.</p>
  </div>

  Erstellt mit <a href="https://www.sphinx-doc.org/">Sphinx</a> mit einem
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    bereitgestellt von <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>