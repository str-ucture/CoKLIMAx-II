

<!DOCTYPE html>
<html class="writer-html5" lang="de" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Klimaindikatoren für Europa &mdash; Coklimax 1.0.0 Dokumentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=822aaed9" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f029ec32"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../_static/translations.js?v=9bf55d28"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Stichwortverzeichnis" href="../../genindex.html" />
    <link rel="search" title="Suche" href="../../search.html" />
    <link rel="next" title="Satellitendaten Notebooks" href="../../rst_jupyter_bibliothek/satellite_data/index.html" />
    <link rel="prev" title="Heat Wave and Cold Spells" href="02-sis-heat-wave-and-cold-spells.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Coklimax
              <img src="../../_static/coklimax_logo_new.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Dokumentation durchsuchen" aria-label="Dokumentation durchsuchen" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Inhalte:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/01-softwarekenntnisse.html">Notwendige Software und Kenntnisse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/02-kurselemente.html">Die Kurs-Elemente</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/03-cds.html">Der Copernicus Climate Data Store (CDS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs 1:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/01-cds-api-installieren-und-herunterladen.html">CDS API Installation und Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/02-netcdf-einfuhrung.html">NetCDF Einführung</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Kurs 2:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/01-satellite-lake-water-level.html">Wasserstände von Seen abgleitet aus Satellitendaten</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/02-satellite-lake-water-temperature.html">Seewassertemperatur aus Satellitendaten abgeleitet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/03-sis-temperature-statistics.html">Temperaturstatistiken für Europa</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Jupyter Notebook Bibliothek:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/index.html">Über CoKLIMAx-II Notebooks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../rst_jupyter_bibliothek/cds_data/index.html">CDS Datensatz Notebooks </a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01-alpine-monthly-precipitation.html">Alpine monatliche Niederschlagsdaten</a></li>
<li class="toctree-l2"><a class="reference internal" href="02-sis-heat-wave-and-cold-spells.html">Heat Wave and Cold Spells</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Klimaindikatoren für Europa</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#festlegen-der-pfade-und-arbeitsverzeichnisse">1. Festlegen der Pfade und Arbeitsverzeichnisse</a></li>
<li class="toctree-l3"><a class="reference internal" href="#herunterladen-und-entpacken-des-datensatzes">2. Herunterladen und Entpacken des Datensatzes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authentifizierung">2.1 Authentifizierung</a></li>
<li class="toctree-l4"><a class="reference internal" href="#definieren-sie-die-request-und-laden-sie-den-datensatz-herunter">2.2 Definieren Sie die „request“ und laden Sie den Datensatz herunter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extrahieren-sie-die-zip-dateien-in-ordner">2.3 Extrahieren Sie die ZIP-Dateien in Ordner</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#untersuchen-der-metadaten-der-netcdf4-datei">3. Untersuchen der Metadaten der NetCDF4-Datei</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#erstellen-eines-dataframe-mit-verfugbaren-netcdf-dateien">3.1 Erstellen eines DataFrame mit verfügbaren NetCDF-Dateien</a></li>
<li class="toctree-l4"><a class="reference internal" href="#einzigartige-variablennamen-und-verfugbare-variablen-ausgeben">3.2 Einzigartige Variablennamen und verfügbare Variablen ausgeben</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exportieren-der-netcdf4-dateien-im-csv-format">4. Exportieren der NetCDF4-Dateien im CSV-Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#definieren-eine-funktion-zum-konvertieren-von-netcdf-daten-in-dataframe">4.1 Definieren eine Funktion zum Konvertieren von NetCDF-Daten in DataFrame</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filtern-nach-boundary-box-dataframe-erstellen-und-als-csv-datei-exportieren">4.2 Filtern nach Boundary Box, DataFrame erstellen und als CSV-Datei exportieren</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#analyse-und-visualisierung-optionen">5. Analyse und Visualisierung Optionen</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#definieren-ein-ein-interaktives-widget-um-eine-variable-fur-die-visualisierung-auszuwahlen">5.1 Definieren ein ein interaktives Widget, um eine Variable für die Visualisierung auszuwählen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#definieren-farbkodierte-designstile-fur-die-visualisierung">5.2 Definieren farbkodierte Designstile für die Visualisierung</a></li>
<li class="toctree-l4"><a class="reference internal" href="#abrufen-und-zusammenfuhren-von-daten-aus-reanalyse-und-projektionsdatensatzen">5.3 Abrufen und Zusammenführen von Daten aus Reanalyse- und Projektionsdatensätzen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#berechnung-des-jahresmittels-und-der-anomalie-fur-reanalysedaten">5.4 Berechnung des Jahresmittels und der Anomalie für Reanalysedaten</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualisierung-der-jahrlichen-anomalien-mit-einer-balkengrafik">5.5 Visualisierung der jährlichen Anomalien mit einer Balkengrafik</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualisierung-des-jahresmittelwerts-mit-einer-trendlinie">5.6 Visualisierung des Jahresmittelwerts mit einer Trendlinie</a></li>
<li class="toctree-l4"><a class="reference internal" href="#aufbereitung-von-reanalyse-und-projektionsdaten-fur-die-visualisierung">5.7 Aufbereitung von Reanalyse- und Projektionsdaten für die Visualisierung</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualisierung-der-jahresmittelwerte-der-reanalyse-und-klimaprojektionsdaten-rcp4-5-und-rcp8-5-mit-einer-trendlinie">5.8 Visualisierung der Jahresmittelwerte der Reanalyse- und Klimaprojektionsdaten (RCP4.5 und RCP8.5) mit einer Trendlinie</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visualisierung-der-jahresmittelwerte-der-reanalyse-und-klimaprojektionsdaten-rcp4-5-und-rcp8-5-mit-standardabweichung">5.9 Visualisierung der Jahresmittelwerte der Reanalyse- und Klimaprojektionsdaten (RCP4.5 und RCP8.5) mit Standardabweichung</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/satellite_data/index.html">Satellitendaten Notebooks </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/visualizations/index.html">Visualization Options Library</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Coklimax</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../rst_jupyter_bibliothek/cds_data/index.html">CDS Datensatz Notebooks </a></li>
      <li class="breadcrumb-item active">Klimaindikatoren für Europa</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/kurs_sonstiges/04-climate-indicators.ipynb.txt" rel="nofollow"> Quelltext anzeigen</a>
<div id='language-switcher' style='text-align: right; margin-top: 10px;'>
    <select onchange="location = this.value;">
        <option value='/./CoKLIMAx-II/en\notebooks\kurs_sonstiges\04-climate-indicators.html'>EN</option>
        <option value='/./CoKLIMAx-II/de\notebooks\kurs_sonstiges\04-climate-indicators.html' selected>DE</option>
    </select>
</div>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="klimaindikatoren-fur-europa">
<h1>Klimaindikatoren für Europa<a class="headerlink" href="#klimaindikatoren-fur-europa" title="Link to this heading"></a></h1>
<p>Dieses Datenset enthält Klimadaten, die aus Reanalyse- und Modellsimulationen stammen und im Copernicus Climate Data Store (CDS) verfügbar sind. Es bietet Klimaindizes, die die Auswirkungen von Klimavariabilität und -wandel auf Sektoren wie Gesundheit, Landwirtschaft, Energie und Wasserwirtschaft beschreiben. Diese Indizes sind wichtig für die Anpassungsplanung auf europäischer und nationaler Ebene und wurden von der Europäischen Umweltagentur (EEA) entwickelt, um die Bedürfnisse nationaler Klimaanpassungsinitiativen in der EU zu erfüllen.</p>
<p>Die Indizes basieren auf Daten aus verschiedenen CDS-Datensätzen und umfassen Temperatur-, Niederschlags- und Windindikatoren. Sie wurden aus den Datensätzen „Climate and energy indicators for Europe from 2005 to 2100“ und „ERA5 hourly data on single levels from 1940 to present“ berechnet. Weitere Indizes stammen aus thematischen Projekten des CDS.</p>
<p><strong>Informationen zum Datensatz:</strong></p>
<ul class="simple">
<li><p>Quelle: <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/sis-ecde-climate-indicators?tab=download" rel="noreferrer" target="_blank">Climate Indicators</a></p></li>
<li><p>Author: T. Tewes (City of Konstanz)</p></li>
<li><p>Notebook Version: 1.2 (Updated: December 13, 2024)</p></li>
</ul>
<section id="festlegen-der-pfade-und-arbeitsverzeichnisse">
<h2>1. Festlegen der Pfade und Arbeitsverzeichnisse<a class="headerlink" href="#festlegen-der-pfade-und-arbeitsverzeichnisse" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="sd">&#39;&#39;&#39; ---- Verzeichnisse hier angeben ---- &#39;&#39;&#39;</span>
<span class="n">download_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\download&quot;</span>
<span class="n">working_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\working&quot;</span>
<span class="n">geotiff_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\geotiff&quot;</span>
<span class="n">csv_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\csv&quot;</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\climate-indicators\output&quot;</span>
<span class="sd">&#39;&#39;&#39; ----- Ende der Angaben ---- &#39;&#39;&#39;</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="herunterladen-und-entpacken-des-datensatzes">
<h2>2. Herunterladen und Entpacken des Datensatzes<a class="headerlink" href="#herunterladen-und-entpacken-des-datensatzes" title="Link to this heading"></a></h2>
<section id="authentifizierung">
<h3>2.1 Authentifizierung<a class="headerlink" href="#authentifizierung" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cdsapi</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># API-Key für die Authentifizierung</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;fdae60fd-35d4-436f-825c-c63fedab94a4&quot;</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://cds.climate.copernicus.eu/api&quot;</span>

    <span class="c1"># Erstellung des CDS-API-Clients</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="definieren-sie-die-request-und-laden-sie-den-datensatz-herunter">
<h3>2.2 Definieren Sie die „request“ und laden Sie den Datensatz herunter<a class="headerlink" href="#definieren-sie-die-request-und-laden-sie-den-datensatz-herunter" title="Link to this heading"></a></h3>
<p>Definieren Sie zusätzliche Anfragefelder, um sicherzustellen, dass die Anfrage innerhalb der Dateigrößenbeschränkung bleibt. Bei der Arbeit mit Geodaten oder APIs, die Karten- oder Satellitenbilder zurückgeben, kann die Begrenzung des geografischen Interessengebiets verhindern, dass Anfragen zu groß werden und die Datei- oder Verarbeitungsgrenzen überschreiten. Begrenzungsrahmen (Bounding Boxes) werden verwendet, um das geografische Gebiet für solche Anfragen festzulegen.</p>
<p>Die untenstehenden Koordinaten wurden mit dem Tool <a href="https://str-ucture.github.io/bbox-extractor/" target="_blank">BBox Extractor</a> ermittelt.</p>
<p><em>BBox Extractor ist ein webbasiertes Tool, das Benutzern hilft, interaktiv Begrenzungsrahmen-Koordinaten im WGS84-Format (Breite/Länge) auszuwählen und zu generieren. Dies ist besonders nützlich für APIs oder Datensätze, die eine Eingabe eines geografischen Gebiets erfordern</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definieren der Begrenzungsrahmen-Koordinaten (WGS84-Format)</span>
<span class="c1"># Das Koordinatenformat lautet: [Norden, Westen, Süden, Osten]</span>
<span class="n">bbox_wgs84_deutschland</span> <span class="o">=</span> <span class="p">[</span><span class="mf">56.0</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">,</span> <span class="mf">47.2</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">]</span>
<span class="n">bbox_wgs84_konstanz</span> <span class="o">=</span> <span class="p">[</span><span class="mf">47.9</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Alternativ können Sie ein Shapefile für eine präzise geografische Filterung verwenden</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="c1"># Beispiel: Shapefile von Konstanz laden (WGS84-Projektion)</span>
<span class="n">de_shapefile</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;./shapefiles/de_boundary.shp&quot;</span>
<span class="n">de_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">de_shapefile</span><span class="p">)</span>

<span class="c1"># Extrahieren Sie den Begrenzungsrahmen des Shapefiles</span>
<span class="n">de_bounds</span> <span class="o">=</span> <span class="n">de_gdf</span><span class="o">.</span><span class="n">total_bounds</span>

<span class="c1"># Passen Sie den Begrenzungsrahmen an und puffern Sie ihn, um einen etwas größeren</span>
<span class="n">de_bounds_adjusted</span> <span class="o">=</span> <span class="p">[(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">de_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">de_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">de_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">de_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span> <span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">]</span>

<span class="c1"># Ordnen Sie die Koordinaten in das Format: [Nord, West, Süd, Ost] um.</span>
<span class="n">bbox_de_bounds_adjusted</span> <span class="o">=</span> <span class="p">[</span><span class="n">de_bounds_adjusted</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">de_bounds_adjusted</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">de_bounds_adjusted</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">de_bounds_adjusted</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fall I: Anforderung ist definiert für Herkunft: Projektionen</span>
<span class="c1"># Es werden Variablen aus der Variablengruppe „Heat and cold“ und „Wet and dry“ ausgewählt.</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;sis-ecde-climate-indicators&quot;</span>
<span class="n">request_rea</span><span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;growing_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;heating_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cooling_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tropical_nights&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hot_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;warmest_three_day_period&quot;</span><span class="p">,</span>
        <span class="s2">&quot;heatwave_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;high_utci_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frost_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;total_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;maximum_consecutive_five_day_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extreme_precipitation_total&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frequency_of_extreme_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;consecutive_dry_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;duration_of_meteorological_droughts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;magnitude_of_meteorological_droughts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;days_with_high_fire_danger&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extreme_wind_speed_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fire_weather_index&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;reanalysis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;temporal_aggregation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;yearly&quot;</span><span class="p">],</span>
    <span class="s2">&quot;spatial_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;gridded&quot;</span><span class="p">,</span>
    <span class="s2">&quot;other_parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;30_c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;35_c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;40_c&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">bbox_de_bounds_adjusted</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fall II: Anfrage ist definiert für Herkunft: Projektionen</span>
<span class="c1"># Es werden Variablen aus der Variablengruppe „Heat and cold“ und „Wet and dry“ ausgewählt.</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;sis-ecde-climate-indicators&quot;</span>
<span class="n">request_proj</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;growing_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;heating_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cooling_degree_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tropical_nights&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hot_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;warmest_three_day_period&quot;</span><span class="p">,</span>
        <span class="s2">&quot;heatwave_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frost_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;total_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;maximum_consecutive_five_day_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extreme_precipitation_total&quot;</span><span class="p">,</span>
        <span class="s2">&quot;frequency_of_extreme_precipitation&quot;</span><span class="p">,</span>
        <span class="s2">&quot;consecutive_dry_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;duration_of_meteorological_droughts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;magnitude_of_meteorological_droughts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;days_with_high_fire_danger&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extreme_wind_speed_days&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fire_weather_index&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;projections&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gcm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mpi_esm_lr&quot;</span><span class="p">],</span>
    <span class="s2">&quot;rcm&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cclm4_8_17&quot;</span><span class="p">],</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;rcp4_5&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rcp8_5&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;ensemble_member&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;r1i1p1&quot;</span><span class="p">],</span>
    <span class="s2">&quot;temporal_aggregation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;yearly&quot;</span><span class="p">],</span>
    <span class="s2">&quot;spatial_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;gridded&quot;</span><span class="p">,</span>
    <span class="s2">&quot;other_parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;30_c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;35_c&quot;</span><span class="p">,</span>
        <span class="s2">&quot;40_c&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">bbox_de_bounds_adjusted</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Führen Sie es aus, um den Datensatz herunterzuladen:</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main_retrieve</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="p">[</span><span class="n">request_rea</span><span class="p">,</span> <span class="n">request_proj</span><span class="p">]:</span>
        <span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.zip&quot;</span>
        <span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>

        <span class="c1"># Den Datensatz nur herunterladen, wenn er noch nicht heruntergeladen wurde</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">):</span>
            <span class="c1"># Rufen Sie den CDS-Client nur auf, wenn der Datensatz noch nicht heruntergeladen wurde.</span>
            <span class="n">client</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
            <span class="c1"># Den Datensatz mit den definierten Anforderungsparametern herunterladen</span>
            <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Datensatz bereits heruntergeladen.&quot;</span><span class="p">)</span>
        
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main_retrieve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:10,816 INFO [2024-09-26T00:00:00] Watch our [Forum](https://forum.ecmwf.int/) for Announcements, news and other discussed topics.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:10,818 WARNING [2024-06-16T00:00:00] CDS API syntax is changed and some keys or parameter names may have also changed. To avoid requests failing, please use the &quot;Show API request code&quot; tool on the dataset Download Form to check you are using the correct syntax for your API request.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:11,001 INFO Request ID is 75a07222-322b-419d-ade7-10ce2f7f4c6a
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:11,073 INFO status has been updated to accepted
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:24,629 INFO status has been updated to successful
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "6a4e24d346634e00ba85e63632fe935e"}</script><div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:28,131 INFO [2024-09-26T00:00:00] Watch our [Forum](https://forum.ecmwf.int/) for Announcements, news and other discussed topics.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:28,133 WARNING [2024-06-16T00:00:00] CDS API syntax is changed and some keys or parameter names may have also changed. To avoid requests failing, please use the &quot;Show API request code&quot; tool on the dataset Download Form to check you are using the correct syntax for your API request.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:28,318 INFO Request ID is d9a6e9ce-87da-4eb2-b3ae-f79670f3a25c
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:28,433 INFO status has been updated to accepted
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-03-10 13:30:36,882 INFO status has been updated to running
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">line</span> <span class="mi">17</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>             <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Datensatz bereits heruntergeladen.&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">17</span>     <span class="n">main_retrieve</span><span class="p">()</span>

<span class="nn">Cell In[7], line 12,</span> in <span class="ni">main_retrieve</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">client</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="c1"># Den Datensatz mit den definierten Anforderungsparametern herunterladen</span>
<span class="ne">---&gt; </span><span class="mi">12</span>     <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Datensatz bereits heruntergeladen.&quot;</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\envs\cds_env\lib\site-packages\datapi\legacy_api_client.py:169,</span> in <span class="ni">LegacyApiClient.retrieve</span><span class="nt">(self, name, request, target)</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span> <span class="n">submitted</span><span class="p">:</span> <span class="n">Remote</span> <span class="o">|</span> <span class="n">Results</span>
<span class="g g-Whitespace">    </span><span class="mi">168</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait_until_complete</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">169</span>     <span class="n">submitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">submit_and_wait_on_results</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">170</span>         <span class="n">collection_id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span>         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">173</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span>     <span class="n">submitted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">175</span>         <span class="n">collection_id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">176</span>         <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">177</span>     <span class="p">)</span>

<span class="nn">File ~\anaconda3\envs\cds_env\lib\site-packages\datapi\api_client.py:399,</span> in <span class="ni">ApiClient.submit_and_wait_on_results</span><span class="nt">(self, collection_id, request)</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span> <span class="k">def</span><span class="w"> </span><span class="nf">submit_and_wait_on_results</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span>     <span class="bp">self</span><span class="p">,</span> <span class="n">collection_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datapi</span><span class="o">.</span><span class="n">Results</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Submit a request and wait for the results to be ready.</span>
<span class="g g-Whitespace">    </span><span class="mi">387</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">388</span><span class="sd">     Parameters</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">397</span><span class="sd">     datapi.Results</span>
<span class="g g-Whitespace">    </span><span class="mi">398</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">399</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_api</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">collection_id</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">get_results</span><span class="p">()</span>

<span class="nn">File ~\anaconda3\envs\cds_env\lib\site-packages\datapi\processing.py:545,</span> in <span class="ni">Remote.get_results</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">538</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_results</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">539</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Retrieve results.</span>
<span class="g g-Whitespace">    </span><span class="mi">540</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">541</span><span class="sd">     Returns</span>
<span class="g g-Whitespace">    </span><span class="mi">542</span><span class="sd">     -------</span>
<span class="g g-Whitespace">    </span><span class="mi">543</span><span class="sd">     datapi.Results</span>
<span class="g g-Whitespace">    </span><span class="mi">544</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">545</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_results</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\envs\cds_env\lib\site-packages\datapi\processing.py:520,</span> in <span class="ni">Remote._make_results</span><span class="nt">(self, wait)</span>
<span class="g g-Whitespace">    </span><span class="mi">518</span> <span class="k">def</span><span class="w"> </span><span class="nf">_make_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wait</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Results</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">519</span>     <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">520</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_wait_on_results</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">521</span>     <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_api_response</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">522</span>     <span class="k">try</span><span class="p">:</span>

<span class="nn">File ~\anaconda3\envs\cds_env\lib\site-packages\datapi\processing.py:500,</span> in <span class="ni">Remote._wait_on_results</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">498</span> <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_ready</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">499</span>     <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;results not ready, waiting for </span><span class="si">{</span><span class="n">sleep</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">500</span>     <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">501</span>     <span class="n">sleep</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sleep</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sleep_max</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</section>
<section id="extrahieren-sie-die-zip-dateien-in-ordner">
<h3>2.3 Extrahieren Sie die ZIP-Dateien in Ordner<a class="headerlink" href="#extrahieren-sie-die-zip-dateien-in-ordner" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

<span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="p">[</span><span class="n">request_rea</span><span class="p">,</span> <span class="n">request_proj</span><span class="p">]:</span>
    <span class="c1"># Definieren Sie den Ordner, in dem die extrahierten Dateien gespeichert werden</span>
    <span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.zip&quot;</span>
    <span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>

    <span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Entpacken der ZIP-Datei</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">):</span>
            <span class="c1"># Versuchen Sie, die ZIP-Datei zu öffnen und zu extrahieren</span>
            <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
                <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dateien erfolgreich extrahiert nach: </span><span class="si">{</span><span class="n">extract_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ordner ist nicht leer. Entpacken überspringen.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler: Die Datei </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> wurde nicht gefunden.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fehler: Die Datei </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> ist keine gültige ZIP-Datei.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ein unerwarteter Fehler ist aufgetreten: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Ordner ist nicht leer. Entpacken überspringen.
Ordner ist nicht leer. Entpacken überspringen.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="untersuchen-der-metadaten-der-netcdf4-datei">
<h2>3. Untersuchen der Metadaten der NetCDF4-Datei<a class="headerlink" href="#untersuchen-der-metadaten-der-netcdf4-datei" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definieren den Ursprung der Daten, entweder „projections“ oder „reanalysis“</span>
<span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;reanalysis&quot;</span>

<span class="c1"># Erstellen den Pfad zum Ordner, in dem die extrahierten Daten gespeichert werden</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="erstellen-eines-dataframe-mit-verfugbaren-netcdf-dateien">
<h3>3.1 Erstellen eines DataFrame mit verfügbaren NetCDF-Dateien<a class="headerlink" href="#erstellen-eines-dataframe-mit-verfugbaren-netcdf-dateien" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>

<span class="k">def</span><span class="w"> </span><span class="nf">meta</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="c1"># Überprüfen, ob der Dateiname dem erwarteten Muster entspricht</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?P&lt;index&gt;\w+?)_(?P&lt;ds_variable&gt;[a-zA-Z_]+?)-(?P&lt;ds_origin&gt;\w+?)-(?P&lt;ds_temporal_aggregation&gt;\w+)(?:-(?P&lt;ds_stat&gt;min|max|mean))?(?:-(?P&lt;ds_grid&gt;\d+deg))?(?:-(?P&lt;ds_rcp&gt;rcp_\d+_\d+))?&quot;</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>

    <span class="c1"># Fehler ausgeben, wenn der Dateiname nicht dem erwarteten Schema entspricht</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;Der angegebene Dateiname entspricht nicht dem erwarteten Benennungsschema.&quot;</span><span class="p">)</span>

    <span class="c1"># Funktion zum Extrahieren des Variablennamens aus der NetCDF-Datei</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_nc_variable</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>
            <span class="n">nc_variable_name</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[</span><span class="o">*</span><span class="n">nc_variable_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Metadaten als Dictionary zurückgeben</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span>
        <span class="c1"># index=match.group(&#39;index&#39;),</span>
        <span class="n">ds_variable</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_variable&#39;</span><span class="p">),</span>
        <span class="n">ds_origin</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_origin&#39;</span><span class="p">),</span>
        <span class="n">ds_temporal_aggregation</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_temporal_aggregation&#39;</span><span class="p">),</span>
        <span class="c1"># ds_stat=match.group(&#39;ds_stat&#39;),</span>
        <span class="n">variable_name</span><span class="o">=</span><span class="n">get_nc_variable</span><span class="p">(),</span>
        <span class="n">ds_grid</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_grid&#39;</span><span class="p">),</span>
        <span class="n">ds_rcp</span><span class="o">=</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ds_rcp&#39;</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># Metadaten für alle NetCDF-Dateien im Ordner extrahieren</span>
<span class="c1"># Das Dictionary &#39;nc_files&#39; enthält alle relevanten Metadaten der verfügbaren NetCDF4-Dateien</span>
<span class="c1"># Dieses Dictionary wird später verwendet, um die Dateien in GeoTiff zu konvertieren</span>
<span class="n">nc_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">meta</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">)]</span>
<span class="n">df_nc_files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">nc_files</span><span class="p">)</span>

<span class="c1"># Pandas-Anzeigeoptionen anpassen</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_colwidth</span> <span class="o">=</span> <span class="mi">24</span>

<span class="c1"># DataFrame anzeigen, ohne die Spalte &#39;path&#39; darzustellen</span>
<span class="n">df_nc_files</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_nc_files</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filename</th>
      <th>ds_variable</th>
      <th>ds_origin</th>
      <th>ds_temporal_aggregation</th>
      <th>variable_name</th>
      <th>ds_grid</th>
      <th>ds_rcp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>02_growing_degree_da...</td>
      <td>growing_degree_days</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>t2m</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>03_heating_degree_da...</td>
      <td>heating_degree_days</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>data</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>04_cooling_degree_da...</td>
      <td>cooling_degree_days</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>data</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>05_tropical_nights-r...</td>
      <td>tropical_nights</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>t2m</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>06_hot_days-reanalys...</td>
      <td>hot_days</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>t2m</td>
      <td>30deg</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>06_hot_days-reanalys...</td>
      <td>hot_days</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>t2m</td>
      <td>35deg</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>06_hot_days-reanalys...</td>
      <td>hot_days</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>t2m</td>
      <td>40deg</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>07_warmest_three_day...</td>
      <td>warmest_three_day_pe...</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>t2m</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>09_heat_waves_climat...</td>
      <td>heat_waves_climatolo...</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>data</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10_high_utci_days-re...</td>
      <td>high_utci_days</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>high_utci_days</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="einzigartige-variablennamen-und-verfugbare-variablen-ausgeben">
<h3>3.2 Einzigartige Variablennamen und verfügbare Variablen ausgeben<a class="headerlink" href="#einzigartige-variablennamen-und-verfugbare-variablen-ausgeben" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Variable definieren, um bereits verarbeitete Variablennamen zu speichern und Duplikate zu vermeiden  </span>
<span class="n">seen_variables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="c1"># Alle Variablen in jeder NetCDF-Datei auflisten  </span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nc_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nc_files</span><span class="p">):</span>
    <span class="n">variable_name</span> <span class="o">=</span> <span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
    
    <span class="c1"># Überspringen, wenn die Variable bereits verarbeitet wurde  </span>
    <span class="k">if</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="n">seen_variables</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="c1"># NetCDF-Datei im Lesemodus öffnen  </span>
    <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>  
        <span class="c1"># Alle Variablen im aktuellen Datensatz auflisten  </span>
        <span class="n">variables_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  
        
        <span class="c1"># Details der Datei und ihrer Variablen ausgeben  </span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">:</span><span class="s2">&lt;2</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">variable_name</span><span class="si">:</span><span class="s2">&lt;18</span><span class="si">}</span><span class="s2">: Verfügbare Variablen: </span><span class="si">{</span><span class="n">variables_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
    
    <span class="c1"># Diese Variable als verarbeitet markieren  </span>
    <span class="n">seen_variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1  t2m               : Verfügbare Variablen: [&#39;t2m&#39;, &#39;time&#39;, &#39;realization&#39;, &#39;lat&#39;, &#39;lon&#39;]
2  data              : Verfügbare Variablen: [&#39;data&#39;, &#39;time&#39;, &#39;realization&#39;, &#39;lat&#39;, &#39;lon&#39;]
10 high_utci_days    : Verfügbare Variablen: [&#39;high_utci_days&#39;, &#39;time&#39;, &#39;height&#39;, &#39;lon&#39;, &#39;lat&#39;]
12 tp                : Verfügbare Variablen: [&#39;tp&#39;, &#39;time&#39;, &#39;realization&#39;, &#39;lat&#39;, &#39;lon&#39;]
16 cdd               : Verfügbare Variablen: [&#39;cdd&#39;, &#39;realization&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;time&#39;]
17 dmd               : Verfügbare Variablen: [&#39;dmd&#39;, &#39;lat&#39;, &#39;lon&#39;, &#39;realization&#39;, &#39;time&#39;]
19 fwi               : Verfügbare Variablen: [&#39;fwi&#39;, &#39;time&#39;, &#39;lon&#39;, &#39;lat&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Alle Variableninformationen in jeder NetCDF-Datei auflisten  </span>
<span class="n">seen_variables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<span class="c1"># Alle variablen Informationen in jeder NetCDF-Datei auflisten</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nc_file</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nc_files</span><span class="p">):</span>
    <span class="n">variable_name</span> <span class="o">=</span> <span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
    
    <span class="c1"># Überspringen, wenn die Variable bereits verarbeitet wurde</span>
    <span class="k">if</span> <span class="n">variable_name</span> <span class="ow">in</span> <span class="n">seen_variables</span><span class="p">:</span>
        <span class="k">continue</span>
    
    <span class="c1"># NetCDF-Datei im Lesemodus öffnen</span>
    <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>  
        <span class="c1"># Primärvariable-Daten abrufen  </span>
        <span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>  

        <span class="c1"># Zusammenfassung der Primärvariable erstellen  </span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>  
            <span class="s2">&quot;Variablenname&quot;</span><span class="p">:</span> <span class="n">variable_name</span><span class="p">,</span>  
            <span class="s2">&quot;Datentyp&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>  
            <span class="s2">&quot;Form&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>  
            <span class="s2">&quot;Variableninfo&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_data</span><span class="o">.</span><span class="n">dimensions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>  
            <span class="s2">&quot;Einheiten&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>  
            <span class="s2">&quot;Langer Name&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>  
        <span class="p">}</span>  

        <span class="c1"># Datensatz-Zusammenfassung als DataFrame zur besseren Visualisierung anzeigen  </span>
        <span class="n">nc_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Beschreibung&#39;</span><span class="p">,</span> <span class="s1">&#39;Bemerkungen&#39;</span><span class="p">])</span>  
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">. Zusammenfassung der Variable &#39;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">&#39;:&quot;</span><span class="p">)</span>  
        <span class="n">display</span><span class="p">(</span><span class="n">nc_summary</span><span class="p">)</span>  

    <span class="c1"># Variablenname zur Liste der bereits verarbeiteten Variablen hinzufügen  </span>
    <span class="n">seen_variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">variable_name</span><span class="p">)</span>  

    <span class="c1"># Ausgabe begrenzen  </span>
    <span class="n">output_limit</span> <span class="o">=</span> <span class="mi">2</span>  
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seen_variables</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">output_limit</span><span class="p">:</span>  
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;.... (Ausgabe auf die ersten </span><span class="si">{</span><span class="n">output_limit</span><span class="si">}</span><span class="s2"> Variablen gekürzt)&quot;</span><span class="p">)</span>  
        <span class="k">break</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1. Zusammenfassung der Variable &#39;t2m&#39;:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Beschreibung</th>
      <th>Bemerkungen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Variablenname</td>
      <td>t2m</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Datentyp</td>
      <td>float32</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Form</td>
      <td>(84, 32, 38)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Variableninfo</td>
      <td>('time', 'lat', 'lon')</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Einheiten</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Langer Name</td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2. Zusammenfassung der Variable &#39;data&#39;:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Beschreibung</th>
      <th>Bemerkungen</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Variablenname</td>
      <td>data</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Datentyp</td>
      <td>float32</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Form</td>
      <td>(84, 32, 38)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Variableninfo</td>
      <td>('time', 'lat', 'lon')</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Einheiten</td>
      <td>K</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Langer Name</td>
      <td>N/A</td>
    </tr>
  </tbody>
</table>
</div></div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>.... (Ausgabe auf die ersten 2 Variablen gekürzt)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="exportieren-der-netcdf4-dateien-im-csv-format">
<h2>4. Exportieren der NetCDF4-Dateien im CSV-Format<a class="headerlink" href="#exportieren-der-netcdf4-dateien-im-csv-format" title="Link to this heading"></a></h2>
<section id="definieren-eine-funktion-zum-konvertieren-von-netcdf-daten-in-dataframe">
<h3>4.1 Definieren eine Funktion zum Konvertieren von NetCDF-Daten in DataFrame<a class="headerlink" href="#definieren-eine-funktion-zum-konvertieren-von-netcdf-daten-in-dataframe" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="c1"># Funktion zur Konvertierung von NetCDF-Daten in ein Pandas DataFrame</span>
<span class="k">def</span><span class="w"> </span><span class="nf">netcdf_to_dataframe</span><span class="p">(</span>
    <span class="n">nc_file</span><span class="p">,</span>
    <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="c1"># Öffne das NetCDF-Dataset im Lesemodus</span>
    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">])</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>
        <span class="c1"># Zugriff auf die Variablendaten aus dem Datensatz</span>
        <span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]]</span>
        
        <span class="c1"># Sicherstellen, dass die Namen für Breiten- und Längengrad korrekt sind</span>
        <span class="n">latitude_name</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span> <span class="k">if</span> <span class="s1">&#39;latitude&#39;</span> <span class="ow">in</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">coords</span> <span class="k">else</span> <span class="s1">&#39;lat&#39;</span>
        <span class="n">longitude_name</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span> <span class="k">if</span> <span class="s1">&#39;longitude&#39;</span> <span class="ow">in</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">coords</span> <span class="k">else</span> <span class="s1">&#39;lon&#39;</span>
        
        <span class="c1"># Falls eine Begrenzungsbox angegeben ist, die Daten filtern</span>
        <span class="k">if</span> <span class="n">bounding_box</span><span class="p">:</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="n">latitude_name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="n">latitude_name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="n">longitude_name</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="n">longitude_name</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="n">drop</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">variable_data</span>

        <span class="c1"># Umwandlung des xarray-Datensatzes in ein Pandas DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">latitude_name</span><span class="p">,</span> <span class="n">longitude_name</span><span class="p">])</span>

        <span class="c1"># Entfernen nicht benötigter Spalten (variiert je nach Datensatz)</span>
        <span class="k">if</span> <span class="s1">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;quantile&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;quantile&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="filtern-nach-boundary-box-dataframe-erstellen-und-als-csv-datei-exportieren">
<h3>4.2 Filtern nach Boundary Box, DataFrame erstellen und als CSV-Datei exportieren<a class="headerlink" href="#filtern-nach-boundary-box-dataframe-erstellen-und-als-csv-datei-exportieren" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zusätzliche Anforderungsfelder definieren, um sicherzustellen, dass die Anfrage innerhalb der Dateigrößenbegrenzung bleibt.</span>
<span class="c1"># Diese Koordinaten wurden mit dem BBox Extractor Tool erhalten:</span>
<span class="c1"># https://str-ucture.github.io/bbox-extractor/</span>

<span class="c1"># Begrenzungsbox für die Region Konstanz (WGS84-Projektion):</span>
<span class="n">bbox_wgs84_konstanz</span> <span class="o">=</span> <span class="p">[</span><span class="mf">47.9</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">]</span>  <span class="c1"># Format: [Norden, Westen, Süden, Osten]</span>
<span class="n">bbox_wgs84_konstanz_standard</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">47.8</span><span class="p">]</span>  <span class="c1"># Standardformat: [Westen, Süden, Osten, Norden]</span>

<span class="c1"># Definieren den Ursprung der Daten, entweder „projections“ oder „reanalysis“</span>
<span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;projections&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ordner basierend auf zeitlicher Aggregation erstellen</span>
<span class="n">subset_csv_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">subset_csv_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Alle netCDF4-Dateien in einzelne CSV-Dateien exportieren</span>
<span class="k">for</span> <span class="n">nc_file</span> <span class="ow">in</span> <span class="n">nc_files</span><span class="p">:</span>
    <span class="c1"># CSV-Dateiname und Pfad für die Ausgabe definieren</span>
    <span class="n">csv_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nc_file</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.csv&quot;</span>
    <span class="n">csv_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subset_csv_folder</span><span class="p">,</span> <span class="n">csv_filename</span><span class="p">)</span>

    <span class="c1"># Exportiere das DataFrame als CSV, falls es noch nicht existiert</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">):</span>
        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file</span><span class="p">)</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Datei existiert bereits unter </span><span class="si">{</span><span class="n">csv_filepath</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">Überspringen den Export.&quot;</span><span class="p">)</span>
        <span class="n">csv_filename_latest</span> <span class="o">=</span> <span class="n">csv_filepath</span>
        
        <span class="k">break</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Letzte vorhandene CSV-Datei lesen...&quot;</span><span class="p">)</span>
<span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">])</span>

<span class="c1"># Zeige das DataFrame an</span>
<span class="n">dataframe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Datei existiert bereits unter .\data\climate-indicators\csv\projections_yearly\02_growing_degree_days-reanalysis-yearly-grid-1940-2023-v1.0.area-subset.55.2.15.2.47.1.5.7.nc.csv.
Überspringen den Export.
Letzte vorhandene CSV-Datei lesen...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>realization</th>
      <th>t2m</th>
    </tr>
    <tr>
      <th>time</th>
      <th>lat</th>
      <th>lon</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">1940-01-01</th>
      <th rowspan="5" valign="top">47.25</th>
      <th>5.75</th>
      <td>0</td>
      <td>2209.1602</td>
    </tr>
    <tr>
      <th>6.00</th>
      <td>0</td>
      <td>2158.9377</td>
    </tr>
    <tr>
      <th>6.25</th>
      <td>0</td>
      <td>2055.9540</td>
    </tr>
    <tr>
      <th>6.50</th>
      <td>0</td>
      <td>1832.0024</td>
    </tr>
    <tr>
      <th>6.75</th>
      <td>0</td>
      <td>1662.9482</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">2023-01-01</th>
      <th rowspan="5" valign="top">55.00</th>
      <th>14.00</th>
      <td>0</td>
      <td>2009.1061</td>
    </tr>
    <tr>
      <th>14.25</th>
      <td>0</td>
      <td>2005.1495</td>
    </tr>
    <tr>
      <th>14.50</th>
      <td>0</td>
      <td>1994.5411</td>
    </tr>
    <tr>
      <th>14.75</th>
      <td>0</td>
      <td>1979.5626</td>
    </tr>
    <tr>
      <th>15.00</th>
      <td>0</td>
      <td>1966.1664</td>
    </tr>
  </tbody>
</table>
<p>102144 rows × 2 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="analyse-und-visualisierung-optionen">
<h2>5. Analyse und Visualisierung Optionen<a class="headerlink" href="#analyse-und-visualisierung-optionen" title="Link to this heading"></a></h2>
<section id="definieren-ein-ein-interaktives-widget-um-eine-variable-fur-die-visualisierung-auszuwahlen">
<h3>5.1 Definieren ein ein interaktives Widget, um eine Variable für die Visualisierung auszuwählen<a class="headerlink" href="#definieren-ein-ein-interaktives-widget-um-eine-variable-fur-die-visualisierung-auszuwahlen" title="Link to this heading"></a></h3>
<blockquote>
<div><p>Wichtig: Wählen Sie die Variable, die für die Visualisierung von Interesse ist.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ipywidgets</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ipywidgets</span>

<span class="c1"># Liste aller verfügbaren Variablen erstellen</span>
<span class="n">ds_variable_list</span> <span class="o">=</span> <span class="n">df_nc_files</span><span class="p">[</span><span class="s1">&#39;ds_variable&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="c1"># Dropdown-Widget für die Auswahl einer Variablen erstellen</span>
<span class="n">selected_ds_variable</span> <span class="o">=</span> <span class="n">ipywidgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span>
    <span class="n">options</span><span class="o">=</span><span class="n">ds_variable_list</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Eine Variable auswählen:&#39;</span><span class="p">,</span>
    <span class="n">disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;description_width&#39;</span><span class="p">:</span> <span class="s1">&#39;auto&#39;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">selected_ds_variable</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b843d991dad74710a438512090cca8ff", "version_major": 2, "version_minor": 0}</script></div>
</div>
</section>
<section id="definieren-farbkodierte-designstile-fur-die-visualisierung">
<h3>5.2 Definieren farbkodierte Designstile für die Visualisierung<a class="headerlink" href="#definieren-farbkodierte-designstile-fur-die-visualisierung" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Farben</span>
<span class="n">color_reanalyse</span> <span class="o">=</span> <span class="s2">&quot;#008000&quot;</span> <span class="c1">#Reanalyse</span>
<span class="n">color_rcp4_5</span> <span class="o">=</span> <span class="s2">&quot;#005d82&quot;</span> <span class="c1">#RCP4.5</span>
<span class="n">color_rcp8_5</span> <span class="o">=</span> <span class="s2">&quot;#ce1657&quot;</span> <span class="c1">#RCP8.5</span>

<span class="c1"># Darstellung der Reanalyse-Daten</span>
<span class="n">design_reanalyse</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Reanalyse&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color_reanalyse</span><span class="p">,</span>
    <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der RCP4.5-Daten</span>
<span class="n">design_rcp45</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;RCP4.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color_rcp4_5</span><span class="p">,</span>
    <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der RCP8.5-Daten</span>
<span class="n">design_rcp85</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;RCP8.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color_rcp8_5</span><span class="p">,</span>
    <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;markersize&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">0.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der Trendlinie RCP4.5</span>
<span class="n">design_rcp45_trend</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Trend RCP4.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color_rcp4_5</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der Trendlinie RCP8.5</span>
<span class="n">design_rcp85_trend</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Trend RCP8.5&#39;</span><span class="p">,</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color_rcp8_5</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.5</span>
<span class="p">}</span>

<span class="c1"># Darstellung der Trennline zwischen Reanalyse und Projektionsdaten</span>
<span class="n">datum_trennlinie</span> <span class="o">=</span> <span class="s1">&#39;2024-01-01&#39;</span>  <span class="c1"># wenn neuere Reanalyse-Daten vorliegen, müsste dieses Datum angepasst werden</span>
<span class="n">design_trennlinie</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;grey&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span>
    <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">2.5</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="abrufen-und-zusammenfuhren-von-daten-aus-reanalyse-und-projektionsdatensatzen">
<h3>5.3 Abrufen und Zusammenführen von Daten aus Reanalyse- und Projektionsdatensätzen<a class="headerlink" href="#abrufen-und-zusammenfuhren-von-daten-aus-reanalyse-und-projektionsdatensatzen" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Daten aus der Reanalyse abrufen</span>
<span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;reanalysis&quot;</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">nc_files_reanalysis</span> <span class="o">=</span> <span class="p">[</span><span class="n">meta</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>

<span class="c1"># Daten aus den Projektionen abrufen</span>
<span class="n">origin</span> <span class="o">=</span> <span class="s2">&quot;projections&quot;</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">origin</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;temporal_aggregation&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">nc_files_projections</span> <span class="o">=</span> <span class="p">[</span><span class="n">meta</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span> <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">]</span>

<span class="c1"># Daten zusammenführen und DataFrame erstellen</span>
<span class="n">nc_files_merged</span> <span class="o">=</span> <span class="n">nc_files_reanalysis</span> <span class="o">+</span> <span class="n">nc_files_projections</span>
<span class="n">df_nc_files_merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">nc_files_merged</span><span class="p">)</span>

<span class="c1"># &#39;path&#39;-Spalte ausschließen</span>
<span class="n">df_nc_files_merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">df_nc_files_merged</span><span class="o">.</span><span class="n">columns</span> <span class="o">!=</span> <span class="s1">&#39;path&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>filename</th>
      <th>ds_variable</th>
      <th>ds_origin</th>
      <th>ds_temporal_aggregation</th>
      <th>variable_name</th>
      <th>ds_grid</th>
      <th>ds_rcp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>02_growing_degree_da...</td>
      <td>growing_degree_days</td>
      <td>reanalysis</td>
      <td>yearly</td>
      <td>t2m</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>02_growing_degree_da...</td>
      <td>growing_degree_days</td>
      <td>projections</td>
      <td>yearly</td>
      <td>tasAdjust</td>
      <td>None</td>
      <td>rcp_4_5</td>
    </tr>
    <tr>
      <th>2</th>
      <td>02_growing_degree_da...</td>
      <td>growing_degree_days</td>
      <td>projections</td>
      <td>yearly</td>
      <td>tasAdjust</td>
      <td>None</td>
      <td>rcp_8_5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nc_file_reanalysis</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">nc_file_proj_rcp45</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">nc_file_proj_rcp85</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Bestimmte Zeilen aus den zusammengeführten Daten extrahieren</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">nc_files_merged</span><span class="p">:</span>
    <span class="c1"># Erstes Vorkommen, bei dem ds_origin &#39;reanalysis&#39; ist</span>
    <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_origin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;reanalysis&#39;</span> <span class="ow">and</span> <span class="n">nc_file_reanalysis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nc_file_reanalysis</span> <span class="o">=</span> <span class="n">file</span>
    
    <span class="c1"># Erstes Vorkommen, bei dem ds_origin &#39;projections&#39; und ds_rcp &#39;rcp_4_5&#39; ist</span>
    <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_origin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="ow">and</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_rcp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rcp_4_5&#39;</span> <span class="ow">and</span> <span class="n">nc_file_proj_rcp45</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nc_file_proj_rcp45</span> <span class="o">=</span> <span class="n">file</span>
    
    <span class="c1"># Erstes Vorkommen, bei dem ds_origin &#39;projections&#39; und ds_rcp &#39;rcp_8_5&#39; ist</span>
    <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_origin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;projections&#39;</span> <span class="ow">and</span> <span class="n">file</span><span class="p">[</span><span class="s1">&#39;ds_rcp&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;rcp_8_5&#39;</span> <span class="ow">and</span> <span class="n">nc_file_proj_rcp85</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nc_file_proj_rcp85</span> <span class="o">=</span> <span class="n">file</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="berechnung-des-jahresmittels-und-der-anomalie-fur-reanalysedaten">
<h3>5.4 Berechnung des Jahresmittels und der Anomalie für Reanalysedaten<a class="headerlink" href="#berechnung-des-jahresmittels-und-der-anomalie-fur-reanalysedaten" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_reanalysis_yearly_mean</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">):</span>
    <span class="c1"># Lade die nc_file_reanalysis und konvertiere sie in ein DataFrame</span>
    <span class="n">variable_name_reanalysis</span> <span class="o">=</span> <span class="n">nc_file_reanalysis</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
    <span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file_reanalysis</span><span class="p">,</span>
                                        <span class="n">bounding_box</span><span class="o">=</span><span class="n">bbox_wgs84_konstanz_standard</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1"># Filtere das DataFrame für den Referenzzeitraum</span>
    <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="n">df_reanalysis_ref_period</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span>
                                             <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>

    <span class="c1"># Berechne den Mittelwert für den Referenzzeitraum und die Anomalie</span>
    <span class="n">reference_mean</span> <span class="o">=</span> <span class="n">df_reanalysis_ref_period</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df_reanalysis</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">]</span> <span class="o">-</span> <span class="n">reference_mean</span>

    <span class="c1"># Berechne den jährlichen Mittelwert und entferne die Spalten &#39;lat&#39; und &#39;lon&#39;</span>
    <span class="n">df_reanalysis_yearly_mean</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">df_reanalysis</span>
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">variable_name_reanalysis</span><span class="p">,</span> <span class="n">df_reanalysis</span><span class="p">,</span> <span class="n">df_reanalysis_yearly_mean</span>

<span class="c1"># Berechne den jährlichen Mittelwert für die Reanalyse-Daten</span>
<span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="o">=</span> <span class="mi">1971</span><span class="p">,</span> <span class="mi">2010</span>
<span class="n">variable_name_reanalysis</span><span class="p">,</span> <span class="n">df_reanalysis</span><span class="p">,</span> <span class="n">df_reanalysis_yearly_mean</span> <span class="o">=</span> <span class="n">compute_reanalysis_yearly_mean</span><span class="p">(</span><span class="n">start_year</span><span class="o">=</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="n">end_year</span><span class="p">)</span>

<span class="c1"># Zeige das DataFrame an</span>
<span class="n">df_reanalysis_yearly_mean</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time</th>
      <th>realization</th>
      <th>t2m</th>
      <th>anomaly</th>
    </tr>
    <tr>
      <th>time</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1940</th>
      <td>1940-01-01</td>
      <td>0.0</td>
      <td>1850.592773</td>
      <td>-219.633362</td>
    </tr>
    <tr>
      <th>1941</th>
      <td>1941-01-01</td>
      <td>0.0</td>
      <td>1655.679443</td>
      <td>-414.546570</td>
    </tr>
    <tr>
      <th>1942</th>
      <td>1942-01-01</td>
      <td>0.0</td>
      <td>2059.707275</td>
      <td>-10.518799</td>
    </tr>
    <tr>
      <th>1943</th>
      <td>1943-01-01</td>
      <td>0.0</td>
      <td>2053.417969</td>
      <td>-16.807983</td>
    </tr>
    <tr>
      <th>1944</th>
      <td>1944-01-01</td>
      <td>0.0</td>
      <td>1942.366699</td>
      <td>-127.859436</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="visualisierung-der-jahrlichen-anomalien-mit-einer-balkengrafik">
<h3>5.5 Visualisierung der jährlichen Anomalien mit einer Balkengrafik<a class="headerlink" href="#visualisierung-der-jahrlichen-anomalien-mit-einer-balkengrafik" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># Erstelle ein Diagramm</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Zeichne negative Werte</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
       <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span> 
       <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
       <span class="n">color</span><span class="o">=</span><span class="n">color_rcp4_5</span><span class="p">,</span>
       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Negative Abweichung&#39;</span><span class="p">)</span>

<span class="c1"># Zeichne positive Werte</span>
<span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
       <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">][</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">],</span> 
       <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
       <span class="n">color</span><span class="o">=</span><span class="n">color_rcp8_5</span><span class="p">,</span>
       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Positive Abweichung&#39;</span><span class="p">)</span>

<span class="c1"># Füge eine Nulllinie hinzu</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Achsenbeschriftungen und Titel setzen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Jahr&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mittlere jährliche Anomalie&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Referenzzeitraum </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Anomalie in </span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="mf">0.52</span><span class="p">)</span>

<span class="c1"># Raster hinzufügen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># X-Achse: Alle 5-Jahres-Intervalle anzeigen</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                      <span class="n">end</span><span class="o">=</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                      <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Beschreibung hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.035</span><span class="p">,</span>
    <span class="p">(</span>
       <span class="s1">&#39;Quelle: Copernicus Climate Change Service (C3S),&#39;</span>
       <span class="s1">&#39;Climate Data Store (CDS), (2024): Klimaindikatoren für Europa von 1940 bis 2100&#39;</span>
       <span class="s1">&#39;abgeleitet aus Reanalyse- und Klimaprojektionen,&#39;</span>
       <span class="s1">&#39;Copernicus Climate Change Service (C3S) Climate Data Store (CDS).&#39;</span>
       <span class="s1">&#39;(Zugriff am 01-08-2024)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Legende hinzufügen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Layout anpassen und Diagramm anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d01639f7f53b1015d5063e814ead7e6ad42f11759670792f1f14e836dbcd0f76.png" src="../../_images/d01639f7f53b1015d5063e814ead7e6ad42f11759670792f1f14e836dbcd0f76.png" />
</div>
</div>
</section>
<section id="visualisierung-des-jahresmittelwerts-mit-einer-trendlinie">
<h3>5.6 Visualisierung des Jahresmittelwerts mit einer Trendlinie<a class="headerlink" href="#visualisierung-des-jahresmittelwerts-mit-einer-trendlinie" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Erstelle ein Diagramm</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Zeichne die Zeitreihe</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># Zeichne die Trendlinie</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
               <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
        <span class="n">p</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trend&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_reanalyse</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>

<span class="c1"># Achsenbeschriftungen und Titel setzen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Jahr&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Jährlicher Mittelwert&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Referenzzeitraum: </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="c1"># Haupttitel setzen</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jährlicher </span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="mf">0.52</span><span class="p">)</span>

<span class="c1"># Begrenzung der X-Achse setzen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Raster hinzufügen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># X-Achse: Alle 5-Jahres-Intervalle anzeigen</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                      <span class="n">end</span><span class="o">=</span><span class="n">df_reanalysis_yearly_mean</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                      <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;5YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Beschreibung hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.035</span><span class="p">,</span>
    <span class="p">(</span>
       <span class="s1">&#39;Quelle: Copernicus Climate Change Service (C3S),&#39;</span>
       <span class="s1">&#39;Climate Data Store (CDS), (2024): Klimaindikatoren für Europa von 1940 bis 2100&#39;</span>
       <span class="s1">&#39;abgeleitet aus Reanalyse- und Klimaprojektionen,&#39;</span>
       <span class="s1">&#39;Copernicus Climate Change Service (C3S) Climate Data Store (CDS).&#39;</span>
       <span class="s1">&#39;(Zugriff am 01-08-2024)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Legende hinzufügen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Layout anpassen und Diagramm anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9c387ee8e4bf9390a42852b95174a3bf2da6f270f36e78a3eb8c950a2c42e081.png" src="../../_images/9c387ee8e4bf9390a42852b95174a3bf2da6f270f36e78a3eb8c950a2c42e081.png" />
</div>
</div>
</section>
<section id="aufbereitung-von-reanalyse-und-projektionsdaten-fur-die-visualisierung">
<h3>5.7 Aufbereitung von Reanalyse- und Projektionsdaten für die Visualisierung<a class="headerlink" href="#aufbereitung-von-reanalyse-und-projektionsdaten-fur-die-visualisierung" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_projection_data</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">intermediate_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">):</span>
    <span class="c1"># Extrahieren der Variablendaten aus den NetCDF-Dateien</span>
    <span class="n">variable_name_reanalysis</span> <span class="o">=</span> <span class="n">nc_file_reanalysis</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
    <span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file_reanalysis</span><span class="p">,</span>
                                        <span class="n">bounding_box</span><span class="o">=</span><span class="n">bbox_wgs84_konstanz_standard</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    
    <span class="n">variable_name_projections</span> <span class="o">=</span> <span class="n">nc_file_proj_rcp45</span><span class="p">[</span><span class="s1">&#39;variable_name&#39;</span><span class="p">]</span>
    <span class="n">df_rcp45</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file_proj_rcp45</span><span class="p">,</span>
                                   <span class="n">bounding_box</span><span class="o">=</span><span class="n">bbox_wgs84_konstanz_standard</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df_rcp85</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_file</span><span class="o">=</span><span class="n">nc_file_proj_rcp85</span><span class="p">,</span>
                                   <span class="n">bounding_box</span><span class="o">=</span><span class="n">bbox_wgs84_konstanz_standard</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1"># Konvertierung der Zeitspalte in das Datetime-Format</span>
    <span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>
    <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

    <span class="c1"># Filtern der Datensätze auf der Grundlage der angegebenen Zeiträume</span>
    <span class="n">df_reanalysis</span> <span class="o">=</span> <span class="n">df_reanalysis</span><span class="p">[(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span> <span class="o">&amp;</span> 
                                  <span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">intermediate_year</span><span class="p">)]</span>
    <span class="n">df_rcp45</span> <span class="o">=</span> <span class="n">df_rcp45</span><span class="p">[(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">intermediate_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> 
                        <span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>
    <span class="n">df_rcp85</span> <span class="o">=</span> <span class="n">df_rcp85</span><span class="p">[(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">intermediate_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)]</span>

    <span class="c1"># Hinzufügen der Spalte „Jahr“ zu den Projektionsdaten zur einfacheren Aggregation</span>
    <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

    <span class="c1"># Berechnung des gleitenden 30-Jahres-Durchschnitts für beide Szenarien</span>
    <span class="n">df_rcp45</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">,</span> <span class="n">variable_name_projections</span><span class="p">)</span>
    <span class="n">df_rcp85</span> <span class="o">=</span> <span class="n">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">,</span> <span class="n">variable_name_projections</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">variable_name_reanalysis</span><span class="p">,</span> <span class="n">df_reanalysis</span><span class="p">,</span> <span class="n">variable_name_projections</span><span class="p">,</span> <span class="n">df_rcp45</span><span class="p">,</span> <span class="n">df_rcp85</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_fixed_30_year_average</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="c1"># Stellen sicher, dass die Daten nach „Jahr“ sortiert sind, bevor Sie die rollierende Statistik berechnen</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
    
    <span class="c1"># Berechnung des gleitenden 30-Jahres-Durchschnitts und der Standardabweichung (zentriertes Fenster)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Definieren den Jahresbereich</span>
<span class="n">start_year</span> <span class="o">=</span> <span class="mi">1940</span>
<span class="n">intermediate_year</span> <span class="o">=</span> <span class="mi">2023</span>
<span class="n">end_year</span> <span class="o">=</span> <span class="mi">2100</span>

<span class="n">variable_name_reanalysis</span><span class="p">,</span> <span class="n">df_reanalysis</span><span class="p">,</span> <span class="n">variable_name_projections</span><span class="p">,</span> <span class="n">df_rcp45</span><span class="p">,</span> <span class="n">df_rcp85</span> <span class="o">=</span> <span class="n">compute_projection_data</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span><span class="n">intermediate_year</span><span class="p">,</span> <span class="n">end_year</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualisierung-der-jahresmittelwerte-der-reanalyse-und-klimaprojektionsdaten-rcp4-5-und-rcp8-5-mit-einer-trendlinie">
<h3>5.8 Visualisierung der Jahresmittelwerte der Reanalyse- und Klimaprojektionsdaten (RCP4.5 und RCP8.5) mit einer Trendlinie<a class="headerlink" href="#visualisierung-der-jahresmittelwerte-der-reanalyse-und-klimaprojektionsdaten-rcp4-5-und-rcp8-5-mit-einer-trendlinie" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstelle ein Diagramm</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_reanalysis</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Szenario-Daten und Trendlinie plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_rcp45</span><span class="p">[</span><span class="n">variable_name_projections</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Lineare Trendlinie für das RCP4.5-Szenario berechnen</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="n">variable_name_projections</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

<span class="c1"># Trendlinie für RCP4.5 plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">p</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
         <span class="o">**</span><span class="n">design_rcp45_trend</span><span class="p">)</span>

<span class="c1"># RCP8.5-Szenario-Daten und Trendlinie plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_rcp85</span><span class="p">[</span><span class="n">variable_name_projections</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="c1"># Lineare Trendlinie für das RCP8.5-Szenario berechnen</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">df_rcp85</span><span class="p">[</span><span class="n">variable_name_projections</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

<span class="c1"># Trendlinie für RCP8.5 plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">p</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
         <span class="o">**</span><span class="n">design_rcp85_trend</span><span class="p">)</span>

<span class="c1"># Vertikale Trennlinie hinzufügen, um zwischen historischen Daten und Projektionen zu unterscheiden</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="c1"># Achsentitel setzen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Jahr&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mittlerer Jahreswert&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Referenzzeitraum: </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="c1"># Haupttitel setzen</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jährliche </span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="mf">0.52</span><span class="p">)</span>

<span class="c1"># Begrenzung der x-Achse auf den relevanten Datenbereich</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Raster für bessere Lesbarkeit hinzufügen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># X-Achse: Alle 10-Jahres-Intervalle anzeigen</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                      <span class="n">end</span><span class="o">=</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                      <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Beschreibung hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.035</span><span class="p">,</span>
    <span class="p">(</span>
       <span class="s1">&#39;Quelle: Copernicus Climate Change Service (C3S),&#39;</span>
       <span class="s1">&#39;Climate Data Store (CDS), (2024): Klimaindikatoren für Europa von 1940 bis 2100&#39;</span>
       <span class="s1">&#39;abgeleitet aus Reanalyse- und Klimaprojektionen,&#39;</span>
       <span class="s1">&#39;Copernicus Climate Change Service (C3S) Climate Data Store (CDS).&#39;</span>
       <span class="s1">&#39;(Zugriff am 01-08-2024)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Legende hinzufügen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Layout anpassen und Diagramm anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/c8e6e44e5110fb6b8289763c4276e4b5b1dd9730e366b6a5f4d201fb5e45245d.png" src="../../_images/c8e6e44e5110fb6b8289763c4276e4b5b1dd9730e366b6a5f4d201fb5e45245d.png" />
</div>
</div>
</section>
<section id="visualisierung-der-jahresmittelwerte-der-reanalyse-und-klimaprojektionsdaten-rcp4-5-und-rcp8-5-mit-standardabweichung">
<h3>5.9 Visualisierung der Jahresmittelwerte der Reanalyse- und Klimaprojektionsdaten (RCP4.5 und RCP8.5) mit Standardabweichung<a class="headerlink" href="#visualisierung-der-jahresmittelwerte-der-reanalyse-und-klimaprojektionsdaten-rcp4-5-und-rcp8-5-mit-standardabweichung" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstelle ein Diagramm</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="c1"># Reanalyse-Daten plotten</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
         <span class="n">df_reanalysis</span><span class="p">[</span><span class="n">variable_name_reanalysis</span><span class="p">],</span>
         <span class="o">**</span><span class="n">design_reanalyse</span><span class="p">)</span>

<span class="c1"># RCP4.5-Szenario-Daten plotten (30-jähriger Durchschnitt)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp45</span><span class="p">)</span>

<span class="c1"># Unsicherheitsbereich für RCP4.5 (±1 Standardabweichung) einfügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP4.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># RCP8.5-Szenario-Daten plotten (30-jähriger Durchschnitt)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">design_rcp85</span><span class="p">)</span>

<span class="c1"># Unsicherheitsbereich für RCP8.5 (±1 Standardabweichung) einfügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_avg&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_rcp85</span><span class="p">[</span><span class="s1">&#39;30_year_std&#39;</span><span class="p">],</span> 
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;RCP8.5 - Std&#39;</span><span class="p">)</span>

<span class="c1"># Vertikale Trennlinie für den Übergang zwischen historischen Daten und Projektionen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2024-01-01&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">design_trennlinie</span><span class="p">)</span>

<span class="c1"># Achsenbeschriftungen und Titel setzen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Jahr&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mittlerer Jahreswert&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Referenzzeitraum: </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

<span class="c1"># Haupttitel setzen</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jährliche </span><span class="si">{</span><span class="n">selected_ds_variable</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
             <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
             <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
             <span class="n">x</span><span class="o">=</span><span class="mf">0.52</span><span class="p">)</span>

<span class="c1"># Begrenzung der x-Achse auf den relevanten Datenbereich</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Raster hinzufügen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># X-Achse: Alle 10-Jahres-Intervalle anzeigen</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">df_reanalysis</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                      <span class="n">end</span><span class="o">=</span><span class="n">df_rcp45</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                      <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;10YE&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">year</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Beschreibung hinzufügen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="o">-</span><span class="mf">0.035</span><span class="p">,</span>
    <span class="p">(</span>
       <span class="s1">&#39;Quelle: Copernicus Climate Change Service (C3S),&#39;</span>
       <span class="s1">&#39;Climate Data Store (CDS), (2024): Klimaindikatoren für Europa von 1940 bis 2100&#39;</span>
       <span class="s1">&#39;abgeleitet aus Reanalyse- und Klimaprojektionen,&#39;</span>
       <span class="s1">&#39;Copernicus Climate Change Service (C3S) Climate Data Store (CDS).&#39;</span>
       <span class="s1">&#39;(Zugriff am 01-08-2024)&#39;</span>
    <span class="p">),</span>
    <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
    <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Legende hinzufügen</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Layout anpassen und Diagramm anzeigen</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/30b072f50d7fad7797ce12d62d1135bd17144751177f1535b859cf9ea5b5d259.png" src="../../_images/30b072f50d7fad7797ce12d62d1135bd17144751177f1535b859cf9ea5b5d259.png" />
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="02-sis-heat-wave-and-cold-spells.html" class="btn btn-neutral float-left" title="Heat Wave and Cold Spells" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Zurück</a>
        <a href="../../rst_jupyter_bibliothek/satellite_data/index.html" class="btn btn-neutral float-right" title="Satellitendaten Notebooks" accesskey="n" rel="next">Weiter <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, str.ucture GmbH.</p>
  </div>

  Erstellt mit <a href="https://www.sphinx-doc.org/">Sphinx</a> mit einem
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    bereitgestellt von <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>