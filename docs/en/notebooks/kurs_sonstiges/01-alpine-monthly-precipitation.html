

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alpine Monthly Precipitation &mdash; CoKLIMAx 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=822aaed9" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=8d563738"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script type="application/vnd.jupyter.widget-state+json">{"state": {"1f963b1eee864ec8af03468ef15915b6": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "8b03d8ceaf764f90b1b12bc5d8c5fc9b": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "df96f50ba40a4a98ac53af2be843edac": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_1f963b1eee864ec8af03468ef15915b6", "max": 1440.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_8b03d8ceaf764f90b1b12bc5d8c5fc9b", "tabbable": null, "tooltip": null, "value": 1440.0}}, "ce041418f1574a08b498413a2c754bf4": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "40eb15cd3e3846f0b6d818edf995a632": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "2878fe2bf3c0419395e9039b957706ef": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_ce041418f1574a08b498413a2c754bf4", "placeholder": "\u200b", "style": "IPY_MODEL_40eb15cd3e3846f0b6d818edf995a632", "tabbable": null, "tooltip": null, "value": "Exporting\u2007merged\u2007GeoTIFF\u2007from\u20071901\u2007to\u20072020:\u2007100%"}}, "f4a00f936b7949eca65d41c36a2ca876": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "faeaeaa7542a4faea72446156a87f728": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "e254412e9d61471f942e094428deb1c4": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_f4a00f936b7949eca65d41c36a2ca876", "placeholder": "\u200b", "style": "IPY_MODEL_faeaeaa7542a4faea72446156a87f728", "tabbable": null, "tooltip": null, "value": "\u20071440/1440\u2007[00:00&lt;00:00,\u20076354.32it/s]"}}, "585bf2641c314a0a896fa96f0a5dc6b5": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "53fec45a700d413d8d86a11f4ba845a2": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_2878fe2bf3c0419395e9039b957706ef", "IPY_MODEL_df96f50ba40a4a98ac53af2be843edac", "IPY_MODEL_e254412e9d61471f942e094428deb1c4"], "layout": "IPY_MODEL_585bf2641c314a0a896fa96f0a5dc6b5", "tabbable": null, "tooltip": null}}, "b6a7dc1e137d4d42b7ad8f22e4f90a32": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "a8dc7db6d0d54c35be41684e9415089c": {"model_name": "ProgressStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "ProgressStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "bar_color": null, "description_width": ""}}, "d74bd1d6822c41beb916d5460d46949a": {"model_name": "FloatProgressModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "FloatProgressModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "ProgressView", "bar_style": "success", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_b6a7dc1e137d4d42b7ad8f22e4f90a32", "max": 72.0, "min": 0.0, "orientation": "horizontal", "style": "IPY_MODEL_a8dc7db6d0d54c35be41684e9415089c", "tabbable": null, "tooltip": null, "value": 72.0}}, "c7cd035de68442f49a1dd8efd49985dd": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "d9a055c8983f4291b2e22da8f6f3e3c3": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "2cf1ee93e85c4710ae493ac7214b48e8": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_c7cd035de68442f49a1dd8efd49985dd", "placeholder": "\u200b", "style": "IPY_MODEL_d9a055c8983f4291b2e22da8f6f3e3c3", "tabbable": null, "tooltip": null, "value": "Exporting\u2007individual\u2007GeoTIFF\u2007files\u2007from\u20071995\u2007to\u20072000:\u2007100%"}}, "7731493630c64962ba3fc581f6e573ec": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "2173604311b64a38a9ef9c9ac9437b90": {"model_name": "HTMLStyleModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLStyleModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "StyleView", "background": null, "description_width": "", "font_size": null, "text_color": null}}, "f619f0a563a3407b89c5b64bad07915a": {"model_name": "HTMLModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HTMLModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HTMLView", "description": "", "description_allow_html": false, "layout": "IPY_MODEL_7731493630c64962ba3fc581f6e573ec", "placeholder": "\u200b", "style": "IPY_MODEL_2173604311b64a38a9ef9c9ac9437b90", "tabbable": null, "tooltip": null, "value": "\u200772/72\u2007[00:01&lt;00:00,\u200764.90it/s]"}}, "1137b56ef8a044788ae4d9a3c7005afd": {"model_name": "LayoutModel", "model_module": "@jupyter-widgets/base", "model_module_version": "2.0.0", "state": {"_model_module": "@jupyter-widgets/base", "_model_module_version": "2.0.0", "_model_name": "LayoutModel", "_view_count": null, "_view_module": "@jupyter-widgets/base", "_view_module_version": "2.0.0", "_view_name": "LayoutView", "align_content": null, "align_items": null, "align_self": null, "border_bottom": null, "border_left": null, "border_right": null, "border_top": null, "bottom": null, "display": null, "flex": null, "flex_flow": null, "grid_area": null, "grid_auto_columns": null, "grid_auto_flow": null, "grid_auto_rows": null, "grid_column": null, "grid_gap": null, "grid_row": null, "grid_template_areas": null, "grid_template_columns": null, "grid_template_rows": null, "height": null, "justify_content": null, "justify_items": null, "left": null, "margin": null, "max_height": null, "max_width": null, "min_height": null, "min_width": null, "object_fit": null, "object_position": null, "order": null, "overflow": null, "padding": null, "right": null, "top": null, "visibility": null, "width": null}}, "393592b299c545b682c4a1d1f2211dac": {"model_name": "HBoxModel", "model_module": "@jupyter-widgets/controls", "model_module_version": "2.0.0", "state": {"_dom_classes": [], "_model_module": "@jupyter-widgets/controls", "_model_module_version": "2.0.0", "_model_name": "HBoxModel", "_view_count": null, "_view_module": "@jupyter-widgets/controls", "_view_module_version": "2.0.0", "_view_name": "HBoxView", "box_style": "", "children": ["IPY_MODEL_2cf1ee93e85c4710ae493ac7214b48e8", "IPY_MODEL_d74bd1d6822c41beb916d5460d46949a", "IPY_MODEL_f619f0a563a3407b89c5b64bad07915a"], "layout": "IPY_MODEL_1137b56ef8a044788ae4d9a3c7005afd", "tabbable": null, "tooltip": null}}}, "version_major": 2, "version_minor": 0}</script>
      <script crossorigin="anonymous" data-jupyter-widgets-cdn="https://cdn.jsdelivr.net/npm/" src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@1.0.6/dist/embed-amd.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Heat Wave and Cold Spells" href="02-sis-heat-wave-and-cold-spells.html" />
    <link rel="prev" title="CDS Dataset Notebooks" href="../../rst_jupyter_bibliothek/cds_data/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CoKLIMAx
              <img src="../../_static/coklimax_logo_new.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/01-softwarekenntnisse.html">Required Software and Knowledge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/02-kurselemente.html">The Course Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_inhalte/03-cds.html">The Copernicus Climate Data Store (CDS)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Course 1:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/01-cds-api-installieren-und-herunterladen.html">CDS API Installation and Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_kurs1/02-netcdf-einfuhrung.html">NetCDF Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Course 2:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/01-satellite-lake-water-level.html">Lake Water Levels from Satellite Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/02-satellite-lake-water-temperature.html">Lake Water Temperature from Satellite Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kurs2_einfache_cds/03-sis-temperature-statistics.html">Temperature Statistics for Europe</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">The Jupyter Notebook Library:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/index.html">About CoKLIMAx-II Notebooks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../rst_jupyter_bibliothek/cds_data/index.html">CDS Dataset Notebooks </a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Alpine Monthly Precipitation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#specifying-the-paths-and-working-directories">1. Specifying the paths and working directories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#download-and-extract-the-dataset">2. Download and Extract the Dataset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#authentication">2.1 Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-the-request-and-download-the-dataset">2.2 Define the “request” and Download the Dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extract-the-zip-file-in-folder">2.3 Extract the ZIP file in folder</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#investigate-the-metadata-of-the-netcdf4-file">3. Investigate the Metadata of the NetCDF4 file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#export-the-dataset-in-csv-format">5. Export the dataset in CSV Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-bounding-box-to-filter-data-for-konstanz">4.1 Define Bounding Box to Filter Data for Konstanz</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filter-data-by-bounding-box-and-export-as-csv">4.2 Filter Data by Bounding Box and Export as CSV</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compute-monthly-means-and-export-as-csv">4.3 Compute Monthly Means and Export as CSV</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plot-monthly-averages-for-a-defined-date-range">4.4 Plot Monthly Averages for a Defined Date Range</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#export-the-netcdf4-files-to-geotiff">5. Export the NetCDF4 files to GeoTIFF</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-a-function-to-export-the-netcdf4-file-as-geotiff-file-s">5.1 Define a Function to export the NetCDF4 file as GeoTIFF File(s)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-selected-netcdf4-file-s-to-geotiff-file-s">5.2 Export selected NetCDF4 file(s) to GeoTIFF file(s)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-and-visualization-options">6. Analysis and Visualization Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#define-a-function-for-visualising-a-netcdf4-dataset-as-a-heatmap">6.1 Define a function for visualising a NetCDF4 dataset as a Heatmap</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-heatmap-for-the-monthly-mean">6.2 Create a Heatmap for the Monthly Mean</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-a-function-for-visualising-a-netcdf4-dataset-as-a-monthly-heatmap">6.3 Define a function for visualising a NetCDF4 dataset as a Monthly Heatmap</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="02-sis-heat-wave-and-cold-spells.html">Heat Wave and Cold Spells</a></li>
<li class="toctree-l2"><a class="reference internal" href="03-sis-health-vector.html">SIS Health Vector</a></li>
<li class="toctree-l2"><a class="reference internal" href="04-climate-indicators.html">Climate Indicators for Europe</a></li>
<li class="toctree-l2"><a class="reference internal" href="05-sis-biodiversity-era5-regional.html">Downscaled bioclimatic indicators</a></li>
<li class="toctree-l2"><a class="reference internal" href="06-era5-land-hourly.html">ERA5-Land Hourly Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="07-era5-land-monthly.html">ERA5-Land Monthly Averaged</a></li>
<li class="toctree-l2"><a class="reference internal" href="10-c3s-erderwaermung.html">Global Warming</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/satellite_data/index.html">Satellite Data Notebooks </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rst_jupyter_bibliothek/visualizations/index.html">Visualization Options Library</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CoKLIMAx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../rst_jupyter_bibliothek/cds_data/index.html">CDS Dataset Notebooks </a></li>
      <li class="breadcrumb-item active">Alpine Monthly Precipitation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/notebooks/kurs_sonstiges/01-alpine-monthly-precipitation.ipynb.txt" rel="nofollow"> View page source</a>
<div id='language-switcher' style='text-align: right; margin-top: 10px;'>
    <select onchange="location = this.value;">
        <option value='/./CoKLIMAx-II/en\notebooks\kurs_sonstiges\01-alpine-monthly-precipitation.html' selected>EN</option>
        <option value='/./CoKLIMAx-II/de\notebooks\kurs_sonstiges\01-alpine-monthly-precipitation.html'>DE</option>
    </select>
</div>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="alpine-monthly-precipitation">
<h1>Alpine Monthly Precipitation<a class="headerlink" href="#alpine-monthly-precipitation" title="Link to this heading"></a></h1>
<p>Alpine monthly precipitation data since 1871, derived from stationary observations: The LAPrec (Long-term Alpine Precipitation Reconstruction) dataset provides monthly precipitation data for the Alpine region and is based on stationary observations. There are two versions:</p>
<ul class="simple">
<li><p>LAPrec1871 (from 1871, 85 input series)</p></li>
<li><p>LAPrec1901 (from 1901, 165 input series)</p></li>
</ul>
<p>The dataset meets high climatic standards and is a valuable basis for historical climate analyses in the Alps, a region strongly affected by climate change. It combines the data sources HISTALP (homogenized stationary precipitation data) and APGD (daily gridded data from 1971–2008) and uses the Reduced Space Optimal Interpolation (RSOI) method. LAPrec is updated every two years and was developed as part of the Copernicus Climate Change Service in cooperation with the weather services of Switzerland (MeteoSwiss) and Austria (ZAMG).</p>
<p><strong>Information on Dataset:</strong></p>
<ul class="simple">
<li><p>Source: <a href="https://cds.climate.copernicus.eu/datasets/insitu-gridded-observations-alpine-precipitation?tab=overview" target="_blank">Alpine Monthly Precipitation</a></p></li>
<li><p>Author: T. Tewes (City of Konstanz)</p></li>
<li><p>Notebook Version: 1.1 (Updated: December 05, 2024)</p></li>
</ul>
<section id="specifying-the-paths-and-working-directories">
<h2>1. Specifying the paths and working directories<a class="headerlink" href="#specifying-the-paths-and-working-directories" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="sd">&#39;&#39;&#39; ---- Specify Directories Here ---- &#39;&#39;&#39;</span>
<span class="n">download_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\download&quot;</span>
<span class="n">working_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\working&quot;</span>
<span class="n">geotiff_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\geotiff&quot;</span>
<span class="n">csv_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\csv&quot;</span>
<span class="n">output_folder</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\data\alpine-monthly-precipitation\output&quot;</span>
<span class="sd">&#39;&#39;&#39; ----- End of Declaration ---- &#39;&#39;&#39;</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">working_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-and-extract-the-dataset">
<h2>2. Download and Extract the Dataset<a class="headerlink" href="#download-and-extract-the-dataset" title="Link to this heading"></a></h2>
<section id="authentication">
<h3>2.1 Authentication<a class="headerlink" href="#authentication" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cdsapi</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
    <span class="c1"># API key for authentication</span>
    <span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;fdae60fd-35d4-436f-825c-c63fedab94a4&quot;</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://cds.climate.copernicus.eu/api&quot;</span>

    <span class="c1"># Creation of the CDS API client</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">api_url</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">api_key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-the-request-and-download-the-dataset">
<h3>2.2 Define the “request” and Download the Dataset<a class="headerlink" href="#define-the-request-and-download-the-dataset" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definition of the dataset and the request parameters</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="s2">&quot;insitu-gridded-observations-alpine-precipitation&quot;</span>
<span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dataset_issue&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;laprec1871&quot;</span><span class="p">,</span>
        <span class="s2">&quot;laprec1901&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1_2&quot;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Execute it to download the dataset:</span>
<span class="k">def</span><span class="w"> </span><span class="nf">main_retrieve</span><span class="p">():</span>
    <span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.zip&quot;</span>
    <span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>

    <span class="c1"># Download the dataset only if the dataset has not been downloaded before</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">):</span>
        <span class="c1"># Call the CDS client only if the dataset has not been downloaded before</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">main</span><span class="p">()</span>
        <span class="c1"># Download the dataset with the defined request parameters</span>
        <span class="n">client</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">dataset_filepath</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset already downloaded.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main_retrieve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Dataset already downloaded.
</pre></div>
</div>
</div>
</div>
</section>
<section id="extract-the-zip-file-in-folder">
<h3>2.3 Extract the ZIP file in folder<a class="headerlink" href="#extract-the-zip-file-in-folder" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>

<span class="c1"># Construct the filename and filepath for the ZIP file based on selected year</span>
<span class="n">dataset_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.zip&quot;</span>
<span class="n">dataset_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_folder</span><span class="p">,</span> <span class="n">dataset_filename</span><span class="p">)</span>

<span class="c1"># Define a extract folder to ZIP file same as the working folder</span>
<span class="n">extract_folder</span> <span class="o">=</span> <span class="n">working_folder</span>

<span class="c1"># Extract the ZIP file only if the folder is empty</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">):</span>
        <span class="c1"># Attempt to open and extract the ZIP file</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">dataset_filepath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zip_ref</span><span class="p">:</span>
            <span class="n">zip_ref</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully extracted files to: </span><span class="si">{</span><span class="n">extract_folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Folder is not empty. Skipping extraction.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: The file </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> was not found.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">BadZipFile</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: The file </span><span class="si">{</span><span class="n">dataset_filepath</span><span class="si">}</span><span class="s2"> is not a valid zip file.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An unexpected error occurred: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Folder is not empty. Skipping extraction.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="investigate-the-metadata-of-the-netcdf4-file">
<h2>3. Investigate the Metadata of the NetCDF4 file<a class="headerlink" href="#investigate-the-metadata-of-the-netcdf4-file" title="Link to this heading"></a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print list of netCDF4 files inside the working/extracted folder</span>
<span class="n">filename_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filename_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;LAPrec1871.v1.2.nc&#39;, &#39;LAPrec1901.v1.2.nc&#39;]
</pre></div>
</div>
</div>
</div>
<p>The <a href="https://cds.climate.copernicus.eu/datasets/insitu-gridded-observations-alpine-precipitation?tab=overview" target="_blank">Alpine Monthly Precipitation</a> dataset provides records starting from either 1871 or 1901. In this notebook, we will use the dataset from 1901 (LAPrec1901).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">netCDF4</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nc</span>

<span class="c1"># Define the file path for the selected NetCDF dataset</span>
<span class="n">nc_filename</span> <span class="o">=</span> <span class="s1">&#39;LAPrec1901.v1.2.nc&#39;</span>
<span class="n">nc_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="s1">&#39;LAPrec1901.v1.2.nc&#39;</span><span class="p">)</span>

<span class="c1"># Open the NetCDF file in read mode</span>
<span class="n">nc_dataset</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

<span class="c1"># List all variables in the dataset</span>
<span class="n">variables_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available variables: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">variables_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Available variables: [&#39;X&#39;, &#39;Y&#39;, &#39;time&#39;, &#39;LAPrec1901&#39;, &#39;lon&#39;, &#39;lat&#39;, &#39;dem&#39;, &#39;lambert_azimuthal_equal_area&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Define variable name from available variables and read variable data</span>
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;LAPrec1901&#39;</span>
<span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>

<span class="c1"># Create a summary of the primary variables</span>
<span class="n">summary</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Variable Name&quot;</span><span class="p">:</span> <span class="n">variable_name</span><span class="p">,</span>
    <span class="s2">&quot;Data Type&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
    <span class="s2">&quot;Shape&quot;</span><span class="p">:</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span>
    <span class="s2">&quot;Variable Info&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_data</span><span class="o">.</span><span class="n">dimensions</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Units&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
    <span class="s2">&quot;Long Name&quot;</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">variable_data</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="s2">&quot;N/A&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Display the summary of the data set as a DataFrame for better visualisation</span>
<span class="n">nc_summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="s1">&#39;Details&#39;</span><span class="p">])</span>

<span class="c1"># Display the summary DataFrame</span>
<span class="n">nc_summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Description</th>
      <th>Details</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Variable Name</td>
      <td>LAPrec1901</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Data Type</td>
      <td>int32</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Shape</td>
      <td>(1440, 138, 219)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Variable Info</td>
      <td>('time', 'Y', 'X')</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Units</td>
      <td>kg m-2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Long Name</td>
      <td>monthly precipitation sum</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print a summary of all the variables of the dataset</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables_list</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">var_obj</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">var_obj</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">var_obj</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;nc_variables&quot;</span><span class="p">:</span> <span class="n">variable</span><span class="p">,</span>
            <span class="s2">&quot;unit&quot;</span><span class="p">:</span> <span class="n">unit</span><span class="p">,</span>
            <span class="s2">&quot;shape&quot;</span><span class="p">:</span> <span class="n">shape</span>
        <span class="p">})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing variable </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Create a DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>nc_variables</th>
      <th>unit</th>
      <th>shape</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>X</td>
      <td>m</td>
      <td>(219,)</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Y</td>
      <td>m</td>
      <td>(138,)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>time</td>
      <td>days since 1901-01-01 00:00:00</td>
      <td>(1440,)</td>
    </tr>
    <tr>
      <th>3</th>
      <td>LAPrec1901</td>
      <td>kg m-2</td>
      <td>(1440, 138, 219)</td>
    </tr>
    <tr>
      <th>4</th>
      <td>lon</td>
      <td>degrees_east</td>
      <td>(138, 219)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>lat</td>
      <td>degrees_north</td>
      <td>(138, 219)</td>
    </tr>
    <tr>
      <th>6</th>
      <td>dem</td>
      <td>m</td>
      <td>(138, 219)</td>
    </tr>
    <tr>
      <th>7</th>
      <td>lambert_azimuthal_equal_area</td>
      <td>N/A</td>
      <td>()</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="export-the-dataset-in-csv-format">
<h2>5. Export the dataset in CSV Format<a class="headerlink" href="#export-the-dataset-in-csv-format" title="Link to this heading"></a></h2>
<section id="define-bounding-box-to-filter-data-for-konstanz">
<h3>4.1 Define Bounding Box to Filter Data for Konstanz<a class="headerlink" href="#define-bounding-box-to-filter-data-for-konstanz" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define additional request fields to ensure the request stays within the file size limit.</span>
<span class="c1"># These coordinates were obtained using the BBox Extractor tool:</span>
<span class="c1"># https://str-ucture.github.io/bbox-extractor/</span>

<span class="c1"># Bounding box for the Konstanz region (WGS84 projection):</span>
<span class="n">bbox_wgs84_konstanz</span> <span class="o">=</span> <span class="p">[</span><span class="mf">47.9</span><span class="p">,</span> <span class="mf">8.9</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">]</span>  <span class="c1"># Format: [North, West, South, East]</span>
<span class="n">bbox_wgs84_konstanz_standard</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9.0</span><span class="p">,</span> <span class="mf">47.6</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mf">47.8</span><span class="p">]</span>  <span class="c1"># Standard format: [West, South, East, North]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Alternatively, use a shapefile for precise geographic filtering</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyproj</span><span class="w"> </span><span class="kn">import</span> <span class="n">Transformer</span>

<span class="c1"># Load the shapefile of Konstanz (WGS84 projection) for geographic boundary filtering</span>
<span class="n">shapefile</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;./shapefiles/kn_boundary.shp&quot;</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">shapefile</span><span class="p">)</span>

<span class="c1"># Extract the bounding box of the shapefile</span>
<span class="n">shapefile_epsg</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">()</span>
<span class="n">shapefile_bounds</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">total_bounds</span>

<span class="c1"># Define the source and target projections</span>
<span class="n">proj_shapefile</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;epsg:</span><span class="si">{</span><span class="n">shapefile_epsg</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># Source projection (shapefile&#39;s CRS)</span>
<span class="n">proj_laea</span> <span class="o">=</span> <span class="s2">&quot;epsg:3035&quot;</span>  <span class="c1"># Target projection (LAEA for Europe)</span>

<span class="c1"># Define a transformer to convert coordinates from source to target projection</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">Transformer</span><span class="o">.</span><span class="n">from_crs</span><span class="p">(</span><span class="n">proj_shapefile</span><span class="p">,</span> <span class="n">proj_laea</span><span class="p">,</span> <span class="n">always_xy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Transform the bounding box coordinates to the target projection (LAEA)</span>
<span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">shapefile_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shapefile_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Bottom-left corner</span>
<span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">shapefile_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">shapefile_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># Top-right corner</span>
<span class="n">shapefile_bounds_laea</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">]</span>  <span class="c1"># Bounding box in LAEA projection</span>

<span class="c1"># Display the transformed bounding box</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Bounding Box in LAEA:&quot;</span><span class="p">,</span> <span class="n">shapefile_bounds_laea</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Bounding Box in LAEA: [4252254.817823338, 2727132.614227563, 4262344.998739288, 2739095.48723691]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Coordinate System: EPSG(</span><span class="si">{</span><span class="n">shapefile_epsg</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bounding Box: </span><span class="si">{</span><span class="n">shapefile_bounds</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Optional: Quick plot of your Shapefile</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Shapefile Representation&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Longitude / X&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Latitude / Y&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coordinate System: EPSG(4326)
Bounding Box: [ 9.08545411 47.65398657  9.21804389 47.762681  ]
</pre></div>
</div>
<img alt="../../_images/90dad1187cb23f74e60c4d19ffc50e43493d8cf4825be69007de206ec1878b07.png" src="../../_images/90dad1187cb23f74e60c4d19ffc50e43493d8cf4825be69007de206ec1878b07.png" />
</div>
</div>
<blockquote>
<div><p>Important: Generally, <strong>kn_bounds_laea</strong> is sufficient for extracting CSV and GeoTIFF, but adjustments may be needed because:</p>
</div></blockquote>
<ul class="simple">
<li><p><strong>x</strong> and <strong>y</strong> represent grid cell centers, and bounding box edges may not align perfectly with these centers.</p></li>
<li><p>Without adjustment, grid cells near the edges might be excluded if bounding box edges fall between grid centers.</p></li>
<li><p>Adjusting ensures all relevant grid cells are included.</p></li>
</ul>
<div style="display: flex; justify-content: center; gap: 10px;">
  <figure style="margin: 0;">
    <img src="./images/ppt_normal.png" width="400" style="border: 1px solid #aeaeae; display: block;">
    <figcaption style="text-align: center; margin-top: 5px;">Extent w/o bbox adjustment (kn_bounds_laea)</figcaption>
  </figure>
  <figure style="margin: 0;">
    <img src="./images/ppt_adjusted.png" width="400" style="border: 1px solid #aeaeae; display: block;">
    <figcaption style="text-align: center; margin-top: 5px;">Extent w/ bbox adjustment (kn_bounds_laea_adjusted)</figcaption>
  </figure>
</div>
<p>It is recommended to use <strong>kn_bounds_laea_adjusted</strong> for extracting GeoTIFF files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define variable name from available variables and read variable data</span>
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;LAPrec1901&#39;</span>
<span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][:]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">][:]</span>

<span class="c1"># Validate bounding box dimensions</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># X-axis resolution</span>
<span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Y-axis resolution</span>

<span class="c1"># Adjust the bounding box to align with grid edges</span>
<span class="n">x_min_adjusted</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_min</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">x_max_adjusted</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_max</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">y_min_adjusted</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y_min</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">y_max_adjusted</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y_max</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">shp_bounds_laea_adjusted</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_min_adjusted</span><span class="p">,</span> <span class="n">y_min_adjusted</span><span class="p">,</span> <span class="n">x_max_adjusted</span><span class="p">,</span> <span class="n">y_max_adjusted</span><span class="p">]</span>
<span class="c1"># print(shp_bounds_laea_adjusted)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="filter-data-by-bounding-box-and-export-as-csv">
<h3>4.2 Filter Data by Bounding Box and Export as CSV<a class="headerlink" href="#filter-data-by-bounding-box-and-export-as-csv" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="c1"># Function for converting NetCDF data into a Pandas DataFrame</span>
<span class="k">def</span><span class="w"> </span><span class="nf">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_filepath</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">nc_filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>
        <span class="c1"># Access the variable data from the datase</span>
        <span class="n">variable_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>

        <span class="c1"># Filter the data based on the bounding box, if provided</span>
        <span class="k">if</span> <span class="n">bounding_box</span><span class="p">:</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">variable_data</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span>
                <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                <span class="n">drop</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">variable_data</span>

        <span class="c1"># Convert the xarray dataset to a pandas DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">filtered_data</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define csv filename and filepath for the output</span>
<span class="n">csv_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">_filtered_data.csv&quot;</span>
<span class="n">csv_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">csv_filename</span><span class="p">)</span>

<span class="c1"># Export the DataFrame as CSV if it does not already exist</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">):</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">netcdf_to_dataframe</span><span class="p">(</span><span class="n">nc_filepath</span><span class="o">=</span><span class="n">nc_filepath</span><span class="p">,</span> <span class="n">bounding_box</span><span class="o">=</span><span class="n">shp_bounds_laea_adjusted</span><span class="p">)</span>
    <span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File already exists at </span><span class="si">{</span><span class="n">csv_filepath</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">Skipping export.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading existing CSV file...&quot;</span><span class="p">)</span>
    <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">])</span>

<span class="c1"># Display DataFrame</span>
<span class="n">dataframe</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File already exists at .\data\alpine-monthly-precipitation\csv\LAPrec1901_filtered_data.csv.
Skipping export.
Reading existing CSV file...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>LAPrec1901</th>
    </tr>
    <tr>
      <th>time</th>
      <th>Y</th>
      <th>X</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">1901-01-01</th>
      <th rowspan="3" valign="top">2725000.0</th>
      <th>4250000.0</th>
      <td>37.0</td>
    </tr>
    <tr>
      <th>4255000.0</th>
      <td>36.0</td>
    </tr>
    <tr>
      <th>4260000.0</th>
      <td>36.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">2730000.0</th>
      <th>4250000.0</th>
      <td>37.0</td>
    </tr>
    <tr>
      <th>4255000.0</th>
      <td>33.0</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">2020-12-01</th>
      <th rowspan="2" valign="top">2735000.0</th>
      <th>4255000.0</th>
      <td>57.0</td>
    </tr>
    <tr>
      <th>4260000.0</th>
      <td>56.0</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">2740000.0</th>
      <th>4250000.0</th>
      <td>56.0</td>
    </tr>
    <tr>
      <th>4255000.0</th>
      <td>57.0</td>
    </tr>
    <tr>
      <th>4260000.0</th>
      <td>58.0</td>
    </tr>
  </tbody>
</table>
<p>17280 rows × 1 columns</p>
</div></div></div>
</div>
</section>
<section id="compute-monthly-means-and-export-as-csv">
<h3>4.3 Compute Monthly Means and Export as CSV<a class="headerlink" href="#compute-monthly-means-and-export-as-csv" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define csv filename and filepath for the output</span>
<span class="n">csv_filename_monthly_means</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">_monthly_means.csv&quot;</span>
<span class="n">csv_filepath_monthly_means</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="n">csv_filename_monthly_means</span><span class="p">)</span>

<span class="c1"># Export the pivot table to CSV if it doesn&#39;t already exist</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">csv_filepath_monthly_means</span><span class="p">):</span>
    <span class="c1"># Convert the &#39;time&#39; column to datetime format</span>
    <span class="n">filtered_df_copy</span> <span class="o">=</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

    <span class="c1"># Extract year and month from the &#39;time&#39; column</span>
    <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;Month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filtered_df_copy</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

    <span class="c1"># Group by year and month, calculate the mean for the specified variable</span>
    <span class="n">monthly_means</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">filtered_df_copy</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Month&#39;</span><span class="p">])[</span><span class="n">variable_name</span><span class="p">]</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="o">.</span><span class="n">round</span><span class="p">({</span><span class="n">variable_name</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
    <span class="p">)</span>

    <span class="c1"># Create a pivot table with years as rows and months as columns</span>
    <span class="n">df_monthly_means</span> <span class="o">=</span> <span class="n">monthly_means</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">variable_name</span><span class="p">)</span>

    <span class="c1"># Ensure all months (1–12) are included, and add yearly totals</span>
    <span class="n">df_monthly_means</span> <span class="o">=</span> <span class="n">df_monthly_means</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
    <span class="n">df_monthly_means</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Yearly_Sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_monthly_means</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_monthly_means</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">csv_filepath_monthly_means</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Monthly mean data exported successfully to </span><span class="si">{</span><span class="n">csv_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File already exists at </span><span class="si">{</span><span class="n">csv_filepath</span><span class="si">}</span><span class="s2">. Skipping export.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading existing CSV file...&quot;</span><span class="p">)</span>
    <span class="n">df_monthly_means</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filepath_monthly_means</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">])</span>
<span class="c1"># Display the pivot table</span>
<span class="n">df_monthly_means</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>File already exists at .\data\alpine-monthly-precipitation\csv\LAPrec1901_filtered_data.csv. Skipping export.
Reading existing CSV file...
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
      <th>12</th>
      <th>Yearly_Sum</th>
    </tr>
    <tr>
      <th>Year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1901</th>
      <td>31.17</td>
      <td>26.00</td>
      <td>65.42</td>
      <td>124.58</td>
      <td>16.50</td>
      <td>129.33</td>
      <td>84.33</td>
      <td>88.00</td>
      <td>88.08</td>
      <td>36.17</td>
      <td>25.33</td>
      <td>44.50</td>
      <td>759.41</td>
    </tr>
    <tr>
      <th>1902</th>
      <td>32.00</td>
      <td>55.58</td>
      <td>53.75</td>
      <td>35.92</td>
      <td>107.08</td>
      <td>72.33</td>
      <td>89.25</td>
      <td>115.42</td>
      <td>78.00</td>
      <td>78.92</td>
      <td>15.25</td>
      <td>79.83</td>
      <td>813.33</td>
    </tr>
    <tr>
      <th>1903</th>
      <td>35.00</td>
      <td>27.83</td>
      <td>37.00</td>
      <td>53.17</td>
      <td>39.83</td>
      <td>88.50</td>
      <td>131.33</td>
      <td>100.67</td>
      <td>45.00</td>
      <td>76.00</td>
      <td>81.08</td>
      <td>16.58</td>
      <td>731.99</td>
    </tr>
    <tr>
      <th>1904</th>
      <td>29.17</td>
      <td>95.75</td>
      <td>36.58</td>
      <td>60.75</td>
      <td>129.83</td>
      <td>78.33</td>
      <td>22.17</td>
      <td>64.00</td>
      <td>98.83</td>
      <td>34.25</td>
      <td>44.92</td>
      <td>40.08</td>
      <td>734.66</td>
    </tr>
    <tr>
      <th>1905</th>
      <td>44.08</td>
      <td>24.33</td>
      <td>84.17</td>
      <td>83.67</td>
      <td>75.58</td>
      <td>64.33</td>
      <td>76.42</td>
      <td>178.92</td>
      <td>117.50</td>
      <td>101.50</td>
      <td>47.33</td>
      <td>37.58</td>
      <td>935.41</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>144.00</td>
      <td>90.67</td>
      <td>32.08</td>
      <td>100.50</td>
      <td>154.08</td>
      <td>153.42</td>
      <td>97.17</td>
      <td>62.58</td>
      <td>48.75</td>
      <td>48.25</td>
      <td>70.08</td>
      <td>1.42</td>
      <td>1003.00</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>47.58</td>
      <td>50.00</td>
      <td>49.08</td>
      <td>100.50</td>
      <td>79.83</td>
      <td>82.67</td>
      <td>114.75</td>
      <td>109.25</td>
      <td>75.17</td>
      <td>42.17</td>
      <td>84.50</td>
      <td>89.00</td>
      <td>924.50</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>108.92</td>
      <td>41.92</td>
      <td>44.33</td>
      <td>13.25</td>
      <td>84.83</td>
      <td>62.08</td>
      <td>44.75</td>
      <td>69.17</td>
      <td>64.75</td>
      <td>38.25</td>
      <td>13.08</td>
      <td>94.92</td>
      <td>680.25</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>55.67</td>
      <td>35.50</td>
      <td>51.50</td>
      <td>43.50</td>
      <td>140.00</td>
      <td>68.00</td>
      <td>99.58</td>
      <td>117.67</td>
      <td>64.33</td>
      <td>101.58</td>
      <td>43.58</td>
      <td>48.25</td>
      <td>869.16</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>28.33</td>
      <td>110.08</td>
      <td>53.50</td>
      <td>24.75</td>
      <td>63.17</td>
      <td>115.33</td>
      <td>49.08</td>
      <td>150.50</td>
      <td>41.25</td>
      <td>85.58</td>
      <td>21.75</td>
      <td>60.92</td>
      <td>804.24</td>
    </tr>
  </tbody>
</table>
<p>120 rows × 13 columns</p>
</div></div></div>
</div>
</section>
<section id="plot-monthly-averages-for-a-defined-date-range">
<h3>4.4 Plot Monthly Averages for a Defined Date Range<a class="headerlink" href="#plot-monthly-averages-for-a-defined-date-range" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ticker</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_monthly_averages</span><span class="p">(</span>
        <span class="n">start_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">end_year</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots the monthly averages of a variable with error bars for a given time range.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        start_year (int): Starting year for the dataset (optional).</span>
<span class="sd">        end_year (int): Ending year for the dataset (optional).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read filtered dataframe from CSV file</span>
    <span class="n">filtered_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_filepath</span><span class="p">)</span>
    <span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">])</span>

    <span class="c1"># Determine the time range</span>
    <span class="n">min_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    <span class="n">max_year</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    
    <span class="c1"># Adjust the start and end year to match available data</span>
    <span class="k">if</span> <span class="n">start_year</span> <span class="ow">and</span> <span class="n">end_year</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided start year </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2"> is earlier than the dataset range.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adjusting start year to </span><span class="si">{</span><span class="n">min_year</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided end year </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2"> is later than the dataset range.&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adjusting end year to </span><span class="si">{</span><span class="n">max_year</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">min_year</span><span class="p">)</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end_year</span><span class="p">,</span> <span class="n">max_year</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="n">min_year</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">max_year</span>
        
    <span class="c1"># Filter data for the defined period</span>
    <span class="n">df_period</span> <span class="o">=</span> <span class="n">filtered_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="n">start_year</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">filtered_df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="n">end_year</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Calculate monthly statistics: mean and standard deviation</span>
    <span class="n">monthly_stats</span> <span class="o">=</span> <span class="n">df_period</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df_period</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">)[</span><span class="n">variable_name</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">])</span>

    <span class="c1"># Create the plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="c1"># Plot the bar diagram with error bars</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">monthly_stats</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
        <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">],</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">],</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
        <span class="n">error_kw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.75</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Set the Y-axis range dynamically</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="n">y_min</span> <span class="o">//</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">20</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">monthly_stats</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">//</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">20</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>

    <span class="c1"># Add gridlines</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#b0b0b0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">FormatStrFormatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">))</span>

    <span class="c1"># Customize plot labels and title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Average Precipitation (mm)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;Average Precipitation per month (Period Jan </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s1"> - Dec </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span>
    <span class="p">)</span>

    <span class="c1"># Customize x-axis with month names</span>
    <span class="n">month_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">month_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Adjust layout and display the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specify the year range to filter and plot monthly average.</span>
<span class="c1"># If no range is provided, complete dataset will be used.</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">plot_monthly_averages</span><span class="p">()</span>  <span class="c1"># Plot using complete dataset</span>
    <span class="n">plot_monthly_averages</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">2020</span><span class="p">)</span>  <span class="c1"># Plot using specified year range</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2b275d44acf33369fcc3f69c1a20c8fbc8d06bd664ae1e050e9e0830e6b466c9.png" src="../../_images/2b275d44acf33369fcc3f69c1a20c8fbc8d06bd664ae1e050e9e0830e6b466c9.png" />
<img alt="../../_images/787d4edb495d009025763648a64d7f9adb42c2a03e828cb576d4251d22c5b644.png" src="../../_images/787d4edb495d009025763648a64d7f9adb42c2a03e828cb576d4251d22c5b644.png" />
</div>
</div>
</section>
</section>
<section id="export-the-netcdf4-files-to-geotiff">
<h2>5. Export the NetCDF4 files to GeoTIFF<a class="headerlink" href="#export-the-netcdf4-files-to-geotiff" title="Link to this heading"></a></h2>
<section id="define-a-function-to-export-the-netcdf4-file-as-geotiff-file-s">
<h3>5.1 Define a Function to export the NetCDF4 file as GeoTIFF File(s)<a class="headerlink" href="#define-a-function-to-export-the-netcdf4-file-as-geotiff-file-s" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rasterio.transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">from_origin</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rasterio</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm.notebook</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main_export_geotiff</span><span class="p">(</span>
    <span class="n">nc_filepath</span><span class="p">,</span>
    <span class="n">nc_file_variable</span><span class="p">,</span>
    <span class="n">bounding_box</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">start_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">end_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">merged</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export precipitation data as GeoTIFF files, either merged into a single multi-band file </span>
<span class="sd">    or as individual files for each time slice, with optional spatial filtering.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        nc_filepath (str): Filepath of the NetCDF4 file.</span>
<span class="sd">        nc_file_variable (str): Variable name of the NetCDF4 file.</span>
<span class="sd">        bounding_box (list): [lon_min, lat_min, lon_max, lat_max] (optional).</span>
<span class="sd">        start_year (int): Starting year for the dataset (optional).</span>
<span class="sd">        end_year (int): Ending year for the dataset (optional).</span>
<span class="sd">        merged (bool): Whether to generate merged geotiff or individual geotiffs (optional).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Open the NetCDF dataset</span>
    <span class="k">with</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">nc_dataset</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;Y&#39;</span><span class="p">][:]</span>

        <span class="c1"># Apply geographic filtering if a bounding box is provided</span>
        <span class="k">if</span> <span class="n">bounding_box</span><span class="p">:</span>
            <span class="n">indices_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">2</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">indices_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">bounding_box</span><span class="p">[</span><span class="mi">3</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span> <span class="o">=</span> <span class="n">indices_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">start_y</span><span class="p">,</span> <span class="n">end_y</span> <span class="o">=</span> <span class="n">indices_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">indices_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_x</span><span class="p">,</span> <span class="n">end_x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">start_y</span><span class="p">,</span> <span class="n">end_y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">start_x</span><span class="p">:</span><span class="n">end_x</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">start_y</span><span class="p">:</span><span class="n">end_y</span><span class="p">]</span>

        <span class="c1"># Extract time variable and convert to readable dates</span>
        <span class="n">time_var</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
        <span class="n">time_units</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
        <span class="n">time_calendar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">time_var</span><span class="p">,</span> <span class="s2">&quot;calendar&quot;</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">)</span>
        <span class="n">cftime</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_var</span><span class="p">[:],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">time_calendar</span><span class="p">)</span>
        
        <span class="c1"># Compute spatial resolution and define raster transformation</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">from_origin</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="o">-</span><span class="n">dy</span><span class="p">)</span>

        <span class="c1"># Determine dataset time range</span>
        <span class="n">min_year</span> <span class="o">=</span> <span class="n">cftime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span>
        <span class="n">max_year</span> <span class="o">=</span> <span class="n">cftime</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">year</span>

        <span class="k">if</span> <span class="n">start_year</span> <span class="ow">and</span> <span class="n">end_year</span><span class="p">:</span>
            <span class="c1"># Customise start_year and end_year based on the available time period</span>
            <span class="k">if</span> <span class="n">start_year</span> <span class="o">&lt;</span> <span class="n">min_year</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start year </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2"> is before dataset range. Adjusting to </span><span class="si">{</span><span class="n">min_year</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">end_year</span> <span class="o">&gt;</span> <span class="n">max_year</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;End year </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2"> exceeds dataset range. Adjusting to </span><span class="si">{</span><span class="n">max_year</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            
            <span class="n">start_year</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">min_year</span><span class="p">)</span>
            <span class="n">end_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">end_year</span><span class="p">,</span> <span class="n">max_year</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Default to full dataset range</span>
            <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="o">=</span> <span class="n">min_year</span><span class="p">,</span> <span class="n">max_year</span>

        <span class="c1"># Get indices corresponding to selected year range</span>
        <span class="n">start_index</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cftime</span><span class="p">)</span> <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">start_year</span><span class="p">)</span>
        <span class="n">end_index</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cftime</span><span class="p">)</span> <span class="k">if</span> <span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">end_year</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12</span>  <span class="c1"># Full year (monthly data)</span>
        
        <span class="c1"># Extract the precipitation data for the selected range</span>
        <span class="n">precipitation_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">]</span>
        <span class="n">precipitation_data_subset</span> <span class="o">=</span> <span class="n">precipitation_data</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">,</span><span class="n">start_y</span><span class="p">:</span><span class="n">end_y</span><span class="p">,</span> <span class="n">start_x</span><span class="p">:</span><span class="n">end_x</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">merged</span><span class="p">:</span>
            <span class="c1"># Create a merged GeoTIFF containing all time slices as separate bands</span>
            <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="s2">&quot;merged_geotiff&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">output_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">_merged_</span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">.tif&quot;</span>
            <span class="n">output_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">)</span>
            
            <span class="c1"># Create a GeoTIFF with multiple bands for each time slice</span>
            <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
                <span class="n">output_filepath</span><span class="p">,</span>
                <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                <span class="n">driver</span> <span class="o">=</span> <span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
                <span class="n">dtype</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">precipitation_data_subset</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">precipitation_data_subset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">precipitation_data_subset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">precipitation_data_subset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">crs</span> <span class="o">=</span> <span class="s2">&quot;EPSG:3035&quot;</span><span class="p">,</span>
                <span class="n">nodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span><span class="p">,</span>
                <span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span><span class="p">,</span>        
            <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">year_index</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">precipitation_data_subset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                       <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Exporting merged GeoTIFF from </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                    <span class="n">band_data</span> <span class="o">=</span> <span class="n">precipitation_data_subset</span><span class="p">[</span><span class="n">year_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                    <span class="n">dt</span> <span class="o">=</span> <span class="n">cftime</span><span class="p">[</span><span class="n">start_index</span> <span class="o">+</span> <span class="n">year_index</span><span class="p">]</span>
                    <span class="n">band_desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>
                    
                    <span class="c1"># Write each time slice as a band</span>
                    <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">band_data</span><span class="p">,</span> <span class="n">year_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">dst</span><span class="o">.</span><span class="n">set_band_description</span><span class="p">(</span><span class="n">year_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">band_desc</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Export as individual GeoTIFF files</span>
            <span class="n">output_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">geotiff_folder</span><span class="p">,</span> <span class="s2">&quot;individual_geotiff&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">year_index</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">precipitation_data_subset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                         <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Exporting individual GeoTIFF files from </span><span class="si">{</span><span class="n">start_year</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="c1"># Retrieve the date for the current time slice</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">cftime</span><span class="p">[</span><span class="n">start_index</span> <span class="o">+</span> <span class="n">year_index</span><span class="p">]</span>
                <span class="n">dt_formatted</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>

                <span class="c1"># Define output file path</span>
                <span class="n">output_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">dt_formatted</span><span class="si">}</span><span class="s2">.tif&quot;</span>
                <span class="n">output_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">)</span>

                <span class="c1"># Export current time slice as an individual GeoTIFF</span>
                <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
                    <span class="n">output_filepath</span><span class="p">,</span>
                    <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                    <span class="n">driver</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">,</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">precipitation_data_subset</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">precipitation_data_subset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                    <span class="n">height</span><span class="o">=</span><span class="n">precipitation_data_subset</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">crs</span><span class="o">=</span><span class="s2">&quot;EPSG:3035&quot;</span><span class="p">,</span>
                    <span class="n">nodata</span><span class="o">=-</span><span class="mi">9999</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                <span class="p">)</span> <span class="k">as</span> <span class="n">dst</span><span class="p">:</span>
                    <span class="n">year_precipitation_data</span> <span class="o">=</span> <span class="n">precipitation_data_subset</span><span class="p">[</span><span class="n">year_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
                    <span class="n">dst</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">year_precipitation_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">dst</span><span class="o">.</span><span class="n">set_band_description</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="si">:</span><span class="s2">04d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">dt</span><span class="o">.</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="export-selected-netcdf4-file-s-to-geotiff-file-s">
<h3>5.2 Export selected NetCDF4 file(s) to GeoTIFF file(s)<a class="headerlink" href="#export-selected-netcdf4-file-s-to-geotiff-file-s" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define file paths and variable names</span>
<span class="n">nc_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="s1">&#39;LAPrec1901.v1.2.nc&#39;</span><span class="p">)</span>
<span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;LAPrec1901&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Export all NetCDF file as merged GeoTIFF file</span>
    <span class="n">main_export_geotiff</span><span class="p">(</span>
        <span class="n">nc_filepath</span> <span class="o">=</span> <span class="n">nc_filepath</span><span class="p">,</span>
        <span class="n">nc_file_variable</span> <span class="o">=</span> <span class="n">variable_name</span><span class="p">,</span>
        <span class="n">bounding_box</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="p">)</span>
    
    <span class="c1"># Export all NetCDF file as individual GeoTIFF file</span>
    <span class="n">main_export_geotiff</span><span class="p">(</span>
        <span class="n">nc_filepath</span> <span class="o">=</span> <span class="n">nc_filepath</span><span class="p">,</span>
        <span class="n">nc_file_variable</span> <span class="o">=</span> <span class="n">variable_name</span><span class="p">,</span>
        <span class="n">bounding_box</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">start_year</span> <span class="o">=</span> <span class="mi">1995</span><span class="p">,</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "53fec45a700d413d8d86a11f4ba845a2"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "393592b299c545b682c4a1d1f2211dac"}</script></div>
</div>
</section>
</section>
<section id="analysis-and-visualization-options">
<h2>6. Analysis and Visualization Options<a class="headerlink" href="#analysis-and-visualization-options" title="Link to this heading"></a></h2>
<section id="define-a-function-for-visualising-a-netcdf4-dataset-as-a-heatmap">
<h3>6.1 Define a function for visualising a NetCDF4 dataset as a Heatmap<a class="headerlink" href="#define-a-function-for-visualising-a-netcdf4-dataset-as-a-heatmap" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.feature</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cfeature</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main_plt_plot</span><span class="p">(</span><span class="n">selected_year</span><span class="p">,</span> <span class="n">selected_month</span><span class="p">,</span> <span class="n">save</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots monthly precipitation data for a given year and month.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        selected_year (str): The year to plot (e.g., &#39;2020&#39;).</span>
<span class="sd">        selected_month (str): The month to plot (e.g., &#39;08&#39;).</span>
<span class="sd">        save (bool): Whether to save the plot as a PNG file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define file paths and variable names</span>
    <span class="n">nc_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">extract_folder</span><span class="p">,</span> <span class="s1">&#39;LAPrec1901.v1.2.nc&#39;</span><span class="p">)</span>
    <span class="n">variable_name</span> <span class="o">=</span> <span class="s1">&#39;LAPrec1901&#39;</span>
    
    <span class="c1"># Open the NetCDF dataset</span>
    <span class="n">nc_dataset</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">nc_filepath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>

    <span class="c1"># Extract time variable and convert it to readable dates</span>
    <span class="n">time_var</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
    <span class="n">time_units</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
    <span class="n">time_calendar</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">time_var</span><span class="p">,</span> <span class="s2">&quot;calendar&quot;</span><span class="p">,</span> <span class="s2">&quot;standard&quot;</span><span class="p">)</span>
    <span class="n">cftime</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_var</span><span class="p">[:],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">time_calendar</span><span class="p">)</span>

    <span class="c1"># Extract data for selected date</span>
    <span class="n">selected_date</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selected_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">selected_month</span><span class="si">}</span><span class="s2">-01&quot;</span>
    <span class="n">target_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">selected_date</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cftime</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">index_data</span> <span class="o">=</span> <span class="n">nc_dataset</span><span class="p">[</span><span class="n">variable_name</span><span class="p">][</span><span class="n">target_index</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    
    <span class="c1"># Calculate vmin, vmax, and bins</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">index_data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">25</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">index_data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">25</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span>
    <span class="n">interval</span> <span class="o">=</span> <span class="mi">25</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">interval</span><span class="p">)</span>

    <span class="c1"># Create the plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
                           <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#f1f1f1&#39;</span><span class="p">,</span>
                           <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                           <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()})</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;rainbow_r&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
    <span class="n">pcm</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span>
                        <span class="n">lat</span><span class="p">,</span>
                        <span class="n">index_data</span><span class="p">,</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                        <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                        <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span>
                        <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>

    <span class="c1"># Add Shapefile</span>
    <span class="n">konstanz_shp</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;.\shapefiles\kn_boundary.shp&quot;</span>
    <span class="n">konstanz_boundary</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">konstanz_shp</span><span class="p">)</span>
    <span class="n">konstanz_boundary</span> <span class="o">=</span> <span class="n">konstanz_boundary</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>
    <span class="n">konstanz_boundary</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>

    <span class="c1"># Add a colorbar</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Monthly Precipitation [mm]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># # Add map features</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="c1"># ax.add_feature(cfeature.RIVERS, linewidth=0.5, edgecolor=&#39;blue&#39;)</span>

    <span class="c1"># Add grid lines</span>
    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                      <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                      <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                      <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span> 
    <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">}</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;black&#39;</span><span class="p">}</span>

    <span class="c1"># Add title and labels</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.175</span><span class="p">,</span> <span class="s1">&#39;Longitude&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Latitude&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Monthly Precipitation, </span><span class="si">{</span><span class="n">selected_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>

    <span class="c1"># Save or display the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">temp_images_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s2">&quot;temp_images_folder&quot;</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_images_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">image_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_images_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">selected_year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">selected_month</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">image_filepath</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved to: </span><span class="si">{</span><span class="n">image_filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="create-a-heatmap-for-the-monthly-mean">
<h3>6.2 Create a Heatmap for the Monthly Mean<a class="headerlink" href="#create-a-heatmap-for-the-monthly-mean" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main_plt_plot</span><span class="p">(</span>
        <span class="n">selected_year</span><span class="o">=</span><span class="s1">&#39;2020&#39;</span><span class="p">,</span>
        <span class="n">selected_month</span><span class="o">=</span><span class="s1">&#39;08&#39;</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/303fdb76228f4b9f0a2dc5309212cdeb7022f6134bd337ac5ac64aaa1ff6654b.png" src="../../_images/303fdb76228f4b9f0a2dc5309212cdeb7022f6134bd337ac5ac64aaa1ff6654b.png" />
</div>
</div>
</section>
<section id="define-a-function-for-visualising-a-netcdf4-dataset-as-a-monthly-heatmap">
<h3>6.3 Define a function for visualising a NetCDF4 dataset as a Monthly Heatmap<a class="headerlink" href="#define-a-function-for-visualising-a-netcdf4-dataset-as-a-monthly-heatmap" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_precipitation_heatmap</span><span class="p">(</span><span class="n">start_year</span><span class="o">=</span><span class="mi">2010</span><span class="p">,</span>
                               <span class="n">end_year</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a heatmap of monthly average precipitation from a CSV file.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        start_year (int, optional): The starting year to filter the data. Default is 2010.</span>
<span class="sd">        end_year (int, optional): The ending year to filter the data. If not provided, filters up to the maximum year.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Load data and preprocess</span>
    <span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csv_folder</span><span class="p">,</span> <span class="s1">&#39;LAPrec1901_monthly_means.csv&#39;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Yearly_Sum&#39;</span><span class="p">])</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
    
    <span class="c1"># Determine the effective end year</span>
    <span class="n">max_year_in_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">end_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_year_in_data</span><span class="p">,</span> <span class="n">end_year</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">end_year</span> <span class="o">=</span> <span class="n">max_year_in_data</span>
    
    <span class="c1"># Filter data based on start and end year</span>
    <span class="n">df_filtered</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">start_year</span><span class="p">:</span><span class="n">end_year</span><span class="p">]</span>
    
    <span class="c1"># Create the heatmap</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">df_filtered</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
        <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.0f&quot;</span><span class="p">,</span>
        <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Precipitation (</span><span class="si">{</span><span class="n">summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;mm&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ticks&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
            <span class="s2">&quot;pad&quot;</span><span class="p">:</span> <span class="mf">0.015</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">220</span>
    <span class="p">)</span>
    
    <span class="c1"># Customize x-axis with month names</span>
    <span class="n">month_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">]</span>  
    <span class="n">ticks</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
    <span class="n">shifted_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">tick</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">]</span>
    <span class="c1"># Set the ticks and labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">shifted_ticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">month_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># Add labels and title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Monthly Average Precipitation&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Month&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Adjust layout and display the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example usage</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">plot_precipitation_heatmap</span><span class="p">(</span>
        <span class="n">start_year</span><span class="o">=</span><span class="mi">2010</span><span class="p">,</span>
        <span class="n">end_year</span><span class="o">=</span><span class="mi">2020</span>
    <span class="p">)</span>
    
    <span class="n">plot_precipitation_heatmap</span><span class="p">(</span>
        <span class="n">start_year</span><span class="o">=</span><span class="mi">2005</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/a8a729dfef85ff860cc990f7843e6d0e4682d539cd602bd4fd43fe2ce6aed748.png" src="../../_images/a8a729dfef85ff860cc990f7843e6d0e4682d539cd602bd4fd43fe2ce6aed748.png" />
<img alt="../../_images/29f3bee7f998d08160e4f71f5151e7f028e17e829f99697eaae4a8bf2fc81386.png" src="../../_images/29f3bee7f998d08160e4f71f5151e7f028e17e829f99697eaae4a8bf2fc81386.png" />
</div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../rst_jupyter_bibliothek/cds_data/index.html" class="btn btn-neutral float-left" title="CDS Dataset Notebooks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="02-sis-heat-wave-and-cold-spells.html" class="btn btn-neutral float-right" title="Heat Wave and Cold Spells" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, str.ucture GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>